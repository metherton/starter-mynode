/*

twilio-rtc-conversations.js v0.8 (0.8.4.b1-1900161)

Copyright (c) 2015 Twilio, Inc. All rights reserved. <https://twilio.com>

THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY
OF SUCH DAMAGE.

This software includes third party open source software components: SIP.js.
Each of these software components have their own license. Please see below.

--- begin SIP.js license ---

Name: SIP.js
Copyright (c) 2014 Junction Networks, Inc. <http://www.onsip.com>

License: The MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

~~~ SIP.js contains substantial portions of the JsSIP software under the following license: ~~~

Copyright (c) 2012-2013 Jos? Luis Mill?n - Versatica <http://www.versatica.com>

License: The MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

~~~ end JsSIP license ~~~

--- end SIP.js license ---
*/
(function e$$0(l,m,b){function h(e,a){if(!m[e]){if(!l[e]){var c="function"==typeof require&&require;if(!a&&c)return c(e,!0);if(g)return g(e,!0);c=Error("Cannot find module '"+e+"'");throw c.code="MODULE_NOT_FOUND",c;}c=m[e]={exports:{}};l[e][0].call(c.exports,function(c){var a=l[e][1][c];return h(a?a:c)},c,c.exports,e$$0,l,m,b)}return m[e].exports}for(var g="function"==typeof require&&require,e=0;e<b.length;e++)h(b[e]);return h})({1:[function(k,l,m){function b(c){if(!(this instanceof b))return 1<
arguments.length?new b(c,arguments[1]):new b(c);this.length=0;this.parent=void 0;if("number"===typeof c){var d;d=g(this,0>c?0:e(c)|0);if(!b.TYPED_ARRAY_SUPPORT)for(var f=0;f<c;f++)d[f]=0;return d}if("string"===typeof c){d=this;f=1<arguments.length?arguments[1]:"utf8";if("string"!==typeof f||""===f)f="utf8";var n=a(c,f)|0;d=g(d,n);d.write(c,f);return d}return h(this,c)}function h(c,a){if(b.isBuffer(a)){var d=c,f=e(a.length)|0,d=g(d,f);a.copy(d,0,0,f);return d}if(D(a)){for(var d=c,f=e(a.length)|0,d=
g(d,f),n=0;n<f;n+=1)d[n]=a[n]&255;return d}if(null==a)throw new TypeError("must start with number, buffer, array or string");if("undefined"!==typeof ArrayBuffer&&a.buffer instanceof ArrayBuffer){d=c;f=e(a.length)|0;d=g(d,f);for(n=0;n<f;n+=1)d[n]=a[n]&255;return d}if(a.length){d=c;f=e(a.length)|0;d=g(d,f);for(n=0;n<f;n+=1)d[n]=a[n]&255;return d}d=c;n=0;"Buffer"===a.type&&D(a.data)&&(f=a.data,n=e(f.length)|0);for(var d=g(d,n),p=0;p<n;p+=1)d[p]=f[p]&255;return d}function g(c,a){b.TYPED_ARRAY_SUPPORT?
c=b._augment(new Uint8Array(a)):(c.length=a,c._isBuffer=!0);0!==a&&a<=b.poolSize>>>1&&(c.parent=A);return c}function e(c){if(c>=H)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+H.toString(16)+" bytes");return c|0}function f(c,a){if(!(this instanceof f))return new f(c,a);var d=new b(c,a);delete d.parent;return d}function a(c,a){"string"!==typeof c&&(c=String(c));if(0===c.length)return 0;switch(a||"utf8"){case "ascii":case "binary":case "raw":return c.length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*
c.length;case "hex":return c.length>>>1;case "utf8":case "utf-8":return C(c).length;case "base64":return u.toByteArray(v(c)).length;default:return c.length}}function c(c,a,b){if(0!==c%1||0>c)throw new RangeError("offset is not uint");if(c+a>b)throw new RangeError("Trying to access beyond buffer length");}function d(c,a,d,e,f,n){if(!b.isBuffer(c))throw new TypeError("buffer must be a Buffer instance");if(a>f||a<n)throw new RangeError("value is out of bounds");if(d+e>c.length)throw new RangeError("index out of range");
}function p(c,a,b,d){0>a&&(a=65535+a+1);for(var e=0,f=Math.min(c.length-b,2);e<f;e++)c[b+e]=(a&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function n(c,a,b,d){0>a&&(a=4294967295+a+1);for(var e=0,f=Math.min(c.length-b,4);e<f;e++)c[b+e]=a>>>8*(d?e:3-e)&255}function w(c,a,b,d,e,f){if(a>e||a<f)throw new RangeError("value is out of bounds");if(b+d>c.length)throw new RangeError("index out of range");if(0>b)throw new RangeError("index out of range");}function x(c,a,b,d,e){e||w(c,a,b,4,3.4028234663852886E38,-3.4028234663852886E38);
F.write(c,a,b,d,23,4);return b+4}function z(c,a,b,d,e){e||w(c,a,b,8,1.7976931348623157E308,-1.7976931348623157E308);F.write(c,a,b,d,52,8);return b+8}function v(c){c=c.trim?c.trim():c.replace(/^\s+|\s+$/g,"");c=c.replace(I,"");if(2>c.length)return"";for(;0!==c.length%4;)c+="=";return c}function C(c,a){a=a||Infinity;for(var b,d=c.length,e=null,f=[],n=0;n<d;n++){b=c.charCodeAt(n);if(55295<b&&57344>b)if(e)if(56320>b){-1<(a-=3)&&f.push(239,191,189);e=b;continue}else b=e-55296<<10|b-56320|65536,e=null;
else{56319<b?-1<(a-=3)&&f.push(239,191,189):n+1===d?-1<(a-=3)&&f.push(239,191,189):e=b;continue}else e&&(-1<(a-=3)&&f.push(239,191,189),e=null);if(128>b){if(0>--a)break;f.push(b)}else if(2048>b){if(0>(a-=2))break;f.push(b>>6|192,b&63|128)}else if(65536>b){if(0>(a-=3))break;f.push(b>>12|224,b>>6&63|128,b&63|128)}else if(2097152>b){if(0>(a-=4))break;f.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw Error("Invalid code point");}return f}function q(c){for(var a=[],b=0;b<c.length;b++)a.push(c.charCodeAt(b)&
255);return a}function r(c,a,b,d){for(var e=0;e<d&&!(e+b>=a.length||e>=c.length);e++)a[e+b]=c[e];return e}function t(c){try{return decodeURIComponent(c)}catch(a){return String.fromCharCode(65533)}}var u=k("base64-js"),F=k("ieee754"),D=k("is-array");m.Buffer=b;m.SlowBuffer=f;m.INSPECT_MAX_BYTES=50;b.poolSize=8192;var H=1073741823,A={};b.TYPED_ARRAY_SUPPORT=function(){try{var c=new ArrayBuffer(0),a=new Uint8Array(c);a.foo=function(){return 42};return 42===a.foo()&&"function"===typeof a.subarray&&0===
(new Uint8Array(1)).subarray(1,1).byteLength}catch(b){return!1}}();b.isBuffer=function(c){return!(null==c||!c._isBuffer)};b.compare=function(c,a){if(!b.isBuffer(c)||!b.isBuffer(a))throw new TypeError("Arguments must be Buffers");if(c===a)return 0;for(var d=c.length,e=a.length,f=0,n=Math.min(d,e);f<n&&c[f]===a[f];)++f;f!==n&&(d=c[f],e=a[f]);return d<e?-1:e<d?1:0};b.isEncoding=function(c){switch(String(c).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "raw":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};b.concat=function(c,a){if(!D(c))throw new TypeError("list argument must be an Array of Buffers.");if(0===c.length)return new b(0);if(1===c.length)return c[0];var d;if(void 0===a)for(d=a=0;d<c.length;d++)a+=c[d].length;var e=new b(a),f=0;for(d=0;d<c.length;d++){var n=c[d];n.copy(e,f);f+=n.length}return e};b.byteLength=a;b.prototype.length=void 0;b.prototype.parent=void 0;b.prototype.toString=function(c,a,b){var d=!1;a|=0;b=void 0===b||Infinity===b?this.length:b|0;c||(c="utf8");0>
a&&(a=0);b>this.length&&(b=this.length);if(b<=a)return"";for(;;)switch(c){case "hex":c=a;a=this.length;if(!c||0>c)c=0;if(!b||0>b||b>a)b=a;for(a="";c<b;c++)d=this[c],d=16>d?"0"+d.toString(16):d.toString(16),a+=d;return a;case "utf8":case "utf-8":c=a;d=a="";for(b=Math.min(this.length,b);c<b;c++)127>=this[c]?(a+=t(d)+String.fromCharCode(this[c]),d=""):d+="%"+this[c].toString(16);return a+t(d);case "ascii":c=a;a="";for(b=Math.min(this.length,b);c<b;c++)a+=String.fromCharCode(this[c]&127);return a;case "binary":c=
a;a="";for(b=Math.min(this.length,b);c<b;c++)a+=String.fromCharCode(this[c]);return a;case "base64":return c=a,b=0===c&&b===this.length?u.fromByteArray(this):u.fromByteArray(this.slice(c,b)),b;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":b=this.slice(a,b);c="";for(a=0;a<b.length;a+=2)c+=String.fromCharCode(b[a]+256*b[a+1]);return c;default:if(d)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase();d=!0}};b.prototype.equals=function(c){if(!b.isBuffer(c))throw new TypeError("Argument must be a Buffer");
return this===c?!0:0===b.compare(this,c)};b.prototype.inspect=function(){var c="",a=m.INSPECT_MAX_BYTES;0<this.length&&(c=this.toString("hex",0,a).match(/.{2}/g).join(" "),this.length>a&&(c+=" ... "));return"<Buffer "+c+">"};b.prototype.compare=function(c){if(!b.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?0:b.compare(this,c)};b.prototype.indexOf=function(c,a){function d(c,a,b){for(var e=-1,f=0;b+f<c.length;f++)if(c[b+f]===a[-1===e?0:f-e]){if(-1===e&&(e=f),f-e+1===
a.length)return b+e}else e=-1;return-1}2147483647<a?a=2147483647:-2147483648>a&&(a=-2147483648);a>>=0;if(0===this.length||a>=this.length)return-1;0>a&&(a=Math.max(this.length+a,0));if("string"===typeof c)return 0===c.length?-1:String.prototype.indexOf.call(this,c,a);if(b.isBuffer(c))return d(this,c,a);if("number"===typeof c)return b.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,c,a):d(this,[c],a);throw new TypeError("val must be string, number or Buffer");
};b.prototype.get=function(c){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(c)};b.prototype.set=function(c,a){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(c,a)};b.prototype.write=function(c,a,b,d){if(void 0===a)d="utf8",b=this.length,a=0;else if(void 0===b&&"string"===typeof a)d=a,b=this.length,a=0;else if(isFinite(a))a|=0,isFinite(b)?(b|=0,void 0===d&&(d="utf8")):(d=b,b=void 0);else{var e=d;d=a;a=
b|0;b=e}e=this.length-a;if(void 0===b||b>e)b=e;if(0<c.length&&(0>b||0>a)||a>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(e=!1;;)switch(d){case "hex":a=Number(a)||0;d=this.length-a;b?(b=Number(b),b>d&&(b=d)):b=d;d=c.length;if(0!==d%2)throw Error("Invalid hex string");b>d/2&&(b=d/2);for(d=0;d<b;d++){e=parseInt(c.substr(2*d,2),16);if(isNaN(e))throw Error("Invalid hex string");this[a+d]=e}return d;case "utf8":case "utf-8":return r(C(c,this.length-a),this,
a,b);case "ascii":return r(q(c),this,a,b);case "binary":return r(q(c),this,a,b);case "base64":return r(u.toByteArray(v(c)),this,a,b);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":d=this.length-a;for(var f=void 0,f=e=void 0,n=[],g=0;g<c.length&&!(0>(d-=2));g++)f=c.charCodeAt(g),e=f>>8,f%=256,n.push(f),n.push(e);return r(n,this,a,b);default:if(e)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase();e=!0}};b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||
this,0)}};b.prototype.slice=function(c,a){var d=this.length;c=~~c;a=void 0===a?d:~~a;0>c?(c+=d,0>c&&(c=0)):c>d&&(c=d);0>a?(a+=d,0>a&&(a=0)):a>d&&(a=d);a<c&&(a=c);if(b.TYPED_ARRAY_SUPPORT)d=b._augment(this.subarray(c,a));else for(var e=a-c,d=new b(e,void 0),f=0;f<e;f++)d[f]=this[f+c];d.length&&(d.parent=this.parent||this);return d};b.prototype.readUIntLE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=this[a];for(var e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d};b.prototype.readUIntBE=function(a,
b,d){a|=0;b|=0;d||c(a,b,this.length);d=this[a+--b];for(var e=1;0<b&&(e*=256);)d+=this[a+--b]*e;return d};b.prototype.readUInt8=function(a,b){b||c(a,1,this.length);return this[a]};b.prototype.readUInt16LE=function(a,b){b||c(a,2,this.length);return this[a]|this[a+1]<<8};b.prototype.readUInt16BE=function(a,b){b||c(a,2,this.length);return this[a]<<8|this[a+1]};b.prototype.readUInt32LE=function(a,b){b||c(a,4,this.length);return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]};b.prototype.readUInt32BE=
function(a,b){b||c(a,4,this.length);return 16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])};b.prototype.readIntLE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=this[a];for(var e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;d>=128*e&&(d-=Math.pow(2,8*b));return d};b.prototype.readIntBE=function(a,b,d){a|=0;b|=0;d||c(a,b,this.length);d=b;for(var e=1,f=this[a+--d];0<d&&(e*=256);)f+=this[a+--d]*e;f>=128*e&&(f-=Math.pow(2,8*b));return f};b.prototype.readInt8=function(a,b){b||c(a,1,this.length);return this[a]&
128?-1*(255-this[a]+1):this[a]};b.prototype.readInt16LE=function(a,b){b||c(a,2,this.length);var d=this[a]|this[a+1]<<8;return d&32768?d|4294901760:d};b.prototype.readInt16BE=function(a,b){b||c(a,2,this.length);var d=this[a+1]|this[a]<<8;return d&32768?d|4294901760:d};b.prototype.readInt32LE=function(a,b){b||c(a,4,this.length);return this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24};b.prototype.readInt32BE=function(a,b){b||c(a,4,this.length);return this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]};
b.prototype.readFloatLE=function(a,b){b||c(a,4,this.length);return F.read(this,a,!0,23,4)};b.prototype.readFloatBE=function(a,b){b||c(a,4,this.length);return F.read(this,a,!1,23,4)};b.prototype.readDoubleLE=function(a,b){b||c(a,8,this.length);return F.read(this,a,!0,52,8)};b.prototype.readDoubleBE=function(a,b){b||c(a,8,this.length);return F.read(this,a,!1,52,8)};b.prototype.writeUIntLE=function(a,c,b,e){a=+a;c|=0;b|=0;e||d(this,a,c,b,Math.pow(2,8*b),0);e=1;var f=0;for(this[c]=a&255;++f<b&&(e*=256);)this[c+
f]=a/e&255;return c+b};b.prototype.writeUIntBE=function(a,c,b,e){a=+a;c|=0;b|=0;e||d(this,a,c,b,Math.pow(2,8*b),0);e=b-1;var f=1;for(this[c+e]=a&255;0<=--e&&(f*=256);)this[c+e]=a/f&255;return c+b};b.prototype.writeUInt8=function(a,c,e){a=+a;c|=0;e||d(this,a,c,1,255,0);b.TYPED_ARRAY_SUPPORT||(a=Math.floor(a));this[c]=a;return c+1};b.prototype.writeUInt16LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,65535,0);b.TYPED_ARRAY_SUPPORT?(this[c]=a,this[c+1]=a>>>8):p(this,a,c,!0);return c+2};b.prototype.writeUInt16BE=
function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,65535,0);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>8,this[c+1]=a):p(this,a,c,!1);return c+2};b.prototype.writeUInt32LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,4294967295,0);b.TYPED_ARRAY_SUPPORT?(this[c+3]=a>>>24,this[c+2]=a>>>16,this[c+1]=a>>>8,this[c]=a):n(this,a,c,!0);return c+4};b.prototype.writeUInt32BE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,4294967295,0);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a):n(this,a,c,!1);
return c+4};b.prototype.writeIntLE=function(a,c,b,e){a=+a;c|=0;e||(e=Math.pow(2,8*b-1),d(this,a,c,b,e-1,-e));e=0;var f=1,n=0>a?1:0;for(this[c]=a&255;++e<b&&(f*=256);)this[c+e]=(a/f>>0)-n&255;return c+b};b.prototype.writeIntBE=function(a,c,b,e){a=+a;c|=0;e||(e=Math.pow(2,8*b-1),d(this,a,c,b,e-1,-e));e=b-1;var f=1,n=0>a?1:0;for(this[c+e]=a&255;0<=--e&&(f*=256);)this[c+e]=(a/f>>0)-n&255;return c+b};b.prototype.writeInt8=function(a,c,e){a=+a;c|=0;e||d(this,a,c,1,127,-128);b.TYPED_ARRAY_SUPPORT||(a=Math.floor(a));
0>a&&(a=255+a+1);this[c]=a;return c+1};b.prototype.writeInt16LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,32767,-32768);b.TYPED_ARRAY_SUPPORT?(this[c]=a,this[c+1]=a>>>8):p(this,a,c,!0);return c+2};b.prototype.writeInt16BE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,2,32767,-32768);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>8,this[c+1]=a):p(this,a,c,!1);return c+2};b.prototype.writeInt32LE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,2147483647,-2147483648);b.TYPED_ARRAY_SUPPORT?(this[c]=a,this[c+1]=a>>>8,this[c+
2]=a>>>16,this[c+3]=a>>>24):n(this,a,c,!0);return c+4};b.prototype.writeInt32BE=function(a,c,e){a=+a;c|=0;e||d(this,a,c,4,2147483647,-2147483648);0>a&&(a=4294967295+a+1);b.TYPED_ARRAY_SUPPORT?(this[c]=a>>>24,this[c+1]=a>>>16,this[c+2]=a>>>8,this[c+3]=a):n(this,a,c,!1);return c+4};b.prototype.writeFloatLE=function(a,c,b){return x(this,a,c,!0,b)};b.prototype.writeFloatBE=function(a,c,b){return x(this,a,c,!1,b)};b.prototype.writeDoubleLE=function(a,c,b){return z(this,a,c,!0,b)};b.prototype.writeDoubleBE=
function(a,c,b){return z(this,a,c,!1,b)};b.prototype.copy=function(a,c,d,e){d||(d=0);e||0===e||(e=this.length);c>=a.length&&(c=a.length);c||(c=0);0<e&&e<d&&(e=d);if(e===d||0===a.length||0===this.length)return 0;if(0>c)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("sourceStart out of bounds");if(0>e)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length);a.length-c<e-d&&(e=a.length-c+d);e-=d;if(1E3>e||!b.TYPED_ARRAY_SUPPORT)for(var f=
0;f<e;f++)a[f+c]=this[f+d];else a._set(this.subarray(d,d+e),c);return e};b.prototype.fill=function(a,c,b){a||(a=0);c||(c=0);b||(b=this.length);if(b<c)throw new RangeError("end < start");if(b!==c&&0!==this.length){if(0>c||c>=this.length)throw new RangeError("start out of bounds");if(0>b||b>this.length)throw new RangeError("end out of bounds");if("number"===typeof a)for(;c<b;c++)this[c]=a;else{a=C(a.toString());for(var d=a.length;c<b;c++)this[c]=a[c%d]}return this}};b.prototype.toArrayBuffer=function(){if("undefined"!==
typeof Uint8Array){if(b.TYPED_ARRAY_SUPPORT)return(new b(this)).buffer;for(var a=new Uint8Array(this.length),c=0,d=a.length;c<d;c+=1)a[c]=this[c];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser");};var y=b.prototype;b._augment=function(a){a.constructor=b;a._isBuffer=!0;a._set=a.set;a.get=y.get;a.set=y.set;a.write=y.write;a.toString=y.toString;a.toLocaleString=y.toString;a.toJSON=y.toJSON;a.equals=y.equals;a.compare=y.compare;a.indexOf=y.indexOf;a.copy=y.copy;
a.slice=y.slice;a.readUIntLE=y.readUIntLE;a.readUIntBE=y.readUIntBE;a.readUInt8=y.readUInt8;a.readUInt16LE=y.readUInt16LE;a.readUInt16BE=y.readUInt16BE;a.readUInt32LE=y.readUInt32LE;a.readUInt32BE=y.readUInt32BE;a.readIntLE=y.readIntLE;a.readIntBE=y.readIntBE;a.readInt8=y.readInt8;a.readInt16LE=y.readInt16LE;a.readInt16BE=y.readInt16BE;a.readInt32LE=y.readInt32LE;a.readInt32BE=y.readInt32BE;a.readFloatLE=y.readFloatLE;a.readFloatBE=y.readFloatBE;a.readDoubleLE=y.readDoubleLE;a.readDoubleBE=y.readDoubleBE;
a.writeUInt8=y.writeUInt8;a.writeUIntLE=y.writeUIntLE;a.writeUIntBE=y.writeUIntBE;a.writeUInt16LE=y.writeUInt16LE;a.writeUInt16BE=y.writeUInt16BE;a.writeUInt32LE=y.writeUInt32LE;a.writeUInt32BE=y.writeUInt32BE;a.writeIntLE=y.writeIntLE;a.writeIntBE=y.writeIntBE;a.writeInt8=y.writeInt8;a.writeInt16LE=y.writeInt16LE;a.writeInt16BE=y.writeInt16BE;a.writeInt32LE=y.writeInt32LE;a.writeInt32BE=y.writeInt32BE;a.writeFloatLE=y.writeFloatLE;a.writeFloatBE=y.writeFloatBE;a.writeDoubleLE=y.writeDoubleLE;a.writeDoubleBE=
y.writeDoubleBE;a.fill=y.fill;a.inspect=y.inspect;a.toArrayBuffer=y.toArrayBuffer;return a};var I=/[^+\/0-9A-z\-]/g},{"base64-js":2,ieee754:3,"is-array":4}],2:[function(k,l,m){(function(b){function h(b){b=b.charCodeAt(0);if(43===b||45===b)return 62;if(47===b||95===b)return 63;if(48>b)return-1;if(58>b)return b-48+52;if(91>b)return b-65;if(123>b)return b-97+26}var g="undefined"!==typeof Uint8Array?Uint8Array:Array;b.toByteArray=function(b){function f(a){n[w++]=a}var a,c,d,p,n;if(0<b.length%4)throw Error("Invalid string. Length must be a multiple of 4");
a=b.length;p="="===b.charAt(a-2)?2:"="===b.charAt(a-1)?1:0;n=new g(3*b.length/4-p);c=0<p?b.length-4:b.length;var w=0;for(a=0;a<c;a+=4)d=h(b.charAt(a))<<18|h(b.charAt(a+1))<<12|h(b.charAt(a+2))<<6|h(b.charAt(a+3)),f((d&16711680)>>16),f((d&65280)>>8),f(d&255);2===p?(d=h(b.charAt(a))<<2|h(b.charAt(a+1))>>4,f(d&255)):1===p&&(d=h(b.charAt(a))<<10|h(b.charAt(a+1))<<4|h(b.charAt(a+2))>>2,f(d>>8&255),f(d&255));return n};b.fromByteArray=function(b){var f,a=b.length%3,c="",d,g;f=0;for(g=b.length-a;f<g;f+=3)d=
(b[f]<<16)+(b[f+1]<<8)+b[f+2],d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d&63),c+=d;switch(a){case 1:d=b[b.length-1];c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>2);c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<
4&63);c+="==";break;case 2:d=(b[b.length-2]<<8)+b[b.length-1],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>10),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>4&63),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<2&63),c+="="}return c}})("undefined"===typeof m?this.base64js={}:m)},{}],3:[function(k,l,m){m.read=function(b,h,g,e,f){var a;a=8*f-e-1;var c=(1<<a)-1,d=c>>1,p=-7;f=g?f-1:0;var n=g?-1:1,w=b[h+
f];f+=n;g=w&(1<<-p)-1;w>>=-p;for(p+=a;0<p;g=256*g+b[h+f],f+=n,p-=8);a=g&(1<<-p)-1;g>>=-p;for(p+=e;0<p;a=256*a+b[h+f],f+=n,p-=8);if(0===g)g=1-d;else{if(g===c)return a?NaN:Infinity*(w?-1:1);a+=Math.pow(2,e);g-=d}return(w?-1:1)*a*Math.pow(2,g-e)};m.write=function(b,h,g,e,f,a){var c,d=8*a-f-1,p=(1<<d)-1,n=p>>1,w=23===f?Math.pow(2,-24)-Math.pow(2,-77):0;a=e?0:a-1;var x=e?1:-1,z=0>h||0===h&&0>1/h?1:0;h=Math.abs(h);isNaN(h)||Infinity===h?(h=isNaN(h)?1:0,e=p):(e=Math.floor(Math.log(h)/Math.LN2),1>h*(c=Math.pow(2,
-e))&&(e--,c*=2),h=1<=e+n?h+w/c:h+w*Math.pow(2,1-n),2<=h*c&&(e++,c/=2),e+n>=p?(h=0,e=p):1<=e+n?(h=(h*c-1)*Math.pow(2,f),e+=n):(h=h*Math.pow(2,n-1)*Math.pow(2,f),e=0));for(;8<=f;b[g+a]=h&255,a+=x,h/=256,f-=8);e=e<<f|h;for(d+=f;0<d;b[g+a]=e&255,a+=x,e/=256,d-=8);b[g+a-x]|=128*z}},{}],4:[function(k,l,m){var b=Object.prototype.toString;l.exports=Array.isArray||function(h){return!!h&&"[object Array]"==b.call(h)}},{}],5:[function(k,l,m){function b(){this._events=this._events||{};this._maxListeners=this._maxListeners||
void 0}function h(b){return"function"===typeof b}function g(b){return"object"===typeof b&&null!==b}l.exports=b;b.EventEmitter=b;b.prototype._events=void 0;b.prototype._maxListeners=void 0;b.defaultMaxListeners=10;b.prototype.setMaxListeners=function(b){if("number"!==typeof b||0>b||isNaN(b))throw TypeError("n must be a positive number");this._maxListeners=b;return this};b.prototype.emit=function(b){var f,a,c,d;this._events||(this._events={});if("error"===b&&(!this._events.error||g(this._events.error)&&
!this._events.error.length)){f=arguments[1];if(f instanceof Error)throw f;throw TypeError('Uncaught, unspecified "error" event.');}a=this._events[b];if(void 0===a)return!1;if(h(a))switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:f=arguments.length;c=Array(f-1);for(d=1;d<f;d++)c[d-1]=arguments[d];a.apply(this,c)}else if(g(a)){f=arguments.length;c=Array(f-1);for(d=1;d<f;d++)c[d-1]=arguments[d];a=a.slice();
f=a.length;for(d=0;d<f;d++)a[d].apply(this,c)}return!0};b.prototype.addListener=function(e,f){var a;if(!h(f))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",e,h(f.listener)?f.listener:f);this._events[e]?g(this._events[e])?this._events[e].push(f):this._events[e]=[this._events[e],f]:this._events[e]=f;g(this._events[e])&&!this._events[e].warned&&(a=void 0!==this._maxListeners?this._maxListeners:b.defaultMaxListeners)&&0<
a&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace());return this};b.prototype.on=b.prototype.addListener;b.prototype.once=function(b,f){function a(){this.removeListener(b,a);c||(c=!0,f.apply(this,arguments))}if(!h(f))throw TypeError("listener must be a function");var c=!1;a.listener=
f;this.on(b,a);return this};b.prototype.removeListener=function(b,f){var a,c,d;if(!h(f))throw TypeError("listener must be a function");if(!this._events||!this._events[b])return this;a=this._events[b];d=a.length;c=-1;if(a===f||h(a.listener)&&a.listener===f)delete this._events[b],this._events.removeListener&&this.emit("removeListener",b,f);else if(g(a)){for(;0<d--;)if(a[d]===f||a[d].listener&&a[d].listener===f){c=d;break}if(0>c)return this;1===a.length?(a.length=0,delete this._events[b]):a.splice(c,
1);this._events.removeListener&&this.emit("removeListener",b,f)}return this};b.prototype.removeAllListeners=function(b){var f;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[b]&&delete this._events[b],this;if(0===arguments.length){for(f in this._events)"removeListener"!==f&&this.removeAllListeners(f);this.removeAllListeners("removeListener");this._events={};return this}f=this._events[b];if(h(f))this.removeListener(b,f);else for(;f.length;)this.removeListener(b,
f[f.length-1]);delete this._events[b];return this};b.prototype.listeners=function(b){return this._events&&this._events[b]?h(this._events[b])?[this._events[b]]:this._events[b].slice():[]};b.listenerCount=function(b,f){return b._events&&b._events[f]?h(b._events[f])?1:b._events[f].length:0}},{}],6:[function(k,l,m){l.exports="function"===typeof Object.create?function(b,h){b.super_=h;b.prototype=Object.create(h.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,h){b.super_=
h;var g=function(){};g.prototype=h.prototype;b.prototype=new g;b.prototype.constructor=b}},{}],7:[function(k,l,m){function b(){if(!e){e=!0;for(var b,a=g.length;a;){b=g;g=[];for(var c=-1;++c<a;)b[c]();a=g.length}e=!1}}function h(){}k=l.exports={};var g=[],e=!1;k.nextTick=function(f){g.push(f);e||setTimeout(b,0)};k.title="browser";k.browser=!0;k.env={};k.argv=[];k.version="";k.versions={};k.on=h;k.addListener=h;k.once=h;k.off=h;k.removeListener=h;k.removeAllListeners=h;k.emit=h;k.binding=function(b){throw Error("process.binding is not supported");
};k.cwd=function(){return"/"};k.chdir=function(b){throw Error("process.chdir is not supported");};k.umask=function(){return 0}},{}],8:[function(k,l,m){l.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===typeof b.fill&&"function"===typeof b.readUInt8}},{}],9:[function(k,l,m){(function(b,h){function g(a,b){var d={seen:[],stylize:f};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);v(b)?d.showHidden=b:b&&m._extend(d,b);
r(d.showHidden)&&(d.showHidden=!1);r(d.depth)&&(d.depth=2);r(d.colors)&&(d.colors=!1);r(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=e);return c(d,a,d.depth)}function e(a,c){var b=g.styles[c];return b?"\u001b["+g.colors[b][0]+"m"+a+"\u001b["+g.colors[b][1]+"m":a}function f(a,c){return a}function a(a){var c={};a.forEach(function(a,b){c[a]=!0});return c}function c(b,e,f){if(b.customInspect&&e&&H(e.inspect)&&e.inspect!==m.inspect&&(!e.constructor||e.constructor.prototype!==e)){var g=e.inspect(f,
b);q(g)||(g=c(b,g,f));return g}if(g=d(b,e))return g;var h=Object.keys(e),v=a(h);b.showHidden&&(h=Object.getOwnPropertyNames(e));if(D(e)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return p(e);if(0===h.length){if(H(e))return b.stylize("[Function"+(e.name?": "+e.name:"")+"]","special");if(t(e))return b.stylize(RegExp.prototype.toString.call(e),"regexp");if(F(e))return b.stylize(Date.prototype.toString.call(e),"date");if(D(e))return p(e)}var g="",k=!1,r=["{","}"];z(e)&&(k=!0,r=["[","]"]);
H(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]");t(e)&&(g=" "+RegExp.prototype.toString.call(e));F(e)&&(g=" "+Date.prototype.toUTCString.call(e));D(e)&&(g=" "+p(e));if(0===h.length&&(!k||0==e.length))return r[0]+g+r[1];if(0>f)return t(e)?b.stylize(RegExp.prototype.toString.call(e),"regexp"):b.stylize("[Object]","special");b.seen.push(e);h=k?n(b,e,f,v,h):h.map(function(a){return w(b,e,f,v,a,k)});b.seen.pop();return x(h,g,r)}function d(a,c){if(r(c))return a.stylize("undefined","undefined");if(q(c)){var b=
"'"+JSON.stringify(c).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(b,"string")}if(C(c))return a.stylize(""+c,"number");if(v(c))return a.stylize(""+c,"boolean");if(null===c)return a.stylize("null","null")}function p(a){return"["+Error.prototype.toString.call(a)+"]"}function n(a,c,b,d,e){for(var f=[],n=0,g=c.length;n<g;++n)Object.prototype.hasOwnProperty.call(c,String(n))?f.push(w(a,c,b,d,String(n),!0)):f.push("");e.forEach(function(e){e.match(/^\d+$/)||f.push(w(a,
c,b,d,e,!0))});return f}function w(a,b,d,e,f,n){var g,p;b=Object.getOwnPropertyDescriptor(b,f)||{value:b[f]};b.get?p=b.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.set&&(p=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,f)||(g="["+f+"]");p||(0>a.seen.indexOf(b.value)?(p=null===d?c(a,b.value,null):c(a,b.value,d-1),-1<p.indexOf("\n")&&(p=n?p.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+p.split("\n").map(function(a){return"   "+
a}).join("\n"))):p=a.stylize("[Circular]","special"));if(r(g)){if(n&&f.match(/^\d+$/))return p;g=JSON.stringify(""+f);g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+p}function x(a,c,b){var d=0;return 60<a.reduce(function(a,c){d++;0<=c.indexOf("\n")&&d++;return a+c.replace(/\u001b\[\d\d?m/g,"").length+1},0)?b[0]+(""===c?"":c+"\n ")+" "+a.join(",\n  ")+
" "+b[1]:b[0]+c+" "+a.join(", ")+" "+b[1]}function z(a){return Array.isArray(a)}function v(a){return"boolean"===typeof a}function C(a){return"number"===typeof a}function q(a){return"string"===typeof a}function r(a){return void 0===a}function t(a){return l(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function l(a){return"object"===typeof a&&null!==a}function F(a){return l(a)&&"[object Date]"===Object.prototype.toString.call(a)}function D(a){return l(a)&&("[object Error]"===Object.prototype.toString.call(a)||
a instanceof Error)}function H(a){return"function"===typeof a}function A(a){return 10>a?"0"+a.toString(10):a.toString(10)}function y(){var a=new Date,c=[A(a.getHours()),A(a.getMinutes()),A(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],c].join(" ")}var I=/%[sdj%]/g;m.format=function(a){if(!q(a)){for(var c=[],b=0;b<arguments.length;b++)c.push(g(arguments[b]));return c.join(" ")}for(var b=1,d=arguments,e=d.length,c=String(a).replace(I,function(a){if("%%"===a)return"%";if(b>=e)return a;
switch(a){case "%s":return String(d[b++]);case "%d":return Number(d[b++]);case "%j":try{return JSON.stringify(d[b++])}catch(c){return"[Circular]"}default:return a}}),f=d[b];b<e;f=d[++b])c=null!==f&&l(f)?c+(" "+g(f)):c+(" "+f);return c};m.deprecate=function(a,c){if(r(h.process))return function(){return m.deprecate(a,c).apply(this,arguments)};if(!0===b.noDeprecation)return a;var d=!1;return function(){if(!d){if(b.throwDeprecation)throw Error(c);b.traceDeprecation?console.trace(c):console.error(c);d=
!0}return a.apply(this,arguments)}};var G={},E;m.debuglog=function(a){r(E)&&(E=b.env.NODE_DEBUG||"");a=a.toUpperCase();if(!G[a])if((new RegExp("\\b"+a+"\\b","i")).test(E)){var c=b.pid;G[a]=function(){var b=m.format.apply(m,arguments);console.error("%s %d: %s",a,c,b)}}else G[a]=function(){};return G[a]};m.inspect=g;g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,
39]};g.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};m.isArray=z;m.isBoolean=v;m.isNull=function(a){return null===a};m.isNullOrUndefined=function(a){return null==a};m.isNumber=C;m.isString=q;m.isSymbol=function(a){return"symbol"===typeof a};m.isUndefined=r;m.isRegExp=t;m.isObject=l;m.isDate=F;m.isError=D;m.isFunction=H;m.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===
typeof a||"symbol"===typeof a||"undefined"===typeof a};m.isBuffer=k("./support/isBuffer");var J="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");m.log=function(){console.log("%s - %s",y(),m.format.apply(m,arguments))};m.inherits=k("inherits");m._extend=function(a,c){if(!c||!l(c))return a;for(var b=Object.keys(c),d=b.length;d--;)a[b[d]]=c[b[d]];return a}}).call(this,k("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":8,
_process:7,inherits:6}],10:[function(k,l,m){function b(e){if(e instanceof b)return e;if(!(this instanceof b))return new b(e);g.call(this);var a=h(e),c=null,d=!1,p=!1,n=new Date(1E3*a.exp),w=a.grants||[];w.forEach(function(a){var b=a.res.match(/^sip:(.*)@/);b&&(c=b[1],d=-1!==a.act.indexOf("invite"),p=-1!==a.act.indexOf("listen"))});var x=this;setTimeout(function(){x.emit("expired",x)},n-Date.now());Object.defineProperties(this,{accountSid:{enumerable:!0,value:a.sub},address:{enumerable:!0,value:c},
canInvite:{enumerable:!0,value:d},canListen:{enumerable:!0,value:p},expires:{enumerable:!0,value:n},grants:{enumerable:!0,value:w},isExpired:{enumerable:!0,get:function(){return new Date>=n}},jwt:{enumerable:!0,value:e},signingKeySid:{enumerable:!0,value:a.iss}});return Object.freeze(this)}function h(b){b=b.split(".");if(3!==b.length)throw Error("Token is invalid or malformed");b=e.base64URL.decode(b[1]);return JSON.parse(b)}m=k("util").inherits;var g=k("events").EventEmitter,e=k("./util");m(b,g);
l.exports=b},{"./util":30,events:5,util:9}],11:[function(k,l,m){function b(c,e){if(!(this instanceof b))return new b(c,e);var f=this;g.call(this);var h=new Set,x=null,z=new Set,v=new a("Conversation",c._logLevel);Object.defineProperties(this,{_dialogs:{value:h},_endpoint:{value:c},_localMedia:{set:function(a){x=a}},_log:{value:v},localMedia:{enumerable:!0,get:function(){return x}},participants:{enumerable:!0,value:z},sid:{enumerable:!0,get:function(){var a=null;h.forEach(function(c){a=a||c.conversationSid});
return a}}});e=e||[];e.forEach(function(a){f._addDialog(a)});return Object.freeze(this)}var h=k("./util/constants"),g=k("events").EventEmitter;m=k("util").inherits;k("./media/track");var e=k("./participant"),f=k("q"),a=k("./util/log"),c=h.twilioErrors;m(b,g);b.prototype._addDialog=function(a){if(this._dialogs.has(a))return this;var c=this;this._localMedia=this.localMedia||a.localMedia;var b=new e(this,a);this._dialogs.add(a);this.participants.add(b);setTimeout(function(){c.emit("participantConnected",
b);setTimeout(function(){b.on("trackAdded",function x(a){if(!c.participants.has(b))return b.removeListener("trackAdded",x);c.emit("trackAdded",b,a)});b.on("trackRemoved",function z(a){if(!c.participants.has(b))return b.removeListener("trackRemoved",z);c.emit("trackRemoved",b,a)});b.media.audioTracks.forEach(function(a){b.emit("trackAdded",a)});b.media.videoTracks.forEach(function(a){b.emit("trackAdded",a)})})});a.once("ended",function(){c._removeDialog(a)});return this};b.prototype._removeDialog=
function(a){var c=this,b=null;this.participants.forEach(function(e){e._dialog===a&&(b=e,c.participants.delete(b))});this._dialogs.delete(a);this.emit("participantDisconnected",b);this._dialogs.size||this.emit("ended",this);return this};b.prototype.getStats=function(){var a=[];this._dialogs.forEach(function(c){a.push(c.getStats())});return f.all(a)};b.prototype.disconnect=function(){var a=this,c=[];this._dialogs.forEach(function(a){c.push(a.end())});return f.all(c).then(function(){return a})};b.prototype.invite=
function(a){a||this._log.throw(c.INVALID_ARGUMENT,"No address was provided");var b=!!a.forEach;a=b?a:[a];var e;this._dialogs.forEach(function(a){e=e||a});a=a.map(this._invite.bind(this,e));return b?a:a[0]};b.prototype._invite=function(a,b){function e(a){a.address===b&&(x.removeListener("participantConnected",e),g.resolve(a))}var g=f.defer(),x=this;this.on("participantConnected",e);setTimeout(function(){x.removeListener("participantConnected",e);var a=c.CONVERSATION_INVITE_TIMEOUT.clone("Invite to Participant timed out.");
x.emit("participantFailed",b,a);g.reject(a)},h.DEFAULT_CALL_TIMEOUT);a.refer(b).catch(function(a){x.emit("participantFailed",b,a);x.removeListener("participantConnected",e);g.reject(a)});return g.promise};Object.freeze(b.prototype);l.exports=b},{"./media/track":16,"./participant":17,"./util/constants":29,"./util/log":31,events:5,q:36,util:9}],12:[function(k,l,m){function b(e,g){if(!(this instanceof b))return new b(e,g);var n=this;a.call(this);g=z.withDefaults(g,{eventGateway:h.EVENT_GATEWAY,logLevel:h.DEFAULT_LOG_LEVEL,
userAgent:w});var v=g.logLevel;!0===g.debug&&(v="debug",console.warn("Warning: EndpointOptions.debug is deprecated and will be removed in a future release. Please see EndpointOptions.logLevel."));var k=new d("Endpoint",v);e=this._createToken(e,k);var l=null;g.iceServers&&(z.isValidIceServerArray(g.iceServers)||k.throw(f.INVALID_ARGUMENT,"Invalid ICE Servers"),l=new p(g.iceServers));var l=(l||z.fetchIceServers(e,{log:k})).then(function(a){a=z.separateIceServers(a);n._userAgent._stunServers=a.stunServers;
n._userAgent._turnServers=a.turnServers}),D=new Set,m=new Set,A=g.eventGateway,y=new Set,I=!1,G=new Map,E=new Set,J=new g.userAgent(e,g);J.on("invite",function(a){var b=a.conversationSid,d=a.participantSid,e=a.cookie,g=n._pendingConversations.get(e);if(g)return a.accept({localMedia:g.conversation.localMedia}).then(g.onReceiveInvite).catch(function(a){a=f.CONVERSATION_INVITE_FAILED.clone(a.message||a);g.conversation.emit("participantFailed",a)});if(D.has(e))return a.reject();var p=null;m.forEach(function(a){a.sid===
b&&(p=p||a)});if(p)return a.accept({localMedia:p.localMedia}).then(p._addDialog.bind(p));if(E.has(b+d))return a.reject();var w=null;y.forEach(function(a){a.conversationSid===b&&a.participantSid===d&&(w=w||a)});if(w)return w._inviteServerTransactions.push(a);if(!n.isListening)return a.reject();var x=new c(n,a);y.add(x);x._promise.then(function(a){y.delete(x);m.add(a);a.once("ended",function(){m.delete(a);n._unregisterIfNotNeeded()})},function(){y.delete(x);n._unregisterIfNotNeeded();E.add(b+d);setTimeout(function(){E.delete(b+
d)},3*h.DEFAULT_CALL_TIMEOUT)});n.emit("invite",x)});J.on("dialogCreated",function(a){new x(A,a,v)});Object.defineProperties(this,{_canceledConversations:{value:D},_fetchIceServers:{value:l},_isListening:{set:function(a){I=a}},_isRegistered:{enumerable:!0,get:function(){return this._userAgent.isRegistered}},_log:{value:k},_logLevel:{value:v},_pendingConversations:{value:G},_needsRegistration:{get:function(){return I||G.size||m.size||y.size||J.inviteClientTransactions.size}},_options:{value:g},_userAgent:{value:J},
address:{enumerable:!0,get:function(){return this._userAgent.token.address}},conversations:{enumerable:!0,value:m},invites:{enumerable:!0,value:y},isListening:{enumerable:!0,get:function(){return I}},token:{enumerable:!0,get:function(){return this._userAgent.token}}});return Object.freeze(this)}m=k("util").inherits;var h=k("./util/constants"),g=k("./conversation"),e=k("./util/cancelablepromise"),f=h.twilioErrors,a=k("events").EventEmitter;k("./webrtc/getusermedia");var c=k("./invite"),d=k("./util/log"),
p=k("q"),n=k("./accesstoken"),w=k("./signaling/sipjsuseragent"),x=k("./statsreporter"),z=k("./util"),v=k("./media").LocalMedia;m(b,a);b.prototype.unlisten=function(){this._isListening=!1;return this._unregisterIfNotNeeded()};b.prototype._unregister=function(){if(!this._isRegistered)return new p(this);var a=this;return this._userAgent.unregister().then(function(){a._isListening=!1;return a})};b.prototype.listen=function(a){return!this.isListening||a&&a!==this.token?this._register(a).then(function(a){a._isListening=
!0;return a}):(a=p.defer(),setTimeout(a.resolve.bind(a,this)),a.promise)};b.prototype._register=function(a){var c=this;return this._fetchIceServers.then(function(){a=c._createToken.call(c,a);return c._userAgent.register(a)}).then(function(){return c},function(a){var b=z.getOrNull(a,"headers.X-Twilio-Error.0.raw");(a=a.cause)?c._log.throw(f.LISTEN_FAILED,"Received SIP error: "+a):c._log.throw(f.LISTEN_FAILED,"Gateway responded with: "+b)})};b.prototype.createConversation=function(a,c){function b(a){x._addDialog(a);
x.once("ended",function(){m.conversations.delete(x);m._unregisterIfNotNeeded()});m.conversations.add(x);a=k.promise;a.isFulfilled()||a.isRejected()||k.resolve(x)}c=z.withDefaults({},c,this._options);var d=c.localMedia,n=c.localStreamConstraints,w=c.localStream;!d||d instanceof v||this._log.throw(f.INVALID_ARGUMENT,"Invalid local media");w&&"object"!==typeof w&&this._log.throw(f.INVALID_ARGUMENT,"Invalid local media stream");n&&"undefined"===typeof n.audio&&"undefined"===typeof n.video&&this._log.throw(f.INVALID_ARGUMENT,
"Invalid local media stream constraints");a||this._log.throw(f.INVALID_ARGUMENT,"No address was provided");a=a.forEach?a:[a];var x=new g(this),k=p.defer(),A=null,l=!1,m=this,G=this._userAgent;if(1<a.length){var E=z.makeUUID();c.cookie=E;this._pendingConversations.set(E,{conversation:x,onReceiveInvite:b});setTimeout(function(){m._pendingConversations.delete(E);m._canceledConversations.delete(E);m._unregisterIfNotNeeded()},3*h.DEFAULT_CALL_TIMEOUT)}(d?new p(d):v.getLocalMedia(c)).catch(function(a){-1<
["PermissionDeniedError","PERMISSION_DENIED"].indexOf(a.name)&&(a=f.MEDIA_ACCESS_DENIED);k.reject(a)}).then(function(a){x._localMedia=a;c.localMedia=a}).then(this._register.bind(this)).then(function(){if(l)throw Error("canceled");return A=G.invite(a,c)}).catch(function(a){switch(a.message){case "canceled":a=f.CONVERSATION_INVITE_CANCELED;break;case "rejected":a=f.CONVERSATION_INVITE_REJECTED;break;case "ignored":a=f.CONVERSATION_INVITE_TIMEOUT;break;default:a=f.CONVERSATION_CREATE_FAILED}k.reject(a)}).then(b);
d=new e(k.promise);d.catch(function(a){"canceled"===a.message&&(m._canceledConversations.add(E),m._pendingConversations.delete(E),A?A.cancel():l=!0,m._unregisterIfNotNeeded());m._log.throw(a)});return d};b.prototype._createToken=function(a,c){if(!a)return this.token;c=c||this._log;try{a=new n(a)}catch(b){c.throw(f.INVALID_TOKEN,b.message)}var d=this;a.once("expired",function(a){a===d.token&&d.emit("error",f.TOKEN_EXPIRED)});return a};b.prototype._unregisterIfNotNeeded=function(){return this._needsRegistration?
new p(this):this._unregister()};Object.freeze(b.prototype);l.exports=b},{"./accesstoken":10,"./conversation":11,"./invite":14,"./media":15,"./signaling/sipjsuseragent":25,"./statsreporter":27,"./util":30,"./util/cancelablepromise":28,"./util/constants":29,"./util/log":31,"./webrtc/getusermedia":35,events:5,q:36,util:9}],13:[function(k,l,m){function b(h,g){return new b.Endpoint(h,g)}Object.defineProperties(b,{AccessToken:{enumerable:!0,value:k("./accesstoken")},Endpoint:{enumerable:!0,value:k("./endpoint")},
getUserMedia:{enumerable:!0,value:k("./webrtc/getusermedia")},LocalMedia:{enumerable:!0,value:k("./media").LocalMedia}});l.exports=b},{"./accesstoken":10,"./endpoint":12,"./media":15,"./webrtc/getusermedia":35}],14:[function(k,l,m){function b(a,d){if(!(this instanceof b))return new b(a,d);var f=this;g.call(this);var n=null,h=d.from,x=d.participantSid,z=d.to,v=e.defer(),k=[d];Object.defineProperties(this,{_conversation:{set:function(a){n=a},get:function(){return n}},_deferred:{value:v},_endpoint:{value:a},
_inviteServerTransaction:{value:d},_inviteServerTransactions:{value:k},_promise:{value:v.promise},accepted:{enumerable:!0,get:function(){return k.reduce(function(a,c){return a||c.accepted},!1)}},canceled:{enumerable:!0,get:function(){return k.reduce(function(a,c){return a&&c.canceled},!0)}},conversationSid:{enumerable:!0,value:d.conversationSid},from:{enumerable:!0,value:h},participantAddresses:{enumerable:!0,get:function(){return k.map(function(a){return a.from})}},participantSid:{value:x},rejected:{enumerable:!0,
get:function(){return k.reduce(function(a,c){return a||c.accepted},!1)?!1:k.reduce(function(a,c){return a||c.rejected},!1)}},status:{enumerable:!0,get:function(){switch(!0){case this.accepted:return"accepted";case this.rejected:return"rejected";case this.canceled:return"canceled";default:return"pending"}}},to:{enumerable:!0,value:z}});d.once("canceled",function(){f.emit("canceled",f)});return Object.freeze(this)}var h=k("./conversation"),g=k("events").EventEmitter;m=k("util").inherits;var e=k("q"),
f=k("./util"),a=k("./media").LocalMedia;m(b,g);b.prototype.accept=function(c){var b=this;if(this.accepted)return new e(this._conversation);c=c||{};return a.getLocalMedia(c).then(function(a){c.localMedia=a;a=b._inviteServerTransactions.map(function(a){return a.accept(c).then(function(a){b._conversation||(b._conversation=new h(b._endpoint),b._deferred.resolve(b._conversation));b._conversation._addDialog(a);return a})});return f.race(a).then(function(){setTimeout(function(){b.emit("accepted",b)});return b._conversation},
function(a){setTimeout(function(){b.emit("failed",b)});b._deferred.reject(a);throw a;})})};b.prototype.reject=function(){var a=this;return this.rejected?new e(this):this._inviteServerTransaction.reject().then(function(){setTimeout(function(){a.emit("rejected",a)});return a},function(b){setTimeout(function(){a.emit("rejected",a)});return a})};Object.freeze(b.prototype);l.exports=b},{"./conversation":11,"./media":15,"./util":30,events:5,q:36,util:9}],15:[function(k,l,m){function b(a){c.call(this);a=
new Map;var b=new Set,d=new Set,e=new Set;Object.defineProperties(this,{attachments:{enumerable:!0,value:a},audioTracks:{enumerable:!0,value:b},mediaStreams:{enumerable:!0,value:d},muted:{enumerable:!0,get:function(){var a=!0;b.forEach(function(c){a=a&&c.muted});return a},set:function(a){b.forEach(function(c){c.muted=a})}},paused:{enumerable:!0,get:function(){var a=!0;e.forEach(function(c){a=a&&c.paused});return a},set:function(a){e.forEach(function(c){c.paused=a})}},videoTracks:{enumerable:!0,value:e}});
return this}function h(a,c){if(a.attachments.has(c))return c;var b=new Map;[a.audioTracks,a.videoTracks].forEach(function(d){d.forEach(function(d){a._attachTrack(c,b,d)},a)},a);a.on("trackAdded",function q(d){if(!a.attachments.has(c))return a.removeListener("trackAdded",q);a._attachTrack(c,b,d)});a.attachments.set(c,b);return c}function g(a,c){if(!a.attachments.has(c))return c;var b=a.attachments.get(c);a.attachments.delete(c);b.forEach(function(d,e){a._detachTrack(c,b,e)});return c}function e(a){var c=
[];a.attachments.forEach(function(b,d){c.push(d);g(a,d)});return c}function f(){if(!(this instanceof f))return new f;b.call(this);var a=null;Object.defineProperties(this,{_needs:{value:new Set},_nextUserMedia:{get:function(){return a},set:function(c){a=c}}});return Object.freeze(this)}function a(a){this.mediaStreams.add(a);a.getAudioTracks().forEach(function(c){c=new n(a,c);this._addTrack(c)},this);a.getVideoTracks().forEach(function(c){c=new w(a,c);this._addTrack(c)},this);return this}var c=k("events").EventEmitter,
d=k("../webrtc/getusermedia");m=k("util").inherits;var p=k("q");k=k("./track");var n=k.AudioTrack,w=k.VideoTrack;m(b,c);b.prototype._addStream=a;b.prototype._addTrack=function(a){var c=this;this.mediaStreams.add(a.mediaStream);("audio"===a.kind?this.audioTracks:this.videoTracks).add(a);a.once("ended",function(b){c._removeTrack(a)});this.emit("trackAdded",a);return this};b.prototype._attachTrack=function(a,c,b){var d=this,e=b.attach();this instanceof f&&b instanceof n&&(e.muted=!0);a.appendChild(e);
c.set(b,e);b.once("ended",function(){d._detachTrack(a,c,b)});return this};b.prototype._detachTrack=function(a,c,b){var d=c.get(b);if(!d)return this;b.detach(d);a.removeChild(d);c.delete(b);return this};b.prototype._removeTrack=function(a){this.mediaStreams.delete(a.mediaStream);("audio"===a.kind?this.audioTracks:this.videoTracks).delete(a);this.emit("trackRemoved",a);return this};b.prototype.attach=function(a){if(a){if("string"===typeof a){if("undefined"===typeof document)throw Error("document is undefined");
a=document.querySelector(a);if(!a)throw Error("document.querySelector returned nothing");return this.attach(a)}return h(this,a)}if("undefined"===typeof document)throw Error("document is undefined");return this.attach(document.createElement("div"))};b.prototype.detach=function(a){if(a){if("string"===typeof a){if("undefined"===typeof document)throw Error("document is undefined");a=document.querySelector(a);if(!a)throw Error("document.querySelector returned nothing");}return g(this,a)}return e(this)};
f.getLocalMedia=function(a){a=a||{};if(a.localMedia)return new p(a.localMedia);var c=new f;return a.localStream?(c.addStream(a.localStream),new p(c.addStream(a.localStream))):d(a.localStreamConstraints).then(function(a){return c.addStream(a)})};m(f,b);f.prototype.addMicrophone=function(){var a=this,c=null;this.audioTracks.forEach(function(a){c=c||"microphone"===a.label&&a});return c?new p(c):d({audio:!0,video:!1}).then(function(c){var b=c.getAudioTracks()[0];c=new n(c,b);a._addTrack(c);return c})};
f.prototype.removeMicrophone=function(){var a=null;this.audioTracks.forEach(function(c){a=a||"microphone"===c.label&&c});return a?this._removeTrack(a):null};f.prototype.addCamera=function(){var a=this,c=null;this.videoTracks.forEach(function(a){c=c||"camera"===a.label&&a});return c?new p(c):d({audio:!1,video:!0}).then(function(c){var b=c.getVideoTracks()[0];c=new w(c,b);a._addTrack(c);return c})};f.prototype.removeCamera=function(){var a=null;this.videoTracks.forEach(function(c){a=a||"camera"===c.label&&
c});return a?this._removeTrack(a):null};f.prototype.addStream=a;f.prototype._removeTrack=function(a){var c=this;b.prototype._removeTrack.call(this,a);a.mediaStream.stop();[this.audioTracks,this.videoTracks].forEach(function(b){b.forEach(function(b){b.mediaStream===a.mediaStream&&(this._removeTrack(b),this._needs.add(b.label),this._nextUserMedia||(this._nextUserMedia=setTimeout(function(){c._nextUserMedia=null;var a=c._needs.has("camera");c._needs.delete("camera");var b=c._needs.has("microphone");
c._needs.delete("microphone");if(a||b)a&&!b?c.addCamera():b&&!a?c.addMicrophone():d().then(c.addStream.bind(c))})))},this)},this);this._needs.delete(a.label);return a};f.prototype.stop=function(){[this.audioTracks,this.videoTracks].forEach(function(a){a.forEach(function(a){a.stop()})});return this};b.LocalMedia=f;l.exports=b},{"../webrtc/getusermedia":35,"./track":16,events:5,q:36,util:9}],16:[function(k,l,m){function b(a,c){w.call(this);Object.defineProperties(this,{label:{enumerable:!0,value:"audio"===
c.kind?"microphone":"camera"},kind:{enumerable:!0,value:c.kind},mediaStream:{enumerable:!0,value:a},mediaStreamTrack:{enumerable:!0,value:c}});var b=this;c.onended=function(){b.emit("ended",b)}}function h(a,c){if(!(this instanceof h))return new h(a,c);b.call(this,a,c);Object.defineProperties(this,{muted:{enumerable:!0,get:function(){return!c.enabled},set:function(a){c.enabled=!a}},attachments:{enumerable:!0,value:new Set}});return Object.freeze(this)}function g(a,c){if("undefined"!==typeof window&&
"undefined"!==typeof navigator)return"function"===typeof navigator.webkitGetUserMedia?a.src=(window.URL||window.webkitURL).createObjectURL(c):"function"===typeof navigator.mozGetUserMedia&&(a.mozSrcObject=c),a.play(),a;throw Error("Cannot attach to <audio> element");}function e(a,c){if(!(this instanceof e))return new e(a,c);b.call(this,a,c);Object.defineProperties(this,{paused:{enumerable:!0,get:function(){return!c.enabled},set:function(a){c.enabled=!a}},attachments:{value:new Set}});a.onaddtrack=
function(){this.attachments.forEach(function(c){d(this,c);f(c,a)},this)}.bind(this);return Object.freeze(this)}function f(a,c){if("undefined"!==typeof window&&"undefined"!==typeof navigator)return"function"===typeof navigator.webkitGetUserMedia?a.src=(window.URL||window.webkitURL).createObjectURL(c):"function"===typeof navigator.mozGetUserMedia&&(a.mozSrcObject=c),a.muted=!0,a.play(),a;throw Error("Cannot attach to <video> element");}function a(a,b){if(b){if("string"===typeof b){if("undefined"===
typeof document)throw Error("document is undefined");var d=document.querySelector(b);if(!d)throw Error("document.querySelector returned nothing");return c(a,d)}return c(a,b)}if("undefined"===typeof document)throw Error("document is undefined");d=document.createElement(a.kind);return c(a,d)}function c(a,c){if(a.attachments.has(c))return c;("audio"===a.kind?g:f)(c,a.mediaStream);a.attachments.add(c);return c}function d(a,c){if(c){if("string"===typeof c){if("undefined"===typeof document)throw Error("document is undefined");
var b=document.querySelector(c);if(!b)throw Error("document.querySelector returned nothing");return p(a,b)}return p(a,c)}return n(a)}function p(a,c){if(!a.attachments.has(c))return c;c.removeAttribute("src");a.attachments.delete(c);return c}function n(a){var c=[];a.attachments.forEach(function(b){c.push(b);p(a,b)});return c}var w=k("events").EventEmitter;k=k("util").inherits;k(b,w);b.prototype.stop=function(){this.mediaStreamTrack.stop();return this};k(h,b);h.prototype.attach=function(c){return a(this,
c)};h.prototype.detach=function(a){return d(this,a)};k(e,b);e.prototype.attach=function(c){return a(this,c)};e.prototype.detach=function(a){return d(this,a)};b.AudioTrack=h;b.VideoTrack=e;l.exports=b},{events:5,util:9}],17:[function(k,l,m){function b(e,f){if(!(this instanceof b))return new b(e,f);h.call(this);var a=f.remoteMedia,c=f&&g.getOrNull(f,"session.mediaHandler.peerConnection");Object.defineProperties(this,{_dialog:{value:f},address:{enumerable:!0,value:f.remote},conversation:{enumerable:!0,
value:e},media:{enumerable:!0,value:a},peerConnection:{enumerable:!0,value:c},sid:{enumerable:!0,value:null}});a.on("trackAdded",this.emit.bind(this,"trackAdded"));a.on("trackRemoved",this.emit.bind(this,"trackRemoved"));return Object.freeze(this)}var h=k("events").EventEmitter;m=k("util").inherits;var g=k("./util");m(b,h);Object.freeze(b.prototype);l.exports=b},{"./util":30,events:5,util:9}],18:[function(k,l,m){function b(a,c,b,e,f,w,x){function k(a,c){if(v.ended)f.removeListener("trackAdded",r),
f.removeListener("trackRemoved",t);else{var b=!a,d=x.getLocalStreams();if(d){var e=!1;d.forEach(function(a){a===c.mediaStream&&(e=!0)});a&&!e?(x.addStream(c.mediaStream),v._reinvite()):b&&e&&(x.removeStream(c.mediaStream),v._reinvite())}}}var v=this;g.call(this);var l=!1,q=null;Object.defineProperties(this,{_ended:{set:function(a){l=a}},_sampleInterval:{get:function(){return q},set:function(a){q=a}},callSid:{enumerable:!0,value:e},conversationSid:{enumerable:!0,value:b},ended:{enumerable:!0,get:function(){return l}},
localMedia:{enumerable:!0,value:f},peerConnection:{enumerable:!0,value:x},remote:{enumerable:!0,value:c},remoteMedia:{enumerable:!0,value:w},userAgent:{enumerable:!0,value:a}});var r=k.bind(null,!0),t=k.bind(null,!1);f.on("trackAdded",r);f.on("trackRemoved",t);try{h(this,1E3)}catch(m){throw console.error(m),m;}return this}function h(a,c){var b=a.peerConnection;a._sampleInterval=setInterval(function(){e(b,function(c,b){c||a.emit("stats",b)})},c);a.once("ended",function(){a._sampleInterval&&(clearInterval(a._sampleInterval),
a._sampleInterval=null)})}var g=k("events").EventEmitter,e=k("../webrtc/getstatistics");m=k("util").inherits;var f=k("q");m(b,g);b.prototype.end=function(){if(this.ended)throw Error("Dialog already ended");this._ended=!0;var a=this,c=f.defer();setTimeout(function(){c.resolve(a);a.emit("ended",a)});return c.promise};b.prototype._reinvite=function(){var a=this,c=f.defer();setTimeout(function(){c.resolve(a);a.emit("reinvite",a)});return c.promise};b.prototype.refer=function(a){return this._refer(a).then(this._onReferSuccess.bind(this),
this._onReferFailure.bind(this))};b.prototype._refer=function(a){var c=this,b=f.defer();setTimeout(function(){b.resolve(c)});return b.promise};b.prototype._onReferSuccess=function(){return this};b.prototype._onReferFailure=function(a){throw a;};b.prototype.getStats=function(){var a=this,c=f.defer();e(this.peerConnection,function(b,e){if(b)return c.reject(b);c.resolve({callsid:a.callSid,samples:[e]})});return c.promise};l.exports=b},{"../webrtc/getstatistics":34,events:5,q:36,util:9}],19:[function(k,
l,m){function b(b){var f=this;h.call(this);var a=!1,c=!1,d=!1,p=!1,n=null,w=g.defer(),x=w.promise.then(function(a){n=a;setTimeout(function(){f.emit("accepted",n)});return n},function(a){switch(!0){case f.canceled:setTimeout(function(){f.emit("canceled",a)});break;case f.rejected:setTimeout(function(){f.emit("rejected",a)});break;default:setTimeout(function(){f.emit("failed",a)})}throw a;});Object.defineProperties(this,{_accepted:{set:function(c){a=c}},_canceled:{set:function(a){c=a}},_deferred:{value:w},
_failed:{set:function(a){d=a}},_promise:{value:x},_rejected:{set:function(a){p=a}},accepted:{enumerable:!0,get:function(){return a}},canceled:{enumerable:!0,get:function(){return c}},dialog:{enumerable:!0,get:function(){return n}},failed:{enumerable:!0,get:function(){return d}},rejected:{enumerable:!0,get:function(){return p}},userAgent:{enumerable:!0,value:b}});return this}var h=k("events").EventEmitter;m=k("util").inherits;var g=k("q");b._checkInviteTransactionState=function(b){if(b.accepted)throw Error("InviteTransaction already accepted");
if(b.canceled)throw Error("InviteTransaction already canceled");if(b.rejected)throw Error("InviteTransaction already rejected");if(b.failed)throw Error("InviteTransaction failed");};m(b,h);b.prototype.then=function(b,f){return this._promise.then(b,f)};Object.freeze(b.prototype);l.exports=b},{events:5,q:36,util:9}],20:[function(k,l,m){function b(b,f,a){h.call(this,b,f,a);a=g.withDefaults(a,{});var c=a.localMedia;Object.defineProperties(this,{_media:{set:function(a){c=a}},media:{enumerable:!0,get:function(){return c}},
to:{enumerable:!0,value:f}})}m=k("util").inherits;var h=k("./");k("q");var g=k("../../util");m(b,h);b.prototype.cancel=function(){var b=this;setTimeout(function(){try{h._checkInviteTransactionState(b)}catch(f){return}b._canceled=!0;b._deferred.reject(b)});return this.then(function(){h._checkInviteTransactionState(b)},function(b){if(b.canceled)return b;h._checkInviteTransactionState(b)})};l.exports=b},{"../../util":30,"./":19,q:36,util:9}],21:[function(k,l,m){function b(b,f,a,c,d,g){h.call(this,b);
Object.defineProperties(this,{callSid:{enumerable:!0,value:c},conversationSid:{enumerable:!0,value:a},cookie:{enumerable:!0,value:g},from:{enumerable:!0,value:f},participantSid:{value:d}});return this}m=k("util").inherits;var h=k("./"),g=k("../../util");m(b,h);b.prototype.accept=function(b){var f=this;b=g.withDefaults(b,{});setTimeout(function(){try{h._checkInviteTransactionState(f)}catch(a){return}f._accepted=!0;f._deferred.resolve(f.dialog)});return this.then(function(){h._checkInviteTransactionState(f);
return f},function(a){throw a;})};b.prototype.reject=function(){var b=this;setTimeout(function(){try{h._checkInviteTransactionState(b)}catch(f){return}b._rejected=!0;b._deferred.reject(b)});return this.then(function(){h._checkInviteTransactionState(b)},function(b){throw b;})};l.exports=b},{"../../util":30,"./":19,util:9}],22:[function(k,l,m){function b(g,w,x){if(!(this instanceof b))return new b(g,w,x);var k=this;e.call(this,g);x=c.withDefaults(x,{stunServers:g.stunServers,turnServers:g.turnServers});
w=w.forEach?w:[w];var v=x.callTimeout||f.DEFAULT_CALL_TIMEOUT,l=null,q=null;g.connect().then(function(){return p.getLocalMedia(x)}).then(function(b){k._media=b;if(k.canceled)return k._deferred.reject(Error("canceled"));q=h(g,w,x,b);l=setTimeout(function(){k.cancel();k._deferred.reject(Error("ignored"))},v);var e=Date.now(),f=null;q.on("progress",function(a){180===a.statusCode&&(f=Date.now())});q.once("accepted",function(p){var h=p.getHeader("X-Twilio-CallSid"),x=q.mediaHandler.peerConnection,v=new d(x);
q.mediaHandler.on("addStream",function(a){v._addStream(a.stream)});var m=f?f-e:null;p=c.parseConversationSIDFromContactHeader(p.getHeader("Contact"));h=new a(g,w[0],p,h,b,v,x,q,m);clearTimeout(l);k._deferred.resolve(h)});q.once("rejected",function(a){clearTimeout(l);a&&600===a.status_code?(k._rejected=!0,k._deferred.reject(Error("rejected"))):(k._failed=!0,k._deferred.reject(Error("failed")))});q.once("failed",function(){k.accepted&&k.canceled||(k._failed=!0,clearTimeout(l),k._deferred.reject(Error("failed")))})}).then(null,
function(a){k._failed=!0;l&&clearTimeout(l);k._deferred.reject(a)});Object.defineProperties(this,{session:{enumerable:!0,get:function(){return q}}});return Object.freeze(this)}function h(a,c,b,d){var e=a.token,g=c.map(function(a){return"sip:"+a+"@"+f.REGISTRAR_SERVER(e.accountSid)});c=g.shift();var p=[f.headers.X_TWILIO_TOKEN+": "+e.jwt,f.headers.X_TWILIO_CLIENT+": "+JSON.stringify({p:"browser"}),f.headers.X_TWILIO_CLIENTVERSION+": "+f.CLIENT_VERSION];g.length&&(g=g.join(",")+";cookie="+b.cookie,
p.push(f.headers.X_TWILIO_PARTICIPANTS+": "+g));var h=[];d.mediaStreams.forEach(function(a){h.push(a)});return a._ua.invite(c,{extraHeaders:p,inviteWithoutSdp:b.inviteWithoutSdp,media:{stream:h[0]},RTCConstraints:f.DEFAULT_OFFER_OPTIONS,stunServers:b.stunServers,turnServers:b.turnServers})}m=k("util").inherits;var g=k("./"),e=k("./inviteclienttransaction");k("q");var f=k("../../util/constants"),a=k("../sipjsdialog"),c=k("../../util"),d=k("../../media"),p=d.LocalMedia;m(b,e);b.prototype.cancel=function(){var a=
this;setTimeout(function(){try{g._checkInviteTransactionState(a)}catch(c){return}a.session?(a.session.once("cancel",function(){try{g._checkInviteTransactionState(a)}catch(c){return}a._canceled=!0;a._deferred.reject(a)}),a.session.cancel()):a._canceled=!0});return this.then(function(){g._checkInviteTransactionState(a)},function(a){if(a.canceled)return a;g._checkInviteTransactionState(a)})};Object.freeze(b.prototype);l.exports=b},{"../../media":15,"../../util":30,"../../util/constants":29,"../sipjsdialog":24,
"./":19,"./inviteclienttransaction":20,q:36,util:9}],23:[function(k,l,m){function b(a,d){if(!(this instanceof b))return new b(a,d);var p=d.request,k=p.from.uri.user,v=c.parseConversationSIDFromContactHeader(p.getHeader("Contact")),l=p.getHeader(g.X_TWILIO_CALLSID),q=p.getHeader(g.X_TWILIO_PARTICIPANTSID),p=(q=q?q.split(";"):null)?q[0]:null,r=/^cookie=([^\s]+)/i,q=q&&q[1]&&r.test(q[1])&&q[1].match(r)[1];e.call(this,a,k,v,l,p,q);Object.defineProperties(this,{session:{enumerable:!0,value:d}});var t=
this;d.once("cancel",function(){try{f._checkInviteTransactionState(t)}catch(a){return}t._canceled=!0;var c=h.CONVERSATION_JOIN_CANCELED.clone();t._deferred.reject(c)});d.once("failed",function(a){try{f._checkInviteTransactionState(t)}catch(b){return}t._failed=!0;a=c.getOrNull(a,"headers.X-Twilio-Error.0.raw")||"An unknown error occurred";a=h.CONVERSATION_JOIN_FAILED.clone(a);t._deferred.reject(a)});return Object.freeze(this)}var h=k("../../util/constants").twilioErrors,g=k("../../util/constants").headers;
m=k("util").inherits;var e=k("./inviteservertransaction"),f=k("./"),a=k("../sipjsdialog");k("q");var c=k("../../util"),d=k("../../media"),p=d.LocalMedia;m(b,e);b.prototype.accept=function(b){var e=this;f._checkInviteTransactionState(this);b=c.withDefaults(b,{});p.getLocalMedia(b).then(function(c){var g=[];c.mediaStreams.forEach(function(a){g.push(a)});b.media=b.media||{};b.media.stream=g[0];e.session.accept(b);e.session.once("accepted",function(){try{f._checkInviteTransactionState(e)}catch(b){return}var g=
null,n=e.session.mediaHandler.peerConnection,p=new d(n);e.session.mediaHandler.on("addStream",function(a){a&&p._addStream(a.stream)});(n.getRemoteStreams()||[]).forEach(p._addStream,p);if(!e.session.hasOffer)g=new a(e.userAgent,e.from,e.conversationSid,e.callSid,c,p,n,e.session,null),e._accepted=!0,e._deferred.resolve(g);else if(e.session.hasOffer&&e.session.hasAnswer)g=new a(e.userAgent,e.from,e.conversationSid,e.callSid,c,p,n,e.session,null),e._accepted=!0,e._deferred.resolve(g);else if(e.session.hasOffer&&
!e.session.hasAnswer)e.session.mediaHandler.once("addStream",function(){g=new a(e.userAgent,e.from,e.conversationSid,e.callSid,c,p,n,e.session,null);e._accepted=!0;e._deferred.resolve(g)})})});return this};b.prototype.reject=function(){var a=this;setTimeout(function(){try{f._checkInviteTransactionState(a)}catch(c){return}a.session.once("rejected",function(){try{f._checkInviteTransactionState(a)}catch(c){return}a._rejected=!0;a._deferred.reject(a)});a.session.reject({statusCode:600})});return this.then(function(){f._checkInviteTransactionState(a)},
function(a){if(a.rejected)return a;f._checkInviteTransactionState(a)})};Object.freeze(b.prototype);l.exports=b},{"../../media":15,"../../util":30,"../../util/constants":29,"../sipjsdialog":24,"./":19,"./inviteservertransaction":21,q:36,util:9}],24:[function(k,l,m){function b(a,c,d,e,g,w,k,l,v){if(!(this instanceof b))return new b(a,c,d,e,g,w,k,l,v);var m=this;h.call(this,a,c,d,e,g,w,k);Object.defineProperties(this,{inviteTo180:{enumerable:!0,value:v},session:{enumerable:!0,value:l}});k.oniceconnectionstatechange=
function(a){switch(a.target.iceConnectionState){case "failed":return m.emit("failed",f.ICE_CONNECT_FAILED);case "disconnected":return m.emit("disconnected",f.ICE_DISCONNECTED)}};l.once("failed",function(){m._ended=!0;m.emit("failed",m)});l.once("bye",function(){m._ended=!0;m.emit("ended",m)});return Object.freeze(this)}var h=k("./dialog");m=k("util").inherits;var g=k("q"),e=k("../util/constants"),f=e.twilioErrors;m(b,h);b.prototype.end=function(){if(this.ended)throw Error("Dialog already ended");
this._ended=!0;var a=this,c=g.defer();a.session.once("bye",function(){c.resolve(a);a.emit("ended",a)});a.session.bye();return c.promise};b.prototype._reinvite=function(){this.session.mediaHandler.RTCConstraints=e.DEFAULT_OFFER_OPTIONS;this.session.sendReinvite()};b.prototype._refer=function(a){var c=this,b=g.defer();c.session.refer(a,{receiveResponse:function(a){202==a.status_code?b.resolve(c):b.reject(a)}});return b.promise};Object.freeze(b.prototype);l.exports=b},{"../util/constants":29,"./dialog":18,
q:36,util:9}],25:[function(k,l,m){function b(c,e){if(!(this instanceof b))return new b(c,e);var k=c.accountSid,l=c.address+"@"+g.REGISTRAR_SERVER(k);e=p.withDefaults(e,{inviteClientTransactionFactory:a,logLevel:g.DEFAULT_LOG_LEVEL,registrarServer:g.REGISTRAR_SERVER(k),wsServer:g.WS_SERVER(k),uaFactory:f.UA});var k="debug"===e.logLevel,v=/^wss:\/\//.test(e.wsServer),m=h.call(this,new e.uaFactory({autostart:!1,log:{builtinEnabled:k},register:!1,registrarServer:e.registrarServer,traceSip:k,uri:l,wsServers:e.wsServer,
hackWssInTransport:v})),q=[],r=[];Object.defineProperties(this,{_ua:{value:m},_stunServers:{set:function(a){q=a;p.overwriteArray(m.configuration.stunServers,q)}},_turnServers:{set:function(a){r=a;p.overwriteArray(m.configuration.turnServers,r)}},stunServers:{enumerable:!0,get:function(){return q}},turnServers:{enumerable:!0,get:function(){return r}}});d.call(this,c,e);return Object.freeze(this)}function h(a){var b=this;a.on("invite",function(a){a=new c(b,a);b._handleInviteServerTransaction(a)});return a}
var g=k("../util/constants");m=k("util").inherits;var e=k("q");k("../conversation");k("../accesstoken");var f=k("sip.js");k("./sipjsdialog.js");var a=k("./invitetransaction/sipjsinviteclienttransaction.js"),c=k("./invitetransaction/sipjsinviteservertransaction"),d=k("./useragent"),p=k("../util");m(b,d);b.prototype._register=function(a){var c=this;return p.promiseFromEvents(function(){var b=p.makeRegisterHeaders(a);c._ua.register({extraHeaders:b,closeWithHeaders:!0})},this._ua,"registered","registrationFailed").then(function(){return c})};
b.prototype._unregister=function(){var a=this,c=a.token;return p.promiseFromEvents(function(){var b=p.makeRegisterHeaders(c);a._ua.unregister({extraHeaders:b})},this._ua,"unregistered").then(function(){return a})};b.prototype._connect=function(){var a=this;return p.promiseFromEvents(function(){a._ua.start()},this._ua,"connected","disconnected").then(function(){return a})};b.prototype._disconnect=function(){this._ua.stop();this._ua.transport.disconnect();var a=e.defer();setTimeout(a.resolve.bind(null,
this));return a.promise};Object.freeze(b.prototype);l.exports=b},{"../accesstoken":10,"../conversation":11,"../util":30,"../util/constants":29,"./invitetransaction/sipjsinviteclienttransaction.js":22,"./invitetransaction/sipjsinviteservertransaction":23,"./sipjsdialog.js":24,"./useragent":26,q:36,"sip.js":71,util:9}],26:[function(k,l,m){function b(a,c){h.call(this);c=f.withDefaults(c,{inviteClientTransactionFactory:g});var b=!1,e=!1;Object.defineProperties(this,{_inviteClientTransactionFactory:{value:c.inviteClientTransactionFactory},
_isConnected:{set:function(a){e=a}},_isRegistered:{set:function(a){b=a}},_token:{set:function(c){a=c}},callTimeout:{value:c&&c.callTimeout},dialogs:{enumerable:!0,value:new Set},inviteClientTransactions:{enumerable:!0,value:new Set},inviteServerTransactions:{enumerable:!0,value:new Set},isConnected:{enumerable:!0,get:function(){return e}},isRegistered:{enumerable:!0,get:function(){return b}},token:{enumerable:!0,get:function(){return a}}});if(!this.stunServers){var n=[];Object.defineProperties(this,
{_stunServers:{set:function(a){n=a}},stunServers:{enumerable:!0,get:function(){return n}}})}if(!this.turnServers){var w=[];Object.defineProperties(this,{_turnServers:{set:function(a){w=a}},turnServers:{enumerable:!0,get:function(){return w}}})}return this}var h=k("events").EventEmitter;m=k("util").inherits;var g=k("./invitetransaction/inviteclienttransaction"),e=k("q");k("../accesstoken");var f=k("../util");k("../util/constants");m(b,h);b.prototype.connect=function(){if(this.isConnected){var a=e.defer();
setTimeout(a.resolve.bind(null,this));return a.promise}return this._connect().then(this._onConnectSuccess.bind(this),this._onConnectFailure.bind(this))};b.prototype._connect=function(){var a=e.defer();setTimeout(a.resolve);return a.promise};b.prototype._onConnectSuccess=function(){this.emit("connected",this);this._isConnected=!0;return this};b.prototype._onConnectFailure=function(a){throw a;};b.prototype.disconnect=function(){if(!this.isConnected){var a=e.defer();setTimeout(a.resolve.bind(null,this));
return a.promise}return this._disconnect().then(this._onDisconnectSuccess.bind(this),this._onDisconnectFailure.bind(this))};b.prototype._disconnect=function(){var a=e.defer();setTimeout(a.resolve);return a.promise};b.prototype._onDisconnectSuccess=function(){this.emit("disconnected",this);this._isConnected=!1;return this};b.prototype._onDisconnectFailure=function(a){throw a;};b.prototype.register=function(a){return a?a===this.token&&this.isRegistered?new e(this):this.connect().then(this._register.bind(this,
a)).then(this._onRegisterSuccess.bind(this,a),this._onRegisterFailure.bind(this)):this.register(this.token)};b.prototype._register=function(a){a=e.defer();setTimeout(a.resolve.bind(null,this));return a.promise};b.prototype._onRegisterSuccess=function(a){this._isRegistered=!0;this._token=a;this.emit("registered",this);return this};b.prototype._onRegisterFailure=function(a){this.emit("registrationFailed",this);throw a;};b.prototype.unregister=function(){return this.isRegistered?this.connect().then(this._unregister.bind(this)).then(this._onUnregisterSuccess.bind(this),
this._onUnregisterFailure.bind(this)):new e(this)};b.prototype._unregister=function(){var a=e.defer();setTimeout(a.resolve.bind(null,this));return a.promise};b.prototype._onUnregisterSuccess=function(){this._isRegistered=!1;this.emit("unregistered",this);return this};b.prototype._onUnregisterFailure=function(a){throw a;};b.prototype.invite=function(a,c){c=f.extend({callTimeout:this.callTimeout,stunServers:this.stunServers,turnServers:this.turnServers},c);var b=new this._inviteClientTransactionFactory(this,
a,c);this.inviteClientTransactions.add(b);b.then(this._onInviteSuccess.bind(this,b),this._onInviteFailure.bind(this,b));return b};b.prototype._onInviteSuccess=function(a,c){this.inviteClientTransactions.delete(a);return this._dialogCreated(c)};b.prototype._onInviteFailure=function(a,c){this.inviteClientTransactions.delete(a);throw c;};b.prototype._handleInviteServerTransaction=function(a){this.inviteServerTransactions.add(a);a.then(this._onAcceptSuccess.bind(this,a),this._onAcceptFailure.bind(this,
a));setTimeout(this.emit.bind(this,"invite",a))};b.prototype._onAcceptSuccess=function(a,c){this.inviteServerTransactions.delete(a);return this._dialogCreated(c)};b.prototype._dialogCreated=function(a){var c=this;this.dialogs.add(a);a.once("disconnected",function(b){c.emit("dialogDisconnected",a)});a.once("failed",function(b){c.dialogs.delete(a);c.emit("dialogFailed",a)});a.once("ended",function(){c.dialogs.delete(a);c.emit("dialogEnded",a)});this.emit("dialogCreated",a);return a};b.prototype._onAcceptFailure=
function(a,c){this.inviteServerTransactions.delete(a);throw c;};l.exports=b},{"../accesstoken":10,"../util":30,"../util/constants":29,"./invitetransaction/inviteclienttransaction":20,events:5,q:36,util:9}],27:[function(k,l,m){(function(b){function h(a,c,b){if(!(this instanceof h))return new h(a,c,b);var d=this,f=!1,n=[],k=c.userAgent.token;b=new p("StatsReporter",b||"warn");Object.defineProperties(this,{_log:{value:b},dialog:{enumerable:!0,value:c},eventGateway:{enumerable:!0,value:a},token:{enumerable:!0,
value:k}});c.on("stats",function(a){f&&10<=n.length?(a=n.splice(0,n.length),g(d,a)):n.push(a)});c.once("ended",function(){if(f){var a=n.splice(0,n.length);g(d,a)}});e(this).then(function(){f=!0})}function g(a,c){var b=a._log;return f("https://"+a.eventGateway+"/v1/Calls/"+a.dialog.callSid+"/Statistics",a.token.jwt,{callsid:a.dialog.callSid,samples:c}).then(b.debug.bind(b,"Post to gateway succeeded"),b.debug.bind(b,"Post to gateway failed"))}function e(a){var b=a._log;return f("https://"+a.eventGateway+
"/v1/Calls",a.token.jwt,{callsid:a.dialog.callSid,sip:{invite_to_180:a.dialog.inviteTo180},platform:{name:n.name,version:n.version,media_engine:"WebRTC",sdk:c}}).then(b.debug.bind(b,"Initial post to gateway succeeded"),b.debug.bind(b,"Initial post to gateway failed"))}function f(a,c,b){return d.post({url:a,body:b,headers:{"Content-Type":"application/json","X-Twilio-Token":c}})}var a=k("./util"),c=k("lib/../../package.json").version,d=k("./util/request"),p=k("./util/log"),n={name:"Unknown",version:"0.0"};
"undefined"!==typeof navigator&&navigator.userAgent?n=a.parseUserAgent(navigator.userAgent):"undefined"!==typeof b&&(n={name:"Node",version:b.version.node});l.exports=h}).call(this,k("_process"))},{"./util":30,"./util/log":31,"./util/request":32,_process:7,"lib/../../package.json":73}],28:[function(k,l,m){function b(g){if(!(this instanceof b))return new b(g);if("function"===typeof g.cancel)return g;var e=h.defer(),f=h.all([g,e.promise]),a=h.defer();Object.defineProperties(this,{_deferred:{value:a}});
g.then(function(){e.resolve()});f.then(function(c){a.resolve(c[0])},function(c){a.reject(c)})}var h=k("q");b.prototype.then=function(){var b=this._deferred.promise;return b.then.apply(b,arguments)};b.prototype.catch=function(){var b=this._deferred.promise;return b.catch.apply(b,arguments)};b.prototype.cancel=function(){return this._deferred.reject(Error("canceled"))};l.exports=b},{q:36}],29:[function(k,l,m){m=k("q");l.exports.REALM=".dev";l.exports.CHUNDER_PORT=10193;l.exports.CLIENT_VERSION=2;l.exports.DEFAULT_LOG_LEVEL=
"warn";l.exports.EVENT_GATEWAY="eventgw.twilio.com";l.exports.REGISTRAR_SERVER=function(b){return b+".endpoint.twilio.com"};l.exports.WS_SERVER=function(b){return"wss://"+b+".endpoint.twilio.com"};l.exports.DEFAULT_PEER_NAME="Anonymous";l.exports.DEFAULT_CALL_TIMEOUT=5E4;l.exports.DEFAULT_ICE_SERVERS=new m([{url:"stun:global.stun.twilio.com:3478?transport=udp"}]);m={};"undefined"!==typeof navigator&&navigator.mozGetUserMedia?m={offerToReceiveAudio:!0,offerToReceiveVideo:!0}:m.mandatory={OfferToReceiveAudio:!0,
OfferToReceiveVideo:!0};l.exports.DEFAULT_OFFER_OPTIONS=m;l.exports.headers={X_TWILIO_ACCOUNTSID:"X-Twilio-Accountsid",X_TWILIO_APIVERSION:"X-Twilio-Apiversion",X_TWILIO_CALLSID:"X-Twilio-Callsid",X_TWILIO_CLIENT:"X-Twilio-Client",X_TWILIO_CLIENTVERSION:"X-Twilio-Clientversion",X_TWILIO_PARAMS:"X-Twilio-Params",X_TWILIO_PARTICIPANTS:"X-Twilio-Participants",X_TWILIO_PARTICIPANTSID:"X-Twilio-ParticipantSid",X_TWILIO_TOKEN:"X-Twilio-Token",X_TWILIO_USERNAME:"X-Twilio-Username",X_TWILIO_PASSWORD:"X-Twilio-Password",
X_TWILIO_SESSION:"X-Twilio-Session"};l.exports.SOUNDS={incoming:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/incoming.mp3",outgoing:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/outgoing.mp3",disconnect:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/disconnect.mp3",dtmf0:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-0.mp3",dtmf1:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-1.mp3",dtmf2:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-2.mp3",
dtmf3:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-3.mp3",dtmf4:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-4.mp3",dtmf5:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-5.mp3",dtmf6:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-6.mp3",dtmf7:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-7.mp3",dtmf8:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-8.mp3",dtmf9:"//static.twilio.com/libs/twiliojs/refs/82278dd/sounds/dtmf-9.mp3"};
var b=k("./twilioerror");l.exports.twilioErrors=Array.prototype.reduce.call([{name:"GATEWAY_CONNECTION_FAILED",message:"Could not connect to Twilio's servers"},{name:"GATEWAY_DISCONNECTED",message:"Connection to Twilio's servers was lost"},{name:"INVALID_ARGUMENT",message:"One or more arguments passed were invalid"},{name:"INVALID_TOKEN",message:"The token is invalid or malformed"},{name:"LISTEN_FAILED",message:"Failed to listen with the supplied token"},{name:"TOKEN_EXPIRED",message:"Endpoint's active token has expired"},
{name:"CONVERSATION_CREATE_FAILED",message:"Failed to create Conversation"},{name:"CONVERSATION_INVITE_FAILED",message:"Failed to add Participant to Conversation"},{name:"CONVERSATION_INVITE_TIMEOUT",message:"Invite to Participant timed out"},{name:"CONVERSATION_INVITE_REJECTED",message:"Invite was rejected by Participant"},{name:"CONVERSATION_INVITE_CANCELED",message:"Invite to Participant was canceled"},{name:"CONVERSATION_JOIN_FAILED",message:"Failed to join Conversation"},{name:"CONVERSATION_JOIN_CANCELED",
message:"Incoming Invite was canceled by the sender"},{name:"SDP_NEGOTIATION_FAILED",message:"Failed to negotiate media with Participant(s)"},{name:"ICE_CONNECT_FAILED",message:"Could not find match for all candidates"},{name:"ICE_DISCONNECTED",message:"Liveliness check has failed; may be recoverable"},{name:"MEDIA_ACCESS_DENIED",message:"Could not get access to microphone or camera"}],function(h,g){h[g.name]=new b(g);return h},{})},{"./twilioerror":33,q:36}],30:[function(k,l,m){(function(b,h){function g(a){return"function"===
typeof atob?atob(a):(new h(a,"base64")).toString("ascii")}function e(a){return"function"===typeof btoa?btoa(a):(new h(a)).toString("base64")}function f(a){var c={};return function(){var b=Array.prototype.slice.call(arguments,0);return c[b]?c[b]:c[b]=a.apply(null,b)}}function a(a){var c=[],b=[];a&&a.forEach(function(a){if(a.url){var d=a.url.split(":")[0];"stun"===d||"stuns"===d?c.push(a):"turn"!==d&&"turns"!==d||b.push(a)}});c=c.map(function(a){return a.url.split("?")[0]});b=b.map(function(a){return{urls:[a.url.split("?")[0]],
username:a.username,password:a.credential}});return{stunServers:c,turnServers:b}}k("util");k("./cancelablepromise");var c=k("./constants"),d=c.twilioErrors,p=c.headers,n=k("q"),w=k("./request"),x={decode:g,encode:e},m={decode:f(function(a){var c=a.length%4;0<c&&(a+=Array(4-c+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");return g(a)})};l.exports.base64=x;l.exports.base64URL=m;l.exports.deepClone=function(a){return JSON.parse(JSON.stringify(a))};l.exports.fromURLFormEncoded=function(a){if(!a)return{};
var c={};a=a.split("&");for(var b=0;b<a.length;b++){var d=a[b].split("="),e=decodeURIComponent(d[0]),d=d[1]?decodeURIComponent(d[1]):null;c[e]=d}return c};l.exports.makeRegisterHeaders=function(a){var d="undefined"===typeof navigator?{}:navigator;return[p.X_TWILIO_TOKEN+": "+a.jwt,p.X_TWILIO_CLIENT+": "+JSON.stringify({p:"browser",v:b.env.SDK_VERSION||"unknown",browser:{userAgent:d.userAgent||"unknown",platform:d.platform||"unknown"},plugin:"rtc"}),p.X_TWILIO_CLIENTVERSION+": "+c.CLIENT_VERSION]};
l.exports.makeTarget=function(a){return"sip:"+a+"@"+c.CHUNDER_HOST};l.exports.makeURI=function(a,b){return encodeURIComponent(b||c.DEFAULT_PEER_NAME)+"@"+a+".chunder.twilio.com"};l.exports.toURLFormEncoded=function(a){var c=[],b;for(b in a)c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")};l.exports.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&3|8).toString(16)})};l.exports.race=
function(a){function c(a){e&&(e=!1,d.resolve(a))}function b(a){e&&(e=!1,d.reject(a))}var d=n.defer(),e=!0;a.forEach(function(a){a.done(c,b)});return d.promise};l.exports.withDefaults=function(a,c){a=a||{};c=Array.prototype.slice.call(arguments,1);c.forEach(function(c){var b=a,d;for(d in c)d in b||(b[d]=c[d])});return a};l.exports.extend=function(a,c){a=a||{};c=Array.prototype.slice.call(arguments,1);c.forEach(function(c){var b=a,d;for(d in c)b[d]=c[d]});return a};l.exports.separateIceServers=a;l.exports.getStunServers=
function(c){return a(c).stunServers};l.exports.getTurnServers=function(c){return a(c).turnServers};l.exports.promiseFromEvents=function(a,c,b,d){function e(){var a=[].slice.call(arguments);d&&c.removeListener(d,f);g.resolve.apply(null,a)}function f(){var a=[].slice.call(arguments);c.removeListener(b,e);g.reject.apply(null,a)}var g=n.defer();c.once(b,e);if(d)c.once(d,f);a();return g.promise};l.exports.parseConversationSIDFromContactHeader=function(a){return(a=a.match(/<sip:(.*)@(.*)$/))?a[1]:null};
l.exports.getOrNull=function(a,c){return c.split(".").reduce(function(a,c){return a?a[c]:null},a)};l.exports.isValidIceServerArray=function(a){return"undefined"===typeof a.forEach?!1:a.reduce(function(a,c){return a&&"undefined"!==typeof c.url},!0)};l.exports.parseUserAgent=function(a){var c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)\.(\d+)/i)||[],b=c[1],c="undefined"!==typeof c[2]&&"undefined"!==typeof c[3]&&c[2]+"."+c[3];if(/trident/i.test(b))return a=/\brv[ :]+(\d+)\.(\d+)/g.exec(a)||
[],{name:"IE",version:a[1]?a[1]+"."+a[2]:"Unknown"};if("Chrome"===b&&(a=a.match(/\b(OPR|Edge)\/(\d+)\.(\d+)/),null!==a))return{name:"Opera",version:a[2]+"."+a[3]};"MSIE"===b&&(b="IE");return{name:b||"Unknown",version:c||"Unknown"}};l.exports.fetchIceServers=function(a,b){var f=b.log,g=b.requestFactory||w,n={url:"https://"+(b.apiHost||"api.twilio.com")+"/2010-04-01/Accounts/"+a.accountSid+"/Tokens.json",headers:{Authorization:"Basic "+e("Token:"+a.jwt)}};return g.post(n).then(function(a){return JSON.parse(a).ice_servers},
function(a){f&&f.warn(d.ICE_FETCH_FAILED,"Failed to fetch ephemeral TURN server credential",a);return c.DEFAULT_ICE_SERVERS})};l.exports.overwriteArray=function(a,c){a.splice(0,a.length);c.forEach(function(c){a.push(c)})};l.exports.memoize=f}).call(this,k("_process"),k("buffer").Buffer)},{"./cancelablepromise":28,"./constants":29,"./request":32,_process:7,buffer:1,q:36,util:9}],31:[function(k,l,m){function b(g,e){if(!(this instanceof b))return new b(g,e);e=e?b.getLevelByName(e):b.INFO;Object.defineProperties(this,
{logLevel:{value:e},name:{value:g}})}k("./");k("./twilioerror");var h=k("./constants").twilioErrors;Object.defineProperties(b,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:[{name:"DEBUG",logFn:console.log},{name:"INFO",logFn:console.info},{name:"WARN",logFn:console.warn},{name:"ERROR",logFn:console.error}]}});b.getLevelByName=function(g){if(!isNaN(g))return parseInt(g,10);g=g.toUpperCase();if(-1===["OFF","ERROR","WARN","INFO","DEBUG"].indexOf(g))throw h.INVALID_ARGUMENT.clone('Log level must be one of: ["off", "error", "warn", "info", "debug"]');
return b[g]};b.prototype.log=function(g,e){var f=b._levels[g];if(!f)throw h.INVALID_ARGUMENT.clone("Invalid log level");this.logLevel<=g&&f.logFn.apply(console,[this.name,f.name].concat(e));return this};b.prototype.debug=function(){return this.log.call(this,b.DEBUG,[].slice.call(arguments))};b.prototype.info=function(){return this.log.call(this,b.INFO,[].slice.call(arguments))};b.prototype.warn=function(){return this.log.call(this,b.WARN,[].slice.call(arguments))};b.prototype.error=function(){return this.log.call(this,
b.ERROR,[].slice.call(arguments))};b.prototype.throw=function(g,e){g.clone&&(g=g.clone(e));this.log.call(this,b.ERROR,g);throw g;};l.exports=b},{"./":30,"./constants":29,"./twilioerror":33}],32:[function(k,l,m){var b=k("q"),h=k("./"),g="undefined"===typeof XMLHttpRequest?k("xmlhttprequest").XMLHttpRequest:XMLHttpRequest;k=function(e,f,a){a=h.withDefaults(a,{xmlHttpRequestFactory:g});var c=b.defer(),d=new a.xmlHttpRequestFactory;d.open(e,f.url,!0);d.onreadystatechange=function(){4===d.readyState&&
(200<=d.status&&300>d.status?c.resolve(d.responseText):c.reject(Error(d.responseText)))};for(var p in f.headers)d.setRequestHeader(p,f.headers[p]);d.send(JSON.stringify(f.body));return c.promise};k.get=function(b,f){return new this("GET",b,f)};k.post=function(b,f){return new this("POST",b,f)};l.exports=k},{"./":30,q:36,xmlhttprequest:72}],33:[function(k,l,m){function b(b,g){Object.defineProperties(this,{_errorData:{value:b},name:{value:b.name},message:{value:g||b.message}})}k=k("util").inherits;k(b,
Error);b.prototype.toString=function(){return[this.name,this.message].join(" | ")};b.prototype.clone=function(h){return new b(this._errorData,h)};l.exports=b},{util:9}],34:[function(k,l,m){function b(a,c){var b=[],d=null,f=[],g=null;a.result().forEach(function(a){var c=null;switch(a.type){case "googCandidatePair":a:{for(var c={},n={},w=a.names(),k=a.timestamp?Math.floor(a.timestamp/1E3):null,D=0;D<w.length;D++){var l=w[D],A=a.stat(l);switch(l){case "googActiveConnection":if("true"!==A){c=null;break a}break;
case "googChannelId":c.connection=A;break;case "googLocalAddress":A.split&&(l=A.split(":"),p(c,"local","address",l[0]),p(c,"local","port",Number(l[1])));break;case "googLocalCandidateType":p(c,"local","type",A);break;case "googRemoteAddress":A.split&&(l=A.split(":"),p(c,"remote","address",l[0]),p(c,"remote","port",Number(l[1])));break;case "googRemoteCandidateType":p(c,"remote","type",A);break;case "googRtt":c.rtt=Number(A);break;case "":break;default:n[l]=A}}c.timestamp=k;c=e(c,n)}c&&(d=d||c.known);
break;case "ssrc":c=h(a);b.push(c.known);break;default:f.push(a)}c&&c.known&&"timestamp"in c.known&&(g=g||c.known.timestamp,delete c.known.timestamp)});c(null,{timestamp:g,tracks:b,transport:d})}function h(a){var c={},b={},d=a.names(),f=null,g=null,h=a.timestamp?Math.floor(a.timestamp/1E3):null;d.forEach(function(d){var e=a.stat(d);switch(d){case "audioInputLevel":g="audio";p(c,"audio","inlvl",Number(e));break;case "audioOutputLevel":g="audio";p(c,"audio","outlvl",Number(e));break;case "bytesReceived":f=
"receiving";p(c,"bytes","recv",Number(e));break;case "bytesSent":f="sending";p(c,"bytes","sent",Number(e));break;case "googCodecName":""!==e&&(c.codecName=e);break;case "googFrameHeightReceived":f="receiving";g="video";p(c,"video","height_recv",Number(e));break;case "googFrameHeightSent":f="sending";g="video";p(c,"video","height_sent",Number(e));break;case "googFrameWidthReceived":f="receiving";g="video";p(c,"video","width_recv",Number(e));break;case "googFrameWidthSent":f="sending";g="video";p(c,
"video","width_sent",Number(e));break;case "googFrameRateDecoded":f="receiving";g="video";p(c,"video","fps_recv",Number(e));break;case "googFrameRateSent":f="sending";g="video";p(c,"video","fps_sent",Number(e));break;case "googJitterBufferMs":c.googJitterBufferMs=Number(e);break;case "googJitterReceived":d=Number(e);-1!==d&&(c.jitter=d);break;case "googRtt":d=Number(e);-1!==d&&(c.rtt=d);break;case "packetsLost":f="sending";-1!==Number(e)&&p(c,"packets","lost",Number(e));break;case "packetsReceived":f=
"receiving";p(c,"packets","recv",Number(e));break;case "packetsSent":f="sending";p(c,"packets","sent",Number(e));break;case "ssrc":c[d]=e;break;case "transportId":c.connection=e;break;default:b[d]=e}});f&&(c.direction=f);g&&(c.media=g);c.timestamp=h;return e(c,b)}function g(a,c){var b=[],g=[],p=null,h={},k={},l;a.forEach(function(a){var c=null;switch(a.type){case "inboundrtp":var d={direction:"receiving"},c={},f;for(f in a){var n=a[f];switch(f){case "mozRtt":d.rtt=n;break;case "timestamp":d[f]=Math.floor(n/
1E3);break;case "jitter":d[f]=1E3*n;break;case "framerateMean":d.fps=Math.round(n);break;case "mediaType":d.media=n;break;case "bytesReceived":case "packetsLost":case "packetsReceived":case "ssrc":d[f]=n;break;default:c[f]=n}}c=e(d,c);break;case "outboundrtp":if(!1===a.isRemote){f={direction:"sending"};c={};for(d in a)switch(n=a[d],d){case "timestamp":f[d]=Math.floor(n/1E3);break;case "mediaType":f.media=n;break;case "bytesSent":case "packetsSent":case "ssrc":f[d]=n;break;default:c[d]=n}c=e(f,c)}break;
case "candidatepair":f=l&&l.componentId;!a.selected||f&&-1!==f.indexOf("video")||(l=a);break;case "localcandidate":h[a.id]=a;break;case "remotecandidate":k[a.id]=a;break;default:g.push(a)}c&&(p=p||c.known.timestamp,delete c.known.timestamp,b.push(c))});if(0===b.length||0===(b=f(b)).length)return c(null,{timestamp:p,ssrcs:[]});var m=h[l.localCandidateId],u=k[l.remoteCandidateId],m={local:{address:m.ipAddress,port:m.portNumber,type:"host"===m.candidateType?"local":m.candidateType},remote:{address:u.ipAddress,
port:u.portNumber,type:"host"===u.candidateType?"local":u.candidateType}},m={timestamp:p,tracks:b.map(d),transport:m};c(null,m)}function e(c,b){var d=null;a(c)||(d=d||{},d.known=c);a(b)||(d=d||{},d.unknown=b);return d}function f(a){for(var c=[],b=0;b<a.length;b++){var d=a[b];d.known&&c.push(d.known)}return c}function a(a){if(!a)return!0;for(var c in a)return!1;return!0}function c(a,c){return function(){var b=Array.prototype.slice.call(arguments);b.push(c);return a.apply(null,b)}}function d(a){var c=
{ssrc:a.ssrc,media:a.media,direction:a.direction,codecName:a.codecName,packets:{lost:a.packetsLost,recvtot:a.packetsReceived,senttot:a.packetsSent},bytes:{recvtot:a.bytesReceived,senttot:a.bytesSent},jitter:a.jitter,rtt:a.rtt};if("audioInputLevel"in a||"audioOutputLevel"in a)c.audio={inlvl:a.audioInputLevel,outlvl:a.audioOutputLevel};if("fps"in a||"width"in a||"height"in a)c.video={fps:a.fps,width:a.width,height:a.height};return c}function p(){var a=[].slice.call(arguments,0),c=a[0],b=a.slice(1,a.length-
1),d=a[a.length-1],e=c;b.forEach(function(a,c){var f=c==b.length-1?d:{};e=e[a]=e[a]||f});return c}l.exports=function(a,d){var e=Error("WebRTC statistics are unsupported");null===a||"undefined"===typeof navigator||"function"!==typeof a.getStats?d(e):navigator.webkitGetUserMedia?a.getStats(c(b,d),d):navigator.mozGetUserMedia?a.getStats(null,c(g,d),d):d(e)}},{}],35:[function(k,l,m){var b=k("q");l.exports=function(h){var g=b.defer();h=h||{audio:!0,video:!0};var e=g.resolve.bind(g),f=g.reject.bind(g);
"undefined"!==typeof window&&"undefined"!==typeof navigator?"function"===typeof navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(h,e,f):"function"===typeof navigator.mozGetUserMedia&&navigator.mozGetUserMedia(h,e,f):f(Error("getUserMedia is not supported"));return g.promise}},{q:36}],36:[function(k,l,m){(function(b){(function(b){if("function"===typeof bootstrap)bootstrap("promise",b);else if("object"===typeof m&&"object"===typeof l)l.exports=b();else if("function"===typeof define&&define.amd)define(b);
else if("undefined"!==typeof ses)ses.ok()&&(ses.makeQ=b);else if("undefined"!==typeof window||"undefined"!==typeof self){var g="undefined"!==typeof window?window:self,e=g.Q;g.Q=b();g.Q.noConflict=function(){g.Q=e;return this}}else throw Error("This environment was not anticipated by Q. Please file a bug.");})(function(){function h(a){return function(){return W.apply(a,arguments)}}function g(a,c){if(G&&c.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf("From previous event:")){for(var b=
[],d=c;d;d=d.source)d.stack&&b.unshift(d.stack);b.unshift(a.stack);for(var b=b.join("\nFrom previous event:\n").split("\n"),d=[],f=0;f<b.length;++f){var g=b[f],p;if(p=e(g)){var n=p[1];p=p[0]===U&&n>=J&&n<=X}else p=!1;p||(p=g,p=-1!==p.indexOf("(module.js:")||-1!==p.indexOf("(node.js:"));p||!g||d.push(g)}b=d.join("\n");a.stack=b}}function e(a){var c=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(c||(c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[c[1],Number(c[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],
Number(a[2])]}function f(){if(G)try{throw Error();}catch(a){var c=a.stack.split("\n"),c=0<c[0].indexOf("@")?c[1]:c[2];if(c=e(c))return U=c[0],c[1]}}function a(a){return a instanceof n?a:v(a)?F(a):u(a)}function c(){function b(c){f=c;p.source=c;L(d,function(b,d){a.nextTick(function(){c.promiseDispatch.apply(c,d)})},void 0);e=d=void 0}var d=[],e=[],f,g=R(c.prototype),p=R(n.prototype);p.promiseDispatch=function(c,b,g){var p=B(arguments);d?(d.push(p),"when"===b&&g[1]&&e.push(g[1])):a.nextTick(function(){f.promiseDispatch.apply(f,
p)})};p.valueOf=function(){if(d)return p;var a=l(f);m(a)&&(f=a);return a};p.inspect=function(){return f?f.inspect():{state:"pending"}};if(a.longStackSupport&&G)try{throw Error();}catch(h){p.stack=h.stack.substring(h.stack.indexOf("\n")+1)}g.promise=p;g.resolve=function(c){f||b(a(c))};g.fulfill=function(a){f||b(u(a))};g.reject=function(a){f||b(t(a))};g.notify=function(c){f||L(e,function(b,d){a.nextTick(function(){d(c)})},void 0)};return g}function d(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");
var b=c();try{a(b.resolve,b.reject,b.notify)}catch(d){b.reject(d)}return b.promise}function p(c){return d(function(b,d){for(var e=0,f=c.length;e<f;e++)a(c[e]).then(b,d)})}function n(a,c,b){void 0===c&&(c=function(a){return t(Error("Promise does not support operation: "+a))});void 0===b&&(b=function(){return{state:"unknown"}});var d=R(n.prototype);d.promiseDispatch=function(b,e,f){var g;try{g=a[e]?a[e].apply(d,f):c.call(d,e,f)}catch(p){g=t(p)}b&&b(g)};if(d.inspect=b){var e=b();"rejected"===e.state&&
(d.exception=e.reason);d.valueOf=function(){var a=b();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function k(c,b,d,e){return a(c).then(b,d,e)}function l(a){if(m(a)){var c=a.inspect();if("fulfilled"===c.state)return c.value}return a}function m(a){return a instanceof n}function v(a){return a===Object(a)&&"function"===typeof a.then}function C(){K.length=0;M.length=0;N||(N=!0)}function q(c,d){N&&("object"===typeof b&&"function"===typeof b.emit&&a.nextTick.runAfter(function(){-1!==
P(M,c)&&(b.emit("unhandledRejection",d,c),S.push(c))}),M.push(c),d&&"undefined"!==typeof d.stack?K.push(d.stack):K.push("(no stack) "+d))}function r(c){if(N){var d=P(M,c);-1!==d&&("object"===typeof b&&"function"===typeof b.emit&&a.nextTick.runAfter(function(){var a=P(S,c);-1!==a&&(b.emit("rejectionHandled",K[d],c),S.splice(a,1))}),M.splice(d,1),K.splice(d,1))}}function t(a){var c=n({when:function(c){c&&r(this);return c?c(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});
q(c,a);return c}function u(a){return n({when:function(){return a},get:function(c){return a[c]},set:function(c,b){a[c]=b},"delete":function(c){delete a[c]},post:function(c,b){return null===c||void 0===c?a.apply(void 0,b):a[c].apply(a,b)},apply:function(c,b){return a.apply(c,b)},keys:function(){return Y(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function F(b){var d=c();a.nextTick(function(){try{b.then(d.resolve,d.reject,d.notify)}catch(a){d.reject(a)}});return d.promise}function D(c,
b,d){return a(c).spread(b,d)}function H(c,b,d){return a(c).dispatch(b,d)}function A(a){return k(a,function(a){var b=0,d=c();L(a,function(c,e,f){var g;m(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,k(e,function(c){a[f]=c;0===--b&&d.resolve(a)},d.reject,function(a){d.notify({index:f,value:a})}))},void 0);0===b&&d.resolve(a);return d.promise})}function y(c){if(0===c.length)return a.resolve();var b=a.defer(),d=0;L(c,function(a,e,f){a=c[f];d++;k(a,function(a){b.resolve(a)},function(){d--;
0===d&&b.reject(Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(a){b.notify({index:f,value:a})})},void 0);return b.promise}function I(c){return k(c,function(c){c=Q(c,a);return k(A(Q(c,function(a){return k(a,V,V)})),function(){return c})})}var G=!1;try{throw Error();}catch(E){G=!!E.stack}var J=f(),U,V=function(){},O=function(){function a(){for(var b,e;d.next;){d=d.next;b=d.task;d.task=void 0;if(e=d.domain)d.domain=void 0,e.enter();c(b,e)}for(;n.length;)b=
n.pop(),c(b);f=!1}function c(b,d){try{b()}catch(e){if(p)throw d&&d.exit(),setTimeout(a,0),d&&d.enter(),e;setTimeout(function(){throw e;},0)}d&&d.exit()}var d={task:void 0,next:null},e=d,f=!1,g=void 0,p=!1,n=[];O=function(a){e=e.next={task:a,domain:p&&b.domain,next:null};f||(f=!0,g())};if("object"===typeof b&&"[object process]"===b.toString()&&b.nextTick)p=!0,g=function(){b.nextTick(a)};else if("function"===typeof setImmediate)g="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};
else if("undefined"!==typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=function(){g=k;h.port1.onmessage=a;a()};var k=function(){h.port2.postMessage(0)},g=function(){setTimeout(a,0);k()}}else g=function(){setTimeout(a,0)};O.runAfter=function(a){n.push(a);f||(f=!0,g())};return O}(),W=Function.call,B=h(Array.prototype.slice),L=h(Array.prototype.reduce||function(a,c){var b=0,d=this.length;if(1===arguments.length){do{if(b in this){c=this[b++];break}if(++b>=d)throw new TypeError;}while(1)
}for(;b<d;b++)b in this&&(c=a(c,this[b],b));return c}),P=h(Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1}),Q=h(Array.prototype.map||function(a,c){var b=this,d=[];L(b,function(e,f,g){d.push(a.call(c,f,g,b))},void 0);return d}),R=Object.create||function(a){function c(){}c.prototype=a;return new c},Z=h(Object.prototype.hasOwnProperty),Y=Object.keys||function(a){var c=[],b;for(b in a)Z(a,b)&&c.push(b);return c},aa=h(Object.prototype.toString),T;T=
"undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};a.resolve=a;a.nextTick=O;a.longStackSupport=!1;"object"===typeof b&&b&&b.env&&b.env.Q_DEBUG&&(a.longStackSupport=!0);a.defer=c;c.prototype.makeNodeResolver=function(){var a=this;return function(c,b){c?a.reject(c):2<arguments.length?a.resolve(B(arguments,1)):a.resolve(b)}};a.Promise=d;a.promise=d;d.race=p;d.all=A;d.reject=t;d.resolve=a;a.passByCopy=function(a){return a};n.prototype.passByCopy=function(){return this};a.join=function(c,
b){return a(c).join(b)};n.prototype.join=function(c){return a([this,c]).spread(function(a,c){if(a===c)return a;throw Error("Can't join: not the same: "+a+" "+c);})};a.race=p;n.prototype.race=function(){return this.then(a.race)};a.makePromise=n;n.prototype.toString=function(){return"[object Promise]"};n.prototype.then=function(b,d,e){function f(a){try{return"function"===typeof b?b(a):a}catch(c){return t(c)}}function p(a){if("function"===typeof d){g(a,n);try{return d(a)}catch(c){return t(c)}}return t(a)}
var n=this,h=c(),k=!1;a.nextTick(function(){n.promiseDispatch(function(a){k||(k=!0,h.resolve(f(a)))},"when",[function(a){k||(k=!0,h.resolve(p(a)))}])});n.promiseDispatch(void 0,"when",[void 0,function(c){var b,d=!1;try{b="function"===typeof e?e(c):c}catch(f){if(d=!0,a.onerror)a.onerror(f);else throw f;}d||h.notify(b)}]);return h.promise};a.tap=function(c,b){return a(c).tap(b)};n.prototype.tap=function(c){c=a(c);return this.then(function(a){return c.fcall(a).thenResolve(a)})};a.when=k;n.prototype.thenResolve=
function(a){return this.then(function(){return a})};a.thenResolve=function(c,b){return a(c).thenResolve(b)};n.prototype.thenReject=function(a){return this.then(function(){throw a;})};a.thenReject=function(c,b){return a(c).thenReject(b)};a.nearer=l;a.isPromise=m;a.isPromiseAlike=v;a.isPending=function(a){return m(a)&&"pending"===a.inspect().state};n.prototype.isPending=function(){return"pending"===this.inspect().state};a.isFulfilled=function(a){return!m(a)||"fulfilled"===a.inspect().state};n.prototype.isFulfilled=
function(){return"fulfilled"===this.inspect().state};a.isRejected=function(a){return m(a)&&"rejected"===a.inspect().state};n.prototype.isRejected=function(){return"rejected"===this.inspect().state};var K=[],M=[],S=[],N=!0;a.resetUnhandledRejections=C;a.getUnhandledReasons=function(){return K.slice()};a.stopUnhandledRejectionTracking=function(){C();N=!1};C();a.reject=t;a.fulfill=u;a.master=function(c){return n({isDef:function(){}},function(a,b){return H(c,a,b)},function(){return a(c).inspect()})};
a.spread=D;n.prototype.spread=function(a,c){return this.all().then(function(c){return a.apply(void 0,c)},c)};a.async=function(c){return function(){function b(c,g){var p;if("undefined"===typeof StopIteration){try{p=d[c](g)}catch(n){return t(n)}return p.done?a(p.value):k(p.value,e,f)}try{p=d[c](g)}catch(h){return"[object StopIteration]"===aa(h)||h instanceof T?a(h.value):t(h)}return k(p,e,f)}var d=c.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}};a.spawn=function(c){a.done(a.async(c)())};
a["return"]=function(a){throw new T(a);};a.promised=function(a){return function(){return D([this,A(arguments)],function(c,b){return a.apply(c,b)})}};a.dispatch=H;n.prototype.dispatch=function(b,d){var e=this,f=c();a.nextTick(function(){e.promiseDispatch(f.resolve,b,d)});return f.promise};a.get=function(c,b){return a(c).dispatch("get",[b])};n.prototype.get=function(a){return this.dispatch("get",[a])};a.set=function(c,b,d){return a(c).dispatch("set",[b,d])};n.prototype.set=function(a,c){return this.dispatch("set",
[a,c])};a.del=a["delete"]=function(c,b){return a(c).dispatch("delete",[b])};n.prototype.del=n.prototype["delete"]=function(a){return this.dispatch("delete",[a])};a.mapply=a.post=function(c,b,d){return a(c).dispatch("post",[b,d])};n.prototype.mapply=n.prototype.post=function(a,c){return this.dispatch("post",[a,c])};a.send=a.mcall=a.invoke=function(c,b){return a(c).dispatch("post",[b,B(arguments,2)])};n.prototype.send=n.prototype.mcall=n.prototype.invoke=function(a){return this.dispatch("post",[a,B(arguments,
1)])};a.fapply=function(c,b){return a(c).dispatch("apply",[void 0,b])};n.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])};a["try"]=a.fcall=function(c){return a(c).dispatch("apply",[void 0,B(arguments,1)])};n.prototype.fcall=function(){return this.dispatch("apply",[void 0,B(arguments)])};a.fbind=function(c){var b=a(c),d=B(arguments,1);return function(){return b.dispatch("apply",[this,d.concat(B(arguments))])}};n.prototype.fbind=function(){var a=this,c=B(arguments);return function(){return a.dispatch("apply",
[this,c.concat(B(arguments))])}};a.keys=function(c){return a(c).dispatch("keys",[])};n.prototype.keys=function(){return this.dispatch("keys",[])};a.all=A;n.prototype.all=function(){return A(this)};a.any=y;n.prototype.any=function(){return y(this)};a.allResolved=function(a,c,b){return function(){"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(c+" is deprecated, use "+b+" instead.",Error("").stack);return a.apply(a,arguments)}}(I,"allResolved","allSettled");n.prototype.allResolved=
function(){return I(this)};a.allSettled=function(c){return a(c).allSettled()};n.prototype.allSettled=function(){return this.then(function(c){return A(Q(c,function(c){function b(){return c.inspect()}c=a(c);return c.then(b,b)}))})};a.fail=a["catch"]=function(c,b){return a(c).then(void 0,b)};n.prototype.fail=n.prototype["catch"]=function(a){return this.then(void 0,a)};a.progress=function(c,b){return a(c).then(void 0,void 0,b)};n.prototype.progress=function(a){return this.then(void 0,void 0,a)};a.fin=
a["finally"]=function(c,b){return a(c)["finally"](b)};n.prototype.fin=n.prototype["finally"]=function(c){c=a(c);return this.then(function(a){return c.fcall().then(function(){return a})},function(a){return c.fcall().then(function(){throw a;})})};a.done=function(c,b,d,e){return a(c).done(b,d,e)};n.prototype.done=function(c,d,e){var f=function(c){a.nextTick(function(){g(c,p);if(a.onerror)a.onerror(c);else throw c;})},p=c||d||e?this.then(c,d,e):this;"object"===typeof b&&b&&b.domain&&(f=b.domain.bind(f));
p.then(void 0,f)};a.timeout=function(c,b,d){return a(c).timeout(b,d)};n.prototype.timeout=function(a,b){var d=c(),e=setTimeout(function(){b&&"string"!==typeof b||(b=Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT");d.reject(b)},a);this.then(function(a){clearTimeout(e);d.resolve(a)},function(a){clearTimeout(e);d.reject(a)},d.notify);return d.promise};a.delay=function(c,b){void 0===b&&(b=c,c=void 0);return a(c).delay(b)};n.prototype.delay=function(a){return this.then(function(b){var d=c();setTimeout(function(){d.resolve(b)},
a);return d.promise})};a.nfapply=function(c,b){return a(c).nfapply(b)};n.prototype.nfapply=function(a){var b=c();a=B(a);a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};a.nfcall=function(c){var b=B(arguments,1);return a(c).nfapply(b)};n.prototype.nfcall=function(){var a=B(arguments),b=c();a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};a.nfbind=a.denodeify=function(b){var d=B(arguments,1);return function(){var e=d.concat(B(arguments)),f=c();
e.push(f.makeNodeResolver());a(b).fapply(e).fail(f.reject);return f.promise}};n.prototype.nfbind=n.prototype.denodeify=function(){var c=B(arguments);c.unshift(this);return a.denodeify.apply(void 0,c)};a.nbind=function(b,d){var e=B(arguments,2);return function(){var f=e.concat(B(arguments)),g=c();f.push(g.makeNodeResolver());a(function(){return b.apply(d,arguments)}).fapply(f).fail(g.reject);return g.promise}};n.prototype.nbind=function(){var c=B(arguments,0);c.unshift(this);return a.nbind.apply(void 0,
c)};a.nmapply=a.npost=function(c,b,d){return a(c).npost(b,d)};n.prototype.nmapply=n.prototype.npost=function(a,b){var d=B(b||[]),e=c();d.push(e.makeNodeResolver());this.dispatch("post",[a,d]).fail(e.reject);return e.promise};a.nsend=a.nmcall=a.ninvoke=function(b,d){var e=B(arguments,2),f=c();e.push(f.makeNodeResolver());a(b).dispatch("post",[d,e]).fail(f.reject);return f.promise};n.prototype.nsend=n.prototype.nmcall=n.prototype.ninvoke=function(a){var b=B(arguments,1),d=c();b.push(d.makeNodeResolver());
this.dispatch("post",[a,b]).fail(d.reject);return d.promise};a.nodeify=function(c,b){return a(c).nodeify(b)};n.prototype.nodeify=function(c){if(c)this.then(function(b){a.nextTick(function(){c(null,b)})},function(b){a.nextTick(function(){c(b)})});else return this};a.noConflict=function(){throw Error("Q.noConflict only works when Q is used as a global");};var X=f();return a})}).call(this,k("_process"))},{_process:7}],37:[function(k,l,m){l.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",
version:"0.7.0",main:"src/index.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"http://sipjs.com",author:{name:"Will Mitchell",email:"will@onsip.com"},contributors:[{url:"http://sipjs.com/authors/"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{browserify:"^4.1.8",grunt:"~0.4.0","grunt-browserify":"^2.1.0","grunt-cli":"~0.1.6","grunt-contrib-copy":"^0.5.0","grunt-contrib-jasmine":"~0.8.0",
"grunt-contrib-jshint":">0.5.0","grunt-contrib-uglify":"~0.2.0","grunt-peg":"~1.3.1","grunt-trimtrailingspaces":"^0.4.0",pegjs:"^0.8.0"},engines:{node:">=0.8"},license:"MIT",scripts:{postinstall:"npm install pegjs && cd src/Grammar && mkdir -p dist && pegjs --extra-options-file peg.json src/Grammar.pegjs dist/Grammar.js",test:"grunt travis --verbose"},dependencies:{ws:"^0.6.4",promiscuous:"^0.6.0"},optionalDependencies:{promiscuous:"^0.6.0"},gitHead:"80f44cb0dce25a2a1888eb143049f2ae150c4513",readme:'# SIP.js\n\n[![Build Status](https://travis-ci.org/onsip/SIP.js.png?branch=master)](https://travis-ci.org/onsip/SIP.js)\n\nA JavaScript SIP stack for WebRTC, instant messaging, and more!\n\n\n## Website and Documentation\n\n* [SIPjs.com](http://sipjs.com)\n* [Mailing List](https://groups.google.com/forum/#!forum/sip_js)\n* [Issue Tracking](https://github.com/onsip/sip.js/issues)\n\n\n## Download\n\n* [sipjs.com/download](http://sipjs.com/download/)\n* Bower: `bower install sip.js`\n* npm: `npm install sip.js`\n\n## Authors\n\n### Will Mitchell\n\n* Lead Developer\n* <will@onsip.com>\n* /wakamoleguy on [GitHub](http://github.com/wakamoleguy), [Twitter](http://twitter.com/wakamoleguy)\n\n### James Criscuolo\n\n* <james@onsip.com>\n\n### Eric Green\n\n* <eric.green@onsip.com>\n\n### Joseph Frazier\n\n* <joseph@onsip.com>\n\n### JsSIP Authors\n\nSIP.js contains substantial portions of the JsSIP software. JsSIP\'s authors at time of fork are listed below. For up to date information about JsSIP, please visit [jssip.net](http://jssip.net)\n\n* Jos\u00e9 Luis Mill\u00e1n\n* I\u00f1aki Baz Castillo\n* Sa\u00fal Ibarra Corretg\u00e9\n\n## License\n\nSIP.js is released under the [MIT license](http://sipjs.com/license).\n\nSIP.js contains substantial portions of the JsSIP software, under the following license:\n\n~~~\nCopyright (c) 2012-2013 Jos\u00e9 Luis Mill\u00e1n - Versatica <http://www.versatica.com>\n\nPermission is hereby granted, free of charge, to any person obtaining\na copy of this software and associated documentation files (the\n"Software"), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to\npermit persons to whom the Software is furnished to do so, subject to\nthe following conditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\nLIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\nOF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\nWITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n~~~\n',
readmeFilename:"README.md",bugs:{url:"https://github.com/onsip/SIP.js/issues"},_id:"sip.js@0.7.0",_shasum:"dd02ccc3d04670846a86e2f22e9285cd22702d88",_from:"git+ssh://git@code.hq.twilio.com/client/SIP.js.git#stable-twilio",_resolved:"git+ssh://git@code.hq.twilio.com/client/SIP.js.git#80f44cb0dce25a2a1888eb143049f2ae150c4513"}},{}],38:[function(k,l,m){l.exports=function(b){var h;h=function(g,e,f,a){var c=f;if(void 0===f)throw new TypeError("Not enough arguments");this.ua=g;this.logger=g.getLogger("sip.clientcontext");
this.method=e;f=g.normalizeTarget(f);if(!f)throw new TypeError("Invalid target: "+c);a=Object.create(a||Object.prototype);a.extraHeaders=(a.extraHeaders||[]).slice();a.contentType&&(this.contentType=a.contentType,a.extraHeaders.push("Content-Type: "+this.contentType));this.request=new b.OutgoingRequest(this.method,f,this.ua,a.params,a.extraHeaders);a.body&&(this.body=a.body,this.request.body=this.body);this.localIdentity=this.request.from;this.remoteIdentity=this.request.to;this.data={}};h.prototype=
Object.create(b.EventEmitter.prototype);h.prototype.send=function(){(new b.RequestSender(this,this.ua)).send();return this};h.prototype.cancel=function(g){g=g||{};g=b.Utils.getCancelReason(g.status_code,g.reason_phrase);this.request.cancel(g);this.emit("cancel")};h.prototype.receiveResponse=function(g){var e=b.Utils.getReasonPhrase(g.status_code);switch(!0){case /^1[0-9]{2}$/.test(g.status_code):this.emit("progress",g,e);break;case /^2[0-9]{2}$/.test(g.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this];
this.emit("accepted",g,e);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",g,e),this.emit("failed",g,e)}};h.prototype.onRequestTimeout=function(){this.emit("failed",null,b.C.causes.REQUEST_TIMEOUT)};h.prototype.onTransportError=function(){this.emit("failed",null,b.C.causes.CONNECTION_ERROR)};b.ClientContext=h}},{}],39:[function(k,l,m){l.exports=function(b,h){return{USER_AGENT:b+"/"+h,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",
SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",
BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",
UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",
407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",
438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",
501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}}}},{}],40:[function(k,l,m){l.exports=function(b){var h;h=function(b,e,f){this.dialog=b;this.applicant=e;this.request=f;this.reattempt=!1;this.reattemptTimer=null};h.prototype={send:function(){var g=this,e=new b.RequestSender(this,this.dialog.owner.ua);
e.send();this.request.method===b.C.INVITE&&e.clientTransaction.state!==b.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,e.clientTransaction.on("stateChanged",function a(){if(this.state===b.Transactions.C.STATUS_ACCEPTED||this.state===b.Transactions.C.STATUS_COMPLETED||this.state===b.Transactions.C.STATUS_TERMINATED)if(this.removeListener("stateChanged",a),g.dialog.uac_pending_reply=!1,!1===g.dialog.uas_pending_reply)g.dialog.owner.onReadyToReinvite()}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},
onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(g){var e=this;if(408===g.status_code||481===g.status_code)this.applicant.onDialogError(g);else g.method===b.C.INVITE&&491===g.status_code?this.reattempt?this.applicant.receiveResponse(g):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=b.Timers.setTimeout(function(){e.applicant.owner.status!==b.Session.C.STATUS_TERMINATED&&(e.reattempt=!0,e.request_sender.send())},this.getReattemptTimeout())):
this.applicant.receiveResponse(g)}};return h}},{}],41:[function(k,l,m){l.exports=function(b){var h=k("./Dialog/RequestSender")(b),g,e={STATUS_EARLY:1,STATUS_CONFIRMED:2};g=function(f,a,c,d){var g;this.uas_pending_reply=this.uac_pending_reply=!1;if(!a.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};d=a instanceof b.IncomingResponse?200>a.status_code?e.STATUS_EARLY:e.STATUS_CONFIRMED:d||e.STATUS_CONFIRMED;g=a.parseHeader("contact");"UAS"===c?(this.id={call_id:a.call_id,
local_tag:a.to_tag,remote_tag:a.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.remote_seqnum=a.cseq,this.local_uri=a.parseHeader("to").uri,this.remote_uri=a.parseHeader("from").uri,this.remote_target=g.uri,this.route_set=a.getHeaders("record-route"),this.local_seqnum=this.invite_seqnum=a.cseq):"UAC"===c&&(this.id={call_id:a.call_id,local_tag:a.from_tag,remote_tag:a.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},
this.state=d,this.local_seqnum=this.invite_seqnum=a.cseq,this.local_uri=a.parseHeader("from").uri,this.pracked=[],this.remote_uri=a.parseHeader("to").uri,this.remote_target=g.uri,this.route_set=a.getHeaders("record-route").reverse(),this.state!==e.STATUS_EARLY||f.hasOffer||(this.mediaHandler=f.mediaHandlerFactory(f)));this.logger=f.ua.getLogger("sip.dialog",this.id.toString());this.owner=f;f.ua.dialogs[this.id.toString()]=this;this.logger.log("new "+c+" dialog created with status "+(this.state===
e.STATUS_EARLY?"EARLY":"CONFIRMED"));f.emit("dialog",this)};g.prototype={update:function(b,a){this.state=e.STATUS_CONFIRMED;this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state");"UAC"===a&&(this.route_set=b.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted");this.mediaHandler&&this.state!==e.STATUS_CONFIRMED&&this.mediaHandler.peerConnection.close();delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(e,
a,c){var d;a=(a||[]).slice();this.local_seqnum||(this.local_seqnum=Math.floor(1E4*Math.random()));d=e===b.C.CANCEL||e===b.C.ACK?this.invite_seqnum:this.local_seqnum+=1;e=new b.OutgoingRequest(e,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},a,c);e.dialog=this;return e},checkInDialogRequest:function(e){var a=this;if(this.remote_seqnum){if(e.cseq<this.remote_seqnum)return e.method!==
b.C.ACK&&e.reply(500),e.cseq===this.invite_seqnum?!0:!1;e.cseq>this.remote_seqnum&&(this.remote_seqnum=e.cseq)}else this.remote_seqnum=e.cseq;switch(e.method){case b.C.INVITE:if(!0===this.uac_pending_reply)e.reply(491);else{if(!0===this.uas_pending_reply){var c=(10*Math.random()|0)+1;e.reply(500,null,["Retry-After:"+c]);return!1}this.uas_pending_reply=!0;e.server_transaction.on("stateChanged",function p(){if(this.state===b.Transactions.C.STATUS_ACCEPTED||this.state===b.Transactions.C.STATUS_COMPLETED||
this.state===b.Transactions.C.STATUS_TERMINATED)if(this.removeListener("stateChanged",p),a.uas_pending_reply=!1,!1===a.uac_pending_reply)a.owner.onReadyToReinvite()})}if(e.hasHeader("contact"))e.server_transaction.on("stateChanged",function(){this.state===b.Transactions.C.STATUS_ACCEPTED&&(a.remote_target=e.parseHeader("contact").uri)});break;case b.C.NOTIFY:if(e.hasHeader("contact"))e.server_transaction.on("stateChanged",function(){this.state===b.Transactions.C.STATUS_COMPLETED&&(a.remote_target=
e.parseHeader("contact").uri)})}return!0},sendRequest:function(b,a,c){c=c||{};var d=(c.extraHeaders||[]).slice();a=this.createRequest(a,d,c.body||null);(new h(this,b,a)).send();return a},receiveRequest:function(b){this.checkInDialogRequest(b)&&this.owner.receiveRequest(b)}};g.C=e;b.Dialog=g}},{"./Dialog/RequestSender":40}],42:[function(k,l,m){l.exports=function(b){var h;h=function(b){this.logger=b.getLogger("sipjs.digestauthentication");this.username=b.configuration.authorizationUser;this.password=
b.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null};h.prototype.authenticate=function(g,e){this.algorithm=e.algorithm;this.realm=e.realm;this.nonce=e.nonce;this.opaque=e.opaque;this.stale=e.stale;if(this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),
!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(e.qop)if(-1<e.qop.indexOf("auth"))this.qop="auth";else if(-1<e.qop.indexOf("auth-int"))this.qop="auth-int";else return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this.qop=null;this.method=g.method;this.uri=g.ruri;this.cnonce=b.createRandomToken(12);this.nc+=1;this.updateNcHex();4294967296===this.nc&&(this.nc=1,this.ncHex=
"00000001");this.calculateResponse();return!0};h.prototype.calculateResponse=function(){var g,e;g=b.calculateMD5(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(e=b.calculateMD5(this.method+":"+this.uri),this.response=b.calculateMD5(g+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+e)):"auth-int"===this.qop?(e=b.calculateMD5(this.method+":"+this.uri+":"+b.calculateMD5(this.body?this.body:"")),this.response=b.calculateMD5(g+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+
e)):null===this.qop&&(e=b.calculateMD5(this.method+":"+this.uri),this.response=b.calculateMD5(g+":"+this.nonce+":"+e))};h.prototype.toString=function(){var b=[];if(!this.response)throw Error("response field does not exist, cannot generate Authorization header");b.push("algorithm="+this.algorithm);b.push('username="'+this.username+'"');b.push('realm="'+this.realm+'"');b.push('nonce="'+this.nonce+'"');b.push('uri="'+this.uri+'"');b.push('response="'+this.response+'"');this.opaque&&b.push('opaque="'+
this.opaque+'"');this.qop&&(b.push("qop="+this.qop),b.push('cnonce="'+this.cnonce+'"'),b.push("nc="+this.ncHex));return"Digest "+b.join(", ")};h.prototype.updateNcHex=function(){var b=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-b.length)+b};return h}},{}],43:[function(k,l,m){var b=k("events").EventEmitter;l.exports=function(h){function g(){b.call(this)}g.prototype=Object.create(b.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}});g.prototype.off=function(b,
f){var a;a="SIP.EventEmitter#off is deprecated and may be removed in future SIP.js versions.\nPlease use removeListener or removeAllListeners instead.\n";a+="See here for more details:\n";a+="http://nodejs.org/api/events.html#events_emitter_removelistener_event_listener";h.warn(a);return 2>arguments.length?this.removeAllListeners.apply(this,arguments):this.removeListener(b,f)};return g}},{events:5}],44:[function(k,l,m){l.exports={ConfigurationError:function(){var b=function(b,g){this.code=1;this.name=
"CONFIGURATION_ERROR";this.parameter=b;this.message=(this.value=g)?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};b.prototype=Error();return b}(),InvalidStateError:function(){var b=function(b){this.code=2;this.name="INVALID_STATE_ERROR";this.status=b;this.message="Invalid status: "+b};b.prototype=Error();return b}(),NotSupportedError:function(){var b=function(b){this.code=3;this.name="NOT_SUPPORTED_ERROR";this.message=b};b.prototype=
Error();return b}(),GetDescriptionError:function(){var b=function(b){this.code=4;this.name="GET_DESCRIPTION_ERROR";this.message=b};b.prototype=Error();return b}()}},{}],45:[function(k,l,m){var b=k("./Grammar/dist/Grammar");l.exports=function(h){return{parse:function(g,e){var f={startRule:e,SIP:h};try{b.parse(g,f)}catch(a){f.data=-1}return f.data}}}},{"./Grammar/dist/Grammar":46}],46:[function(k,l,m){l.exports=function(){function b(b,g,e,f,a,c){this.message=b;this.expected=g;this.found=e;this.offset=
f;this.line=a;this.column=c;this.name="SyntaxError"}(function(b,g){function e(){this.constructor=b}e.prototype=g.prototype;b.prototype=new e})(b,Error);return{SyntaxError:b,parse:function(h){function g(){return h.substring(C,v)}function e(a){if(q!==a){q>a&&(q=0,r={line:1,column:1,seenCR:!1});var c=r,b,d;for(b=q;b<a;b++)d=h.charAt(b),"\n"===d?(c.seenCR||c.line++,c.column=1,c.seenCR=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(c.line++,c.column=1,c.seenCR=!0):(c.column++,c.seenCR=!1);q=a}return r}function f(a){v<
t||(v>t&&(t=v,u=[]),u.push(a))}function a(a){var c=Array(a.length),b;for(b=0;b<a.length;b++)c[b]=a.charCodeAt(b)-32;return c}function c(a){function b(a){return"[object Array]"===Object.prototype.toString.apply(a)?[]:a}a=m[a];for(var d=0,e=[],g=a.length,n=[],k=[],w,q;;){for(;d<g;)switch(a[d]){case 0:k.push(b(l[a[d+1]]));d+=2;break;case 1:k.push(v);d++;break;case 2:k.pop();d++;break;case 3:v=k.pop();d++;break;case 4:k.length-=a[d+1];d+=2;break;case 5:k.splice(-2,1);d++;break;case 6:k[k.length-2].push(k.pop());
d++;break;case 7:k.push(k.splice(k.length-a[d+1],a[d+1]));d+=2;break;case 8:k.pop();k.push(h.substring(k[k.length-1],v));d++;break;case 9:n.push(g);e.push(d+3+a[d+1]+a[d+2]);k[k.length-1]?(g=d+3+a[d+1],d+=3):(g=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 10:n.push(g);e.push(d+3+a[d+1]+a[d+2]);k[k.length-1]===p?(g=d+3+a[d+1],d+=3):(g=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 11:n.push(g);e.push(d+3+a[d+1]+a[d+2]);k[k.length-1]!==p?(g=d+3+a[d+1],d+=3):(g=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 12:k[k.length-
1]!==p?(n.push(g),e.push(d),g=d+2+a[d+1],d+=2):d+=2+a[d+1];break;case 13:n.push(g);e.push(d+3+a[d+1]+a[d+2]);h.length>v?(g=d+3+a[d+1],d+=3):(g=d+3+a[d+1]+a[d+2],d+=3+a[d+1]);break;case 14:n.push(g);e.push(d+4+a[d+2]+a[d+3]);h.substr(v,l[a[d+1]].length)===l[a[d+1]]?(g=d+4+a[d+2],d+=4):(g=d+4+a[d+2]+a[d+3],d+=4+a[d+2]);break;case 15:n.push(g);e.push(d+4+a[d+2]+a[d+3]);h.substr(v,l[a[d+1]].length).toLowerCase()===l[a[d+1]]?(g=d+4+a[d+2],d+=4):(g=d+4+a[d+2]+a[d+3],d+=4+a[d+2]);break;case 16:n.push(g);
e.push(d+4+a[d+2]+a[d+3]);l[a[d+1]].test(h.charAt(v))?(g=d+4+a[d+2],d+=4):(g=d+4+a[d+2]+a[d+3],d+=4+a[d+2]);break;case 17:k.push(h.substr(v,a[d+1]));v+=a[d+1];d+=2;break;case 18:k.push(l[a[d+1]]);v+=l[a[d+1]].length;d+=2;break;case 19:k.push(p);0===F&&f(l[a[d+1]]);d+=2;break;case 20:C=k[k.length-1-a[d+1]];d+=2;break;case 21:C=v;d++;break;case 22:w=a.slice(d+4,d+4+a[d+3]);for(q=0;q<a[d+3];q++)w[q]=k[k.length-1-w[q]];k.splice(k.length-a[d+2],a[d+2],l[a[d+1]].apply(null,w));d+=4+a[d+3];break;case 23:k.push(c(a[d+
1]));d+=2;break;case 24:F++;d++;break;case 25:F--;d++;break;default:throw Error("Invalid opcode: "+a[d]+".");}if(0<n.length)g=n.pop(),d=e.pop();else break}return k[0]}var d=1<arguments.length?arguments[1]:{},p={},n={Contact:118,Name_Addr_Header:155,Record_Route:175,Request_Response:81,SIP_URI:45,Subscription_State:185,Via:193,absoluteURI:84,Call_ID:117,Content_Disposition:129,Content_Length:134,Content_Type:135,CSeq:145,displayName:121,Event:148,From:150,host:52,Max_Forwards:153,Proxy_Authenticate:156,
quoted_string:40,Refer_To:177,Replaces:178,stun_URI:212,To:191,turn_URI:219,uuid:222,WWW_Authenticate:208,challenge:157},k=118,l=["\r\n",{type:"literal",value:"\r\n",description:'"\\r\\n"'},/^[0-9]/,{type:"class",value:"[0-9]",description:"[0-9]"},/^[a-zA-Z]/,{type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},/^[0-9a-fA-F]/,{type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},/^[\0-\xFF]/,{type:"class",value:"[\\0-\\xFF]",description:"[\\0-\\xFF]"},/^["]/,{type:"class",value:'["]',description:'["]'},
" ",{type:"literal",value:" ",description:'" "'},"\t",{type:"literal",value:"\t",description:'"\\t"'},/^[a-zA-Z0-9]/,{type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},";",{type:"literal",value:";",description:'";"'},"/",{type:"literal",value:"/",description:'"/"'},"?",{type:"literal",value:"?",description:'"?"'},":",{type:"literal",value:":",description:'":"'},"@",{type:"literal",value:"@",description:'"@"'},"&",{type:"literal",value:"&",description:'"&"'},"=",{type:"literal",value:"=",
description:'"="'},"+",{type:"literal",value:"+",description:'"+"'},"$",{type:"literal",value:"$",description:'"$"'},",",{type:"literal",value:",",description:'","'},"-",{type:"literal",value:"-",description:'"-"'},"_",{type:"literal",value:"_",description:'"_"'},".",{type:"literal",value:".",description:'"."'},"!",{type:"literal",value:"!",description:'"!"'},"~",{type:"literal",value:"~",description:'"~"'},"*",{type:"literal",value:"*",description:'"*"'},"'",{type:"literal",value:"'",description:'"\'"'},
"(",{type:"literal",value:"(",description:'"("'},")",{type:"literal",value:")",description:'")"'},p,"%",{type:"literal",value:"%",description:'"%"'},null,[],function(){return" "},function(){return":"},/^[!-~]/,{type:"class",value:"[!-~]",description:"[!-~]"},/^[\x80-\uFFFF]/,{type:"class",value:"[\\x80-\\uFFFF]",description:"[\\x80-\\uFFFF]"},/^[\x80-\xBF]/,{type:"class",value:"[\\x80-\\xBF]",description:"[\\x80-\\xBF]"},/^[a-f]/,{type:"class",value:"[a-f]",description:"[a-f]"},"`",{type:"literal",
value:"`",description:'"`"'},"<",{type:"literal",value:"<",description:'"<"'},">",{type:"literal",value:">",description:'">"'},"\\",{type:"literal",value:"\\",description:'"\\\\"'},"[",{type:"literal",value:"[",description:'"["'},"]",{type:"literal",value:"]",description:'"]"'},"{",{type:"literal",value:"{",description:'"{"'},"}",{type:"literal",value:"}",description:'"}"'},function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},
function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,{type:"class",value:"[!-']",description:"[!-']"},/^[*-[]/,{type:"class",value:"[*-[]",description:"[*-[]"},/^[\]-~]/,{type:"class",value:"[\\]-~]",description:"[\\]-~]"},function(a){return a},/^[#-[]/,{type:"class",value:"[#-[]",description:"[#-[]"},/^[\0-\t]/,{type:"class",value:"[\\0-\\t]",description:"[\\0-\\t]"},/^[\x0B-\f]/,{type:"class",value:"[\\x0B-\\f]",description:"[\\x0B-\\f]"},
/^[\x0E-\u007f]/,{type:"class",value:"[\\x0E-\u007f]",description:"[\\x0E-\u007f]"},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port);delete d.data.scheme;delete d.data.user;delete d.data.host;delete d.data.host_type;delete d.data.port},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers);delete d.data.scheme;delete d.data.user;delete d.data.host;delete d.data.host_type;delete d.data.port;delete d.data.uri_params;
"SIP_URI"===d.startRule&&(d.data=d.data.uri)},"sips",{type:"literal",value:"sips",description:'"sips"'},"sip",{type:"literal",value:"sip",description:'"sip"'},function(a){d.data.scheme=a.toLowerCase()},function(){d.data.user=decodeURIComponent(g().slice(0,-1))},function(){d.data.password=g()},function(){d.data.host=g();return d.data.host},function(){d.data.host_type="domain";return g()},/^[a-zA-Z0-9_\-]/,{type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},/^[a-zA-Z0-9\-]/,{type:"class",
value:"[a-zA-Z0-9\\-]",description:"[a-zA-Z0-9\\-]"},function(){d.data.host_type="IPv6";return g()},"::",{type:"literal",value:"::",description:'"::"'},function(){d.data.host_type="IPv6";return g()},function(){d.data.host_type="IPv4";return g()},"25",{type:"literal",value:"25",description:'"25"'},/^[0-5]/,{type:"class",value:"[0-5]",description:"[0-5]"},"2",{type:"literal",value:"2",description:'"2"'},/^[0-4]/,{type:"class",value:"[0-4]",description:"[0-4]"},"1",{type:"literal",value:"1",description:'"1"'},
/^[1-9]/,{type:"class",value:"[1-9]",description:"[1-9]"},function(a){a=parseInt(a.join(""));return d.data.port=a},"transport=",{type:"literal",value:"transport=",description:'"transport="'},"udp",{type:"literal",value:"udp",description:'"udp"'},"tcp",{type:"literal",value:"tcp",description:'"tcp"'},"sctp",{type:"literal",value:"sctp",description:'"sctp"'},"tls",{type:"literal",value:"tls",description:'"tls"'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.transport=a.toLowerCase()},
"user=",{type:"literal",value:"user=",description:'"user="'},"phone",{type:"literal",value:"phone",description:'"phone"'},"ip",{type:"literal",value:"ip",description:'"ip"'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.user=a.toLowerCase()},"method=",{type:"literal",value:"method=",description:'"method="'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.method=a},"ttl=",{type:"literal",value:"ttl=",description:'"ttl="'},function(a){d.data.params||
(d.data.params={});d.data.params.ttl=a},"maddr=",{type:"literal",value:"maddr=",description:'"maddr="'},function(a){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.maddr=a},"lr",{type:"literal",value:"lr",description:'"lr"'},function(){d.data.uri_params||(d.data.uri_params={});d.data.uri_params.lr=void 0},function(a,c){d.data.uri_params||(d.data.uri_params={});c=null===c?void 0:c[1];d.data.uri_params[a.toLowerCase()]=c&&c.toLowerCase()},function(a,c){a=a.join("").toLowerCase();c=c.join("");
d.data.uri_headers||(d.data.uri_headers={});d.data.uri_headers[a]?d.data.uri_headers[a].push(c):d.data.uri_headers[a]=[c]},function(){"Refer_To"===d.startRule&&(d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port,delete d.data.uri_params)},"//",{type:"literal",value:"//",description:'"//"'},function(){d.data.scheme=g()},{type:"literal",
value:"SIP",description:'"SIP"'},function(){d.data.sip_version=g()},"INVITE",{type:"literal",value:"INVITE",description:'"INVITE"'},"ACK",{type:"literal",value:"ACK",description:'"ACK"'},"VXACH",{type:"literal",value:"VXACH",description:'"VXACH"'},"OPTIONS",{type:"literal",value:"OPTIONS",description:'"OPTIONS"'},"BYE",{type:"literal",value:"BYE",description:'"BYE"'},"CANCEL",{type:"literal",value:"CANCEL",description:'"CANCEL"'},"REGISTER",{type:"literal",value:"REGISTER",description:'"REGISTER"'},
"SUBSCRIBE",{type:"literal",value:"SUBSCRIBE",description:'"SUBSCRIBE"'},"NOTIFY",{type:"literal",value:"NOTIFY",description:'"NOTIFY"'},"REFER",{type:"literal",value:"REFER",description:'"REFER"'},function(){d.data.method=g();return d.data.method},function(a){d.data.status_code=parseInt(a.join(""))},function(){d.data.reason_phrase=g()},function(){d.data=g()},function(){var a,c;c=d.data.multi_header.length;for(a=0;a<c;a++)if(null===d.data.multi_header[a].parsed){d.data=null;break}d.data=null!==d.data?
d.data.multi_header:-1},function(){var a;d.data.multi_header||(d.data.multi_header=[]);try{a=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(c){a=null}d.data.multi_header.push({position:v,offset:C,parsed:a})},function(a){a=g().trim();'"'===a[0]&&(a=a.substring(1,a.length-1));d.data.displayName=a},"q",{type:"literal",value:"q",description:'"q"'},function(a){d.data.params||(d.data.params={});d.data.params.q=
a},"expires",{type:"literal",value:"expires",description:'"expires"'},function(a){d.data.params||(d.data.params={});d.data.params.expires=a},function(a){return parseInt(a.join(""))},"0",{type:"literal",value:"0",description:'"0"'},function(){return parseFloat(g())},function(a,c){d.data.params||(d.data.params={});c=null===c?void 0:c[1];d.data.params[a.toLowerCase()]=c},"render",{type:"literal",value:"render",description:'"render"'},"session",{type:"literal",value:"session",description:'"session"'},
"icon",{type:"literal",value:"icon",description:'"icon"'},"alert",{type:"literal",value:"alert",description:'"alert"'},function(){"Content_Disposition"===d.startRule&&(d.data.type=g().toLowerCase())},"handling",{type:"literal",value:"handling",description:'"handling"'},"optional",{type:"literal",value:"optional",description:'"optional"'},"required",{type:"literal",value:"required",description:'"required"'},function(a){d.data=parseInt(a.join(""))},function(){d.data=g()},"text",{type:"literal",value:"text",
description:'"text"'},"image",{type:"literal",value:"image",description:'"image"'},"audio",{type:"literal",value:"audio",description:'"audio"'},"video",{type:"literal",value:"video",description:'"video"'},"application",{type:"literal",value:"application",description:'"application"'},"message",{type:"literal",value:"message",description:'"message"'},"multipart",{type:"literal",value:"multipart",description:'"multipart"'},"x-",{type:"literal",value:"x-",description:'"x-"'},function(a){d.data.value=
parseInt(a.join(""))},function(a){d.data=a},function(a){d.data.event=a.toLowerCase()},function(){var a=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params);a&&d.data.setParam("tag",a)},"tag",{type:"literal",value:"tag",description:'"tag"'},function(a){d.data.tag=a},function(a){d.data=parseInt(a.join(""))},function(a){d.data=a},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},"digest",{type:"literal",value:"Digest",description:'"Digest"'},
"realm",{type:"literal",value:"realm",description:'"realm"'},function(a){d.data.realm=a},"domain",{type:"literal",value:"domain",description:'"domain"'},"nonce",{type:"literal",value:"nonce",description:'"nonce"'},function(a){d.data.nonce=a},"opaque",{type:"literal",value:"opaque",description:'"opaque"'},function(a){d.data.opaque=a},"stale",{type:"literal",value:"stale",description:'"stale"'},"true",{type:"literal",value:"true",description:'"true"'},function(){d.data.stale=!0},"false",{type:"literal",
value:"false",description:'"false"'},function(){d.data.stale=!1},"algorithm",{type:"literal",value:"algorithm",description:'"algorithm"'},"md5",{type:"literal",value:"MD5",description:'"MD5"'},"md5-sess",{type:"literal",value:"MD5-sess",description:'"MD5-sess"'},function(a){d.data.algorithm=a.toUpperCase()},"qop",{type:"literal",value:"qop",description:'"qop"'},"auth-int",{type:"literal",value:"auth-int",description:'"auth-int"'},"auth",{type:"literal",value:"auth",description:'"auth"'},function(a){d.data.qop||
(d.data.qop=[]);d.data.qop.push(a.toLowerCase())},function(a){d.data.value=parseInt(a.join(""))},function(){var a,c;c=d.data.multi_header.length;for(a=0;a<c;a++)if(null===d.data.multi_header[a].parsed){d.data=null;break}d.data=null!==d.data?d.data.multi_header:-1},function(){var a;d.data.multi_header||(d.data.multi_header=[]);try{a=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(c){a=null}d.data.multi_header.push({position:v,
offset:C,parsed:a})},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},function(){d.data.replaces_from_tag&&d.data.replaces_to_tag||(d.data=-1)},function(){d.data={call_id:d.data}},"from-tag",{type:"literal",value:"from-tag",description:'"from-tag"'},function(a){d.data.replaces_from_tag=a},"to-tag",{type:"literal",value:"to-tag",description:'"to-tag"'},function(a){d.data.replaces_to_tag=a},"early-only",{type:"literal",value:"early-only",description:'"early-only"'},
function(){d.data.early_only=!0},function(a){d.data.value=parseInt(a.join(""))},"active",{type:"literal",value:"active",description:'"active"'},"pending",{type:"literal",value:"pending",description:'"pending"'},"terminated",{type:"literal",value:"terminated",description:'"terminated"'},function(){d.data.state=g()},"reason",{type:"literal",value:"reason",description:'"reason"'},function(a){"undefined"!==typeof a&&(d.data.reason=a)},function(a){"undefined"!==typeof a&&(d.data.expires=a)},"retry_after",
{type:"literal",value:"retry_after",description:'"retry_after"'},function(a){"undefined"!==typeof a&&(d.data.retry_after=a)},"deactivated",{type:"literal",value:"deactivated",description:'"deactivated"'},"probation",{type:"literal",value:"probation",description:'"probation"'},"rejected",{type:"literal",value:"rejected",description:'"rejected"'},"timeout",{type:"literal",value:"timeout",description:'"timeout"'},"giveup",{type:"literal",value:"giveup",description:'"giveup"'},"noresource",{type:"literal",
value:"noresource",description:'"noresource"'},"invariant",{type:"literal",value:"invariant",description:'"invariant"'},function(){var a=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params);a&&d.data.setParam("tag",a)},"ttl",{type:"literal",value:"ttl",description:'"ttl"'},function(a){d.data.ttl=a},"maddr",{type:"literal",value:"maddr",description:'"maddr"'},function(a){d.data.maddr=a},"received",{type:"literal",value:"received",description:'"received"'},function(a){d.data.received=
a},"branch",{type:"literal",value:"branch",description:'"branch"'},function(a){d.data.branch=a},"rport",{type:"literal",value:"rport",description:'"rport"'},function(){"undefined"!==typeof response_port&&(d.data.rport=response_port.join(""))},function(a){d.data.protocol=a},{type:"literal",value:"UDP",description:'"UDP"'},{type:"literal",value:"TCP",description:'"TCP"'},{type:"literal",value:"TLS",description:'"TLS"'},{type:"literal",value:"SCTP",description:'"SCTP"'},function(a){d.data.transport=
a},function(){d.data.host=g()},function(a){d.data.port=parseInt(a.join(""))},function(a){return parseInt(a.join(""))},"stuns",{type:"literal",value:"stuns",description:'"stuns"'},"stun",{type:"literal",value:"stun",description:'"stun"'},function(a){d.data.scheme=a},function(a){d.data.host=a},"?transport=",{type:"literal",value:"?transport=",description:'"?transport="'},"turns",{type:"literal",value:"turns",description:'"turns"'},"turn",{type:"literal",value:"turn",description:'"turn"'},function(){d.data.transport=
transport},function(){d.data=g()}],m=[a('. ""2 3!'),a('0"""1!3#'),a('0$""1!3%'),a('0&""1!3\''),a("7'*# \"7("),a('0(""1!3)'),a('0*""1!3+'),a('.,""2,3-'),a('..""2.3/'),a('00""1!31'),a('.2""2233*\u0089 ".4""2435*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('7)*# "7,'),a('.F""2F3G*} ".H""2H3I*q ".J""2J3K*e ".L""2L3M*Y ".N""2N3O*M ".P""2P3Q*A ".R""2R3S*5 ".T""2T3U*) ".V""2V3W'),a('!!.Y""2Y3Z+7$7#+-%7#+#%\'#%$## X$"# X"# X+! (%'),a('!! \\7$,#&7$"+-$7 +#%\'"%$"# X"# X*# " [+@$ \\7$+&$,#&7$""" X+\'%4"6]" %$"# X"# X'),
a('7.*# " ['),a('! \\7\'*# "7(,)&7\'*# "7("+A$.8""2839+1%7/+\'%4#6^# %$## X$"# X"# X'),a('!! \\72+&$,#&72""" X+o$ \\! \\7.,#&7."+-$72+#%\'"%$"# X"# X,@&! \\7.,#&7."+-$72+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('0_""1!3`*# "73'),a('0a""1!3b'),a('0c""1!3d'),a('7!*) "0e""1!3f'),a('! \\7)*\u0095 ".F""2F3G*\u0089 ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+\u009e$,\u009b&7)*\u0095 ".F""2F3G*\u0089 ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),
a('! \\7)*\u0089 ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+\u0092$,\u008f&7)*\u0089 ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),a('.T""2T3U*\u00e3 ".V""2V3W*\u00d7 ".i""2i3j*\u00cb ".k""2k3l*\u00bf ".:""2:3;*\u00b3 ".D""2D3E*\u00a7 ".2""2233*\u009b ".8""2839*\u008f ".m""2m3n*\u0083 "7&*} ".4""2435*q ".o""2o3p*e ".q""2q3r*Y ".6""2637*M ".>""2>3?*A ".s""2s3t*5 ".u""2u3v*) "7\'*# "7('),
a('! \\7)*\u012b ".F""2F3G*\u011f ".J""2J3K*\u0113 ".L""2L3M*\u0107 ".Y""2Y3Z*\u00fb ".P""2P3Q*\u00ef ".H""2H3I*\u00e3 ".@""2@3A*\u00d7 ".g""2g3h*\u00cb ".R""2R3S*\u00bf ".N""2N3O*\u00b3 ".T""2T3U*\u00a7 ".V""2V3W*\u009b ".i""2i3j*\u008f ".k""2k3l*\u0083 ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v+\u0134$,\u0131&7)*\u012b ".F""2F3G*\u011f ".J""2J3K*\u0113 ".L""2L3M*\u0107 ".Y""2Y3Z*\u00fb ".P""2P3Q*\u00ef ".H""2H3I*\u00e3 ".@""2@3A*\u00d7 ".g""2g3h*\u00cb ".R""2R3S*\u00bf ".N""2N3O*\u00b3 ".T""2T3U*\u00a7 ".V""2V3W*\u009b ".i""2i3j*\u008f ".k""2k3l*\u0083 ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v""" X+! (%'),
a('!7/+A$.P""2P3Q+1%7/+\'%4#6w# %$## X$"# X"# X'),a('!7/+A$.4""2435+1%7/+\'%4#6x# %$## X$"# X"# X'),a('!7/+A$.>""2>3?+1%7/+\'%4#6y# %$## X$"# X"# X'),a('!7/+A$.T""2T3U+1%7/+\'%4#6z# %$## X$"# X"# X'),a('!7/+A$.V""2V3W+1%7/+\'%4#6{# %$## X$"# X"# X'),a('!.k""2k3l+1$7/+\'%4"6|" %$"# X"# X'),a('!7/+7$.i""2i3j+\'%4"6}" %$"# X"# X'),a('!7/+A$.D""2D3E+1%7/+\'%4#6~# %$## X$"# X"# X'),a('!7/+A$.2""2233+1%7/+\'%4#6\u007f# %$## X$"# X"# X'),a('!7/+A$.8""2839+1%7/+\'%4#6\u0080# %$## X$"# X"# X'),a('!7/+1$7&+\'%4"6\u0081" %$"# X"# X'),
a('!7&+1$7/+\'%4"6\u0081" %$"# X"# X'),a('!7=+W$ \\7G*) "7K*# "7F,/&7G*) "7K*# "7F"+-%7>+#%\'#%$## X$"# X"# X'),a('0\u0082""1!3\u0083*A "0\u0084""1!3\u0085*5 "0\u0086""1!3\u0087*) "73*# "7.'),a('!!7/+U$7&+K% \\7J*# "7K,)&7J*# "7K"+-%7&+#%\'$%$$# X$## X$"# X"# X+! (%'),a('!7/+`$7&+V%! \\7J*# "7K,)&7J*# "7K"+! (%+2%7&+(%4$6\u0088$!!%$$# X$## X$"# X"# X'),a('7.*G ".L""2L3M*; "0\u0089""1!3\u008a*/ "0\u0086""1!3\u0087*# "73'),a('!.m""2m3n+K$0\u008b""1!3\u008c*5 "0\u008d""1!3\u008e*) "0\u008f""1!3\u0090+#%\'"%$"# X"# X'),
a('!7N+Q$.8""2839+A%7O*# " [+1%7S+\'%4$6\u0091$ %$$# X$## X$"# X"# X'),a('!7N+k$.8""2839+[%7O*# " [+K%7S+A%7_+7%7l*# " [+\'%4&6\u0092& %$&# X$%# X$$# X$## X$"# X"# X'),a('!/\u0093""1$3\u0094*) "/\u0095""1#3\u0096+\' 4!6\u0097!! %'),a('!7P+b$!.8""2839+-$7R+#%\'"%$"# X"# X*# " [+7%.:""2:3;+\'%4#6\u0098# %$## X$"# X"# X'),a(' \\7+*) "7-*# "7Q+2$,/&7+*) "7-*# "7Q""" X'),a('.<""2<3=*q ".>""2>3?*e ".@""2@3A*Y ".B""2B3C*M ".D""2D3E*A ".2""2233*5 ".6""2637*) ".4""2435'),a('! \\7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E,e&7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E"+& 4!6\u0099! %'),
a('!7T+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6\u009a! %'),a('! \\!7V+3$.J""2J3K+#%\'"%$"# X"# X,>&!7V+3$.J""2J3K+#%\'"%$"# X"# X"+G$7W+=%.J""2J3K*# " [+\'%4#6\u009b# %$## X$"# X"# X'),a(' \\0\u009c""1!3\u009d+,$,)&0\u009c""1!3\u009d""" X'),a('!0$""1!3%+A$ \\0\u009e""1!3\u009f,)&0\u009e""1!3\u009f"+#%\'"%$"# X"# X'),a('!.o""2o3p+A$7Y+7%.q""2q3r+\'%4#6\u00a0# %$## X$"# X"# X'),a('!!7Z+\u00bf$.8""2839+\u00af%7Z+\u00a5%.8""2839+\u0095%7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'-%$-# X$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0838 "!.\u00a1""2\u00a13\u00a2+\u00af$7Z+\u00a5%.8""2839+\u0095%7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\',%$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0795 "!.\u00a1""2\u00a13\u00a2+\u0095$7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u070c "!.\u00a1""2\u00a13\u00a2+{$7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u069d "!.\u00a1""2\u00a13\u00a2+a$7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'&%$&# X$%# X$$# X$## X$"# X"# X*\u0648 "!.\u00a1""2\u00a13\u00a2+G$7Z+=%.8""2839+-%7[+#%\'$%$$# X$## X$"# X"# X*\u060d "!.\u00a1""2\u00a13\u00a2+-$7[+#%\'"%$"# X"# X*\u05ec "!.\u00a1""2\u00a13\u00a2+-$7Z+#%\'"%$"# X"# X*\u05cb "!7Z+\u00a5$.\u00a1""2\u00a13\u00a2+\u0095%7Z+\u008b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'+%$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0538 "!7Z+\u00b6$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u008b%.\u00a1""2\u00a13\u00a2+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0494 "!7Z+\u00c7$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u009c%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+q%.\u00a1""2\u00a13\u00a2+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\')%$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u03df "!7Z+\u00d8$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u00ad%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u0082%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+W%.\u00a1""2\u00a13\u00a2+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0319 "!7Z+\u00e9$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u00be%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u0093%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.\u00a1""2\u00a13\u00a2+-%7[+#%\'\'%$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0242 "!7Z+\u0114$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u00e9%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u00be%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u0093%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.\u00a1""2\u00a13\u00a2+-%7Z+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0140 "!7Z+\u0135$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u010a%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u00df%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u00b4%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u0089%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+^%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+3%.\u00a1""2\u00a13\u00a2+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X+& 4!6\u00a3! %'),
a('!7#+S$7#*# " [+C%7#*# " [+3%7#*# " [+#%\'$%$$# X$## X$"# X"# X'),a('!7Z+=$.8""2839+-%7Z+#%\'#%$## X$"# X"# X*# "7\\'),a('!7]+u$.J""2J3K+e%7]+[%.J""2J3K+K%7]+A%.J""2J3K+1%7]+\'%4\'6\u00a4\' %$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!.\u00a5""2\u00a53\u00a6+3$0\u00a7""1!3\u00a8+#%\'"%$"# X"# X*\u00a0 "!.\u00a9""2\u00a93\u00aa+=$0\u00ab""1!3\u00ac+-%7!+#%\'#%$## X$"# X"# X*o "!.\u00ad""2\u00ad3\u00ae+7$7!+-%7!+#%\'#%$## X$"# X"# X*D "!0\u00af""1!3\u00b0+-$7!+#%\'"%$"# X"# X*# "7!'),a('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6\u00b1!! %'),
a(' \\!.2""2233+-$7`+#%\'"%$"# X"# X,>&!.2""2233+-$7`+#%\'"%$"# X"# X"'),a('7a*A "7b*; "7c*5 "7d*/ "7e*) "7f*# "7g'),a('!/\u00b2""1*3\u00b3+b$/\u00b4""1#3\u00b5*G "/\u00b6""1#3\u00b7*; "/\u00b8""1$3\u00b9*/ "/\u00ba""1#3\u00bb*# "76+(%4"6\u00bc"! %$"# X"# X'),a('!/\u00bd""1%3\u00be+J$/\u00bf""1%3\u00c0*/ "/\u00c1""1"3\u00c2*# "76+(%4"6\u00c3"! %$"# X"# X'),a('!/\u00c4""1\'3\u00c5+2$7\u008f+(%4"6\u00c6"! %$"# X"# X'),a('!/\u00c7""1$3\u00c8+2$7\u00ef+(%4"6\u00c9"! %$"# X"# X'),a('!/\u00ca""1&3\u00cb+2$7T+(%4"6\u00cc"! %$"# X"# X'),
a('!/\u00cd""1"3\u00ce+R$!.>""2>3?+-$76+#%\'"%$"# X"# X*# " [+\'%4"6\u00cf" %$"# X"# X'),a('!7h+T$!.>""2>3?+-$7i+#%\'"%$"# X"# X*# " [+)%4"6\u00d0""! %$"# X"# X'),a('! \\7j+&$,#&7j""" X+! (%'),a('! \\7j+&$,#&7j""" X+! (%'),a('7k*) "7+*# "7-'),a('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".8""2839*A ".<""2<3=*5 ".@""2@3A*) ".B""2B3C'),a('!.6""2637+u$7m+k% \\!.<""2<3=+-$7m+#%\'"%$"# X"# X,>&!.<""2<3=+-$7m+#%\'"%$"# X"# X"+#%\'#%$## X$"# X"# X'),a('!7n+C$.>""2>3?+3%7o+)%4#6\u00d1#"" %$## X$"# X"# X'),a(' \\7p*) "7+*# "7-+2$,/&7p*) "7+*# "7-""" X'),
a(' \\7p*) "7+*# "7-,/&7p*) "7+*# "7-"'),a('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".6""2637*A ".8""2839*5 ".@""2@3A*) ".B""2B3C'),a('7\u0090*# "7r'),a("!7\u008f+K$7'+A%7s+7%7'+-%7\u0084+#%'%%$%# X$$# X$## X$\"# X\"# X"),a('7M*# "7t'),a('!7\u007f+G$.8""2839+7%7u*# "7x+\'%4#6\u00d2# %$## X$"# X"# X'),a('!7v*# "7w+N$!.6""2637+-$7\u0083+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!.\u00d3""2\u00d33\u00d4+=$7\u0080+3%7w*# " [+#%\'#%$## X$"# X"# X'),a('!.4""2435+-$7{+#%\'"%$"# X"# X'),a('!7z+5$ \\7y,#&7y"+#%\'"%$"# X"# X'),
a('7**) "7+*# "7-'),a('7+*\u008f "7-*\u0089 ".2""2233*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7|+k$ \\!.4""2435+-$7|+#%\'"%$"# X"# X,>&!.4""2435+-$7|+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7~,#&7~"+k$ \\!.2""2233+-$7}+#%\'"%$"# X"# X,>&!.2""2233+-$7}+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a(' \\7~,#&7~"'),a('7+*w "7-*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7"+\u008d$ \\7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K,M&7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K"+\'%4"6\u00d5" %$"# X"# X'),
a('7\u0081*# "7\u0082'),a('!!7O+3$.:""2:3;+#%\'"%$"# X"# X*# " [+-$7S+#%\'"%$"# X"# X*# " ['),a(' \\7+*\u0083 "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A+\u008c$,\u0089&7+*\u0083 "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A""" X'),a(' \\7y,#&7y"'),a('!/\u0095""1#3\u00d6+y$.4""2435+i% \\7!+&$,#&7!""" X+P%.J""2J3K+@% \\7!+&$,#&7!""" X+\'%4%6\u00d7% %$%# X$$# X$## X$"# X"# X'),a('.\u00d8""2\u00d83\u00d9'),
a('.\u00da""2\u00da3\u00db'),a('.\u00dc""2\u00dc3\u00dd'),a('.\u00de""2\u00de3\u00df'),a('.\u00e0""2\u00e03\u00e1'),a('.\u00e2""2\u00e23\u00e3'),a('.\u00e4""2\u00e43\u00e5'),a('.\u00e6""2\u00e63\u00e7'),a('.\u00e8""2\u00e83\u00e9'),a('.\u00ea""2\u00ea3\u00eb'),a('!7\u0085*S "7\u0086*M "7\u0088*G "7\u0089*A "7\u008a*; "7\u008b*5 "7\u008c*/ "7\u008d*) "7\u008e*# "76+& 4!6\u00ec! %'),a("!7\u0084+K$7'+A%7\u0091+7%7'+-%7\u0093+#%'%%$%# X$$# X$## X$\"# X\"# X"),a("!7\u0092+' 4!6\u00ed!! %"),a('!7!+7$7!+-%7!+#%\'#%$## X$"# X"# X'),
a('! \\7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7(,G&7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7("+& 4!6\u00ee! %'),a('!7\u00b5+_$ \\!7A+-$7\u00b5+#%\'"%$"# X"# X,8&!7A+-$7\u00b5+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!79+R$!.:""2:3;+-$79+#%\'"%$"# X"# X*# " [+\'%4"6\u00ef" %$"# X"# X'),a('!7:*j "!7\u0097+_$ \\!7A+-$7\u0097+#%\'"%$"# X"# X,8&!7A+-$7\u0097+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+& 4!6\u00f0! %'),a('!7L*# "7\u0098+c$ \\!7B+-$7\u009a+#%\'"%$"# X"# X,8&!7B+-$7\u009a+#%\'"%$"# X"# X"+\'%4"6\u00f1" %$"# X"# X'),
a('!7\u0099*# " [+A$7@+7%7M+-%7?+#%\'$%$$# X$## X$"# X"# X'),a('!!76+_$ \\!7.+-$76+#%\'"%$"# X"# X,8&!7.+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# "7H+\' 4!6\u00f2!! %'),a('7\u009b*) "7\u009c*# "7\u009f'),a('!/\u00f3""1!3\u00f4+<$7<+2%7\u009e+(%4#6\u00f5#! %$## X$"# X"# X'),a('!/\u00f6""1\'3\u00f7+<$7<+2%7\u009d+(%4#6\u00f8#! %$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6\u00f9!! %'),a('!.\u00fa""2\u00fa3\u00fb+x$!.J""2J3K+S$7!*# " [+C%7!*# " [+3%7!*# " [+#%\'$%$$# X$## X$"# X"# X*# " [+\'%4"6\u00fc" %$"# X"# X'),
a('!76+N$!7<+-$7\u00a0+#%\'"%$"# X"# X*# " [+)%4"6\u00fd""! %$"# X"# X'),a('76*) "7T*# "7H'),a('!7\u00a2+_$ \\!7B+-$7\u00a3+#%\'"%$"# X"# X,8&!7B+-$7\u00a3+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/\u00fe""1&3\u00ff*G "/\u0100""1\'3\u0101*; "/\u0102""1$3\u0103*/ "/\u0104""1%3\u0105*# "76+& 4!6\u0106! %'),a('7\u00a4*# "7\u009f'),a('!/\u0107""1(3\u0108+O$7<+E%/\u0109""1(3\u010a*/ "/\u010b""1(3\u010c*# "76+#%\'#%$## X$"# X"# X'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),
a('! \\7!+&$,#&7!""" X+\' 4!6\u010d!! %'),a("!7\u00a8+& 4!6\u010e! %"),a('!7\u00a9+s$7;+i%7\u00ae+_% \\!7B+-$7\u00af+#%\'"%$"# X"# X,8&!7B+-$7\u00af+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7\u00aa*# "7\u00ab'),a('/\u010f""1$3\u0110*S "/\u0111""1%3\u0112*G "/\u0113""1%3\u0114*; "/\u0115""1%3\u0116*/ "/\u0117""1+3\u0118*# "7\u00ac'),a('/\u0119""1\'3\u011a*/ "/\u011b""1)3\u011c*# "7\u00ac'),a('76*# "7\u00ad'),a('!/\u011d""1"3\u011e+-$76+#%\'"%$"# X"# X'),a('7\u00ac*# "76'),a('!76+7$7<+-%7\u00b0+#%\'#%$## X$"# X"# X'),
a('76*# "7H'),a('!7\u00b2+7$7.+-%7\u008f+#%\'#%$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6\u011f!! %'),a("!7\u009d+' 4!6\u0120!! %"),a('!7\u00b5+d$ \\!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+(%4"6\u0121"!!%$"# X"# X'),a('!!77+k$ \\!.J""2J3K+-$77+#%\'"%$"# X"# X,>&!.J""2J3K+-$77+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('!7L*# "7\u0098+c$ \\!7B+-$7\u00b7+#%\'"%$"# X"# X,8&!7B+-$7\u00b7+#%\'"%$"# X"# X"+\'%4"6\u0122" %$"# X"# X'),a('7\u00b8*# "7\u009f'),a('!/\u0123""1#3\u0124+<$7<+2%76+(%4#6\u0125#! %$## X$"# X"# X'),
a('! \\7!+&$,#&7!""" X+\' 4!6\u0126!! %'),a("!7\u009d+' 4!6\u0127!! %"),a('! \\7\u0099,#&7\u0099"+\u0081$7@+w%7M+m%7?+c% \\!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+\'%4%6\u0128% %$%# X$$# X$## X$"# X"# X'),a("7\u00bd"),a('!/\u0129""1&3\u012a+s$7.+i%7\u00c0+_% \\!7A+-$7\u00c0+#%\'"%$"# X"# X,8&!7A+-$7\u00c0+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X*# "7\u00be'),a('!76+s$7.+i%7\u00bf+_% \\!7A+-$7\u00bf+#%\'"%$"# X"# X,8&!7A+-$7\u00bf+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),
a('!76+=$7<+3%76*# "7H+#%\'#%$## X$"# X"# X'),a('7\u00c1*G "7\u00c3*A "7\u00c5*; "7\u00c7*5 "7\u00c8*/ "7\u00c9*) "7\u00ca*# "7\u00bf'),a('!/\u012b""1%3\u012c+7$7<+-%7\u00c2+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6\u012d!! %"),a('!/\u012e""1&3\u012f+\u00a5$7<+\u009b%7D+\u0091%7\u00c4+\u0087% \\! \\7\'+&$,#&7\'""" X+-$7\u00c4+#%\'"%$"# X"# X,G&! \\7\'+&$,#&7\'""" X+-$7\u00c4+#%\'"%$"# X"# X"+-%7E+#%\'&%$&# X$%# X$$# X$## X$"# X"# X'),a('7t*# "7w'),a('!/\u0130""1%3\u0131+7$7<+-%7\u00c6+#%\'#%$## X$"# X"# X'),
a("!7I+' 4!6\u0132!! %"),a('!/\u0133""1&3\u0134+<$7<+2%7I+(%4#6\u0135#! %$## X$"# X"# X'),a('!/\u0136""1%3\u0137+_$7<+U%!/\u0138""1$3\u0139+& 4!6\u013a! %*4 "!/\u013b""1%3\u013c+& 4!6\u013d! %+#%\'#%$## X$"# X"# X'),a('!/\u013e""1)3\u013f+T$7<+J%/\u0140""1#3\u0141*/ "/\u0142""1(3\u0143*# "76+(%4#6\u0144#! %$## X$"# X"# X'),a('!/\u0145""1#3\u0146+\u009e$7<+\u0094%7D+\u008a%!7\u00cb+k$ \\!.D""2D3E+-$7\u00cb+#%\'"%$"# X"# X,>&!.D""2D3E+-$7\u00cb+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+-%7E+#%\'%%$%# X$$# X$## X$"# X"# X'),
a('!/\u0147""1(3\u0148*/ "/\u0149""1$3\u014a*# "76+\' 4!6\u014b!! %'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u00ce+K$7.+A%7\u00ce+7%7.+-%7\u008f+#%\'%%$%# X$$# X$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6\u014c!! %'),a('!7\u00d0+c$ \\!7A+-$7\u00d0+#%\'"%$"# X"# X,8&!7A+-$7\u00d0+#%\'"%$"# X"# X"+\'%4"6\u014d" %$"# X"# X'),a('!7\u0098+c$ \\!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+\'%4"6\u014e" %$"# X"# X'),a('!7L*T "7\u0098*N "!7@*# " [+=$7t+3%7?*# " [+#%\'#%$## X$"# X"# X+c$ \\!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+\'%4"6\u014f" %$"# X"# X'),
a('!7\u00d3+c$ \\!7B+-$7\u00d4+#%\'"%$"# X"# X,8&!7B+-$7\u00d4+#%\'"%$"# X"# X"+\'%4"6\u0150" %$"# X"# X'),a("!7\u0095+& 4!6\u0151! %"),a('!/\u0152""1(3\u0153+<$7<+2%76+(%4#6\u0154#! %$## X$"# X"# X*j "!/\u0155""1&3\u0156+<$7<+2%76+(%4#6\u0157#! %$## X$"# X"# X*: "!/\u0158""1*3\u0159+& 4!6\u015a! %*# "7\u009f'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u00d7+_$ \\!7A+-$7\u00d7+#%\'"%$"# X"# X,8&!7A+-$7\u00d7+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u0098+_$ \\!7B+-$7\u009f+#%\'"%$"# X"# X,8&!7B+-$7\u009f+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),
a('! \\7!+&$,#&7!""" X+\' 4!6\u015b!! %'),a('!7\u00da+_$ \\!7B+-$7\u00db+#%\'"%$"# X"# X,8&!7B+-$7\u00db+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/\u015c""1&3\u015d*; "/\u015e""1\'3\u015f*/ "/\u0160""1*3\u0161*# "76+& 4!6\u0162! %'),a('!/\u0163""1&3\u0164+<$7<+2%7\u00dc+(%4#6\u0165#! %$## X$"# X"# X*\u0083 "!/\u00f6""1\'3\u00f7+<$7<+2%7\u009d+(%4#6\u0166#! %$## X$"# X"# X*S "!/\u0167""1+3\u0168+<$7<+2%7\u009d+(%4#6\u0169#! %$## X$"# X"# X*# "7\u009f'),a('/\u016a""1+3\u016b*k "/\u016c""1)3\u016d*_ "/\u016e""1(3\u016f*S "/\u0170""1\'3\u0171*G "/\u0172""1&3\u0173*; "/\u0174""1*3\u0175*/ "/\u0176""1)3\u0177*# "76'),
a('71*# " ['),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# " ['),a('!7L*# "7\u0098+c$ \\!7B+-$7\u00e0+#%\'"%$"# X"# X,8&!7B+-$7\u00e0+#%\'"%$"# X"# X"+\'%4"6\u0178" %$"# X"# X'),a('7\u00b8*# "7\u009f'),a('!7\u00e2+_$ \\!7A+-$7\u00e2+#%\'"%$"# X"# X,8&!7A+-$7\u00e2+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7\u00e9+s$7.+i%7\u00ec+_% \\!7B+-$7\u00e3+#%\'"%$"# X"# X,8&!7B+-$7\u00e3+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7\u00e4*; "7\u00e5*5 "7\u00e6*/ "7\u00e7*) "7\u00e8*# "7\u009f'),
a('!/\u0179""1#3\u017a+<$7<+2%7\u00ef+(%4#6\u017b#! %$## X$"# X"# X'),a('!/\u017c""1%3\u017d+<$7<+2%7T+(%4#6\u017e#! %$## X$"# X"# X'),a('!/\u017f""1(3\u0180+B$7<+8%7\\*# "7Y+(%4#6\u0181#! %$## X$"# X"# X'),a('!/\u0182""1&3\u0183+<$7<+2%76+(%4#6\u0184#! %$## X$"# X"# X'),a('!/\u0185""1%3\u0186+T$!7<+5$ \\7!,#&7!"+#%\'"%$"# X"# X*# " [+\'%4"6\u0187" %$"# X"# X'),a('!7\u00ea+K$7;+A%76+7%7;+-%7\u00eb+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/\u0095""1#3\u00d6*# "76+\' 4!6\u0188!! %'),a('!/\u00b4""1#3\u0189*G "/\u00b6""1#3\u018a*; "/\u00ba""1#3\u018b*/ "/\u00b8""1$3\u018c*# "76+\' 4!6\u018d!! %'),
a('!7\u00ed+H$!7C+-$7\u00ee+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6\u018e! %'),a('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6\u018f!! %'),a('!!7!+C$7!*# " [+3%7!*# " [+#%\'#%$## X$"# X"# X+\' 4!6\u0190!! %'),a("7\u00bd"),a('!76+7$70+-%7\u00f2+#%\'#%$## X$"# X"# X'),a(' \\72*) "74*# "7.,/&72*) "74*# "7."'),a(' \\7%,#&7%"'),a('!7\u00f5+=$.8""2839+-%7\u00f6+#%\'#%$## X$"# X"# X'),a('!/\u0191""1%3\u0192*) "/\u0193""1$3\u0194+\' 4!6\u0195!! %'),
a('!7\u00f7+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7\\*) "7X*# "7\u0082+\' 4!6\u0196!! %'),a('! \\7\u00f9*) "7-*# "7\u00fa,/&7\u00f9*) "7-*# "7\u00fa"+! (%'),a('7"*S "7!*M ".F""2F3G*A ".J""2J3K*5 ".H""2H3I*) ".N""2N3O'),a('.L""2L3M*\u0095 ".B""2B3C*\u0089 ".<""2<3=*} ".R""2R3S*q ".T""2T3U*e ".V""2V3W*Y ".P""2P3Q*M ".@""2@3A*A ".D""2D3E*5 ".2""2233*) ".>""2>3?'),a('!7\u00fc+h$.8""2839+X%7\u00f6+N%!.\u0197""2\u01973\u0198+-$7\u00eb+#%\'"%$"# X"# X*# " [+#%\'$%$$# X$## X$"# X"# X'),
a('!/\u0199""1%3\u019a*) "/\u019b""1$3\u019c+\' 4!6\u0195!! %'),a('!7\u00eb+Q$/\u00b4""1#3\u00b5*7 "/\u00b6""1#3\u00b7*+ " \\7+,#&7+"+\'%4"6\u019d" %$"# X"# X'),a('!7\u0100+\u008f$.F""2F3G+\u007f%7\u00ff+u%.F""2F3G+e%7\u00ff+[%.F""2F3G+K%7\u00ff+A%.F""2F3G+1%7\u0101+\'%4)6\u019e) %$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!7#+A$7#+7%7#+-%7#+#%\'$%$$# X$## X$"# X"# X'),a('!7\u00ff+-$7\u00ff+#%\'"%$"# X"# X'),a('!7\u00ff+7$7\u00ff+-%7\u00ff+#%\'#%$## X$"# X"# X')],v=0,C=0,q=0,r={line:1,column:1,
seenCR:!1},t=0,u=[],F=0;if("startRule"in d){if(!(d.startRule in n))throw Error("Can't start parsing from rule \""+d.startRule+'".');k=n[d.startRule]}d.data={};n=c(k);if(n!==p&&v===h.length)return n;n!==p&&v<h.length&&f({type:"end",description:"end of input"});throw function(a,c,d){function f(a){var c=1;for(a.sort(function(a,c){return a.description<c.description?-1:a.description>c.description?1:0});c<a.length;)a[c-1]===a[c]?a.splice(c,1):c++}function g(a,c){function b(a){function c(a){return a.charCodeAt(0).toString(16).toUpperCase()}
return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+c(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+c(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+c(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+c(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+
" or "+d[a.length-1]:d[0];e=c?'"'+b(c)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var p=e(d),n=d<h.length?h.charAt(d):null;null!==c&&f(c);return new b(null!==a?a:g(c,n),c,n,d,p.line,p.column)}(null,u,t);}}}()},{}],47:[function(k,l,m){l.exports=function(b){var h={AllBrowsers:{maskDtls:function(b){b.body&&(b.body=b.body.replace(/ UDP\/TLS\/RTP\/SAVP/gmi," RTP/SAVP"))},unmaskDtls:function(b){return b.replace(/ RTP\/SAVP/gmi," UDP/TLS/RTP/SAVP")}},Firefox:{isFirefox:function(){return"undefined"!==
typeof mozRTCPeerConnection},cannotHandleExtraWhitespace:function(b){this.isFirefox()&&b.body&&(b.body=b.body.replace(/ \r\n/g,"\r\n"))},hasMissingCLineInSDP:function(b){var e,f;if(b.indexOf("c=")>b.indexOf("m=")){f=b.match(/m=.*\r\n.*/g);for(var a=0;a<f.length;a++)0<=f[a].toString().search(/i=.*/)?(e=b.indexOf(f[a].toString())+f[a].toString().length,"c="!==b.substr(e,2)&&(b=b.substr(0,e)+"\r\nc=IN IP4 0.0.0.0"+b.substr(e))):0>f[a].toString().search(/c=.*/)&&(e=b.indexOf(f[a].toString().match(/.*/))+
f[a].toString().match(/.*/).toString().length,b=b.substr(0,e)+"\r\nc=IN IP4 0.0.0.0"+b.substr(e))}return b},hasIncompatibleCLineWithSomeSIPEndpoints:function(g){return g.replace(/(0\.0\.0\.0)/gmi,b.Utils.getRandomTestNetIP())}},Chrome:{needsExplicitlyInactiveSDP:function(b){var e,f;return h.Firefox.isFirefox()&&(f=b.indexOf("m=video 0"),-1!==f)?(e=b.substr(f),e=e.replace(/\r\nc=IN IP4.*\r\n$/,"\r\nc=IN IP4 0.0.0.0\r\na=inactive\r\n"),b.substr(0,f)+e):b},getsConfusedAboutGUM:function(b){b.mediaHandler&&
b.mediaHandler.close()}}};return h}},{}],48:[function(k,l,m){var b={error:0,warn:1,log:2,debug:3};l.exports=function(h){function g(b,a,c){this.logger=b;this.category=a;this.label=c}var e=function(){var e,a=2,c=!0,d=null;this.loggers={};e=this.getLogger("sip.loggerfactory");Object.defineProperties(this,{builtinEnabled:{get:function(){return c},set:function(a){"boolean"===typeof a?c=a:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(a))}},level:{get:function(){return a},set:function(c){0<=
c&&3>=c?a=c:3<c?a=3:b.hasOwnProperty(c)?a=b[c]:e.error('invalid "level" parameter value: '+JSON.stringify(c))}},connector:{get:function(){return d},set:function(a){null===a||""===a||void 0===a?d=null:"function"===typeof a?d=a:e.error('invalid "connector" parameter value: '+JSON.stringify(a))}}})};e.prototype.print=function(b,a,c,d){"string"===typeof d&&(a=[new Date,a],c&&a.push(c),d=a.concat(d).join(" | "));b.call(h,d)};Object.keys(b).forEach(function(f){g.prototype[f]=function(a){this.logger[f](this.category,
this.label,a)};e.prototype[f]=function(a,c,d){this.level>=b[f]&&(this.builtinEnabled&&this.print(h[f],a,c,d),this.connector&&this.connector(f,a,c,d))}});e.prototype.getLogger=function(b,a){var c;if(a&&3===this.level)return new g(this,b,a);if(this.loggers[b])return this.loggers[b];c=new g(this,b);return this.loggers[b]=c};return e}},{}],49:[function(k,l,m){l.exports=function(b){var h=function(b,e){};h.prototype=Object.create(b.prototype,{isReady:{value:function(){}},close:{value:function(){}},getDescription:{value:function(b){}},
setDescription:{value:function(b){}}});return h}},{}],50:[function(k,l,m){l.exports=function(b){var h;h=function(g,e,f){var a;if(!(g&&g instanceof b.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=g;this.parameters={};for(a in f)this.setParam(a,f[a]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||g.aor}},displayName:{get:function(){return e},set:function(a){e=0===a?"0":a}}})};h.prototype={setParam:function(b,e){b&&(this.parameters[b.toLowerCase()]=
"undefined"===typeof e||null===e?null:e.toString())},getParam:b.URI.prototype.getParam,hasParam:b.URI.prototype.hasParam,deleteParam:b.URI.prototype.deleteParam,clearParams:b.URI.prototype.clearParams,clone:function(){return new h(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var b,e;b=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"";b+="<"+this.uri.toString()+">";for(e in this.parameters)b+=";"+e,null!==this.parameters[e]&&
(b+="="+this.parameters[e]);return b}};h.parse=function(g){g=b.Grammar.parse(g,"Name_Addr_Header");if(-1!==g)return g};b.NameAddrHeader=h}},{}],51:[function(k,l,m){l.exports=function(b){b.Parser={parseMessage:function(h,g){var e,f,a,c,d=0;a=h.indexOf("\r\n");f=g.getLogger("sip.parser");if(-1===a)f.warn("no CRLF found, not a SIP message, discarded");else if(e=h.substring(0,a),c=b.Grammar.parse(e,"Request_Response"),-1===c)f.warn('error parsing first line of SIP message: "'+e+'"');else{c.status_code?
(e=new b.IncomingResponse(g),e.status_code=c.status_code,e.reason_phrase=c.reason_phrase):(e=new b.IncomingRequest(g),e.method=c.method,e.ruri=c.uri);e.data=h;for(d=a+2;;){a:{a=h;c=d;var p=0,n=0;if(a.substring(c,c+2).match(/(^\r\n)/))a=-2;else{for(;0===p;){n=a.indexOf("\r\n",c);if(-1===n){a=n;break a}!a.substring(n+2,n+4).match(/(^\r\n)/)&&a.charAt(n+2).match(/(^\s+)/)?c=n+2:p=n}a=p}}if(-2===a){a=d+2;break}else if(-1===a){f.error("malformed message");return}c=e;var p=h,k=d,d=a,l=n=void 0,m=void 0,
v=void 0,n=p.indexOf(":",k),k=p.substring(k,n).trim(),p=p.substring(n+1,d).trim();switch(k.toLowerCase()){case "via":case "v":c.addHeader("via",p);if(1===c.getHeaders("via").length){if(v=c.parseHeader("Via"))c.via=v,c.via_branch=v.branch}else v=0;break;case "from":case "f":c.setHeader("from",p);if(v=c.parseHeader("from"))c.from=v,c.from_tag=v.getParam("tag");break;case "to":case "t":c.setHeader("to",p);if(v=c.parseHeader("to"))c.to=v,c.to_tag=v.getParam("tag");break;case "record-route":v=b.Grammar.parse(p,
"Record_Route");if(-1===v){v=void 0;break}m=v.length;for(l=0;l<m;l++)n=v[l],c.addHeader("record-route",p.substring(n.position,n.offset)),c.headers["Record-Route"][c.getHeaders("record-route").length-1].parsed=n.parsed;break;case "call-id":case "i":c.setHeader("call-id",p);if(v=c.parseHeader("call-id"))c.call_id=p;break;case "contact":case "m":v=b.Grammar.parse(p,"Contact");if(-1===v){v=void 0;break}m=v.length;for(l=0;l<m;l++)n=v[l],c.addHeader("contact",p.substring(n.position,n.offset)),c.headers.Contact[c.getHeaders("contact").length-
1].parsed=n.parsed;break;case "content-length":case "l":c.setHeader("content-length",p);v=c.parseHeader("content-length");break;case "content-type":case "c":c.setHeader("content-type",p);v=c.parseHeader("content-type");break;case "cseq":c.setHeader("cseq",p);if(v=c.parseHeader("cseq"))c.cseq=v.value;c instanceof b.IncomingResponse&&(c.method=v.method);break;case "max-forwards":c.setHeader("max-forwards",p);v=c.parseHeader("max-forwards");break;case "www-authenticate":c.setHeader("www-authenticate",
p);v=c.parseHeader("www-authenticate");break;case "proxy-authenticate":c.setHeader("proxy-authenticate",p);v=c.parseHeader("proxy-authenticate");break;case "refer-to":case "r":c.setHeader("refer-to",p);if(v=c.parseHeader("refer-to"))c.refer_to=v;break;default:c.setHeader(k,p),v=0}c=void 0===v?{error:'error parsing header "'+k+'"'}:!0;if(!0!==c){f.error(c.error);return}d=a+2}e.hasHeader("content-length")?(f=e.getHeader("content-length"),e.body=h.substr(a,f)):e.body=h.substring(a);return e}}}}},{}],
52:[function(k,l,m){l.exports=function(b){var h;h=function(g){var e={};this.registrar=g.configuration.registrarServer;this.expires=g.configuration.registerExpires;this.contact=g.contact.toString();this.contact+=";reg-id=1";this.contact+=';+sip.instance="<urn:uuid:'+g.configuration.instanceId+'>"';this.call_id=b.Utils.createRandomToken(22);this.cseq=80;this.to_uri=g.configuration.uri;e.to_uri=this.to_uri;e.call_id=this.call_id;e.cseq=this.cseq;b.Utils.augment(this,b.ClientContext,[g,"REGISTER",this.registrar,
{params:e}]);this.registrationExpiredTimer=this.registrationTimer=null;this.registered=!1;this.logger=g.getLogger("sip.registercontext")};h.prototype={register:function(g){var e=this;this.options=g||{};g=(this.options.extraHeaders||[]).slice();g.push("Contact: "+this.contact+";expires="+this.expires);g.push("Allow: "+b.Utils.getAllowedMethods(this.ua));this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[];this.receiveResponse=function(f){var a,c,d=f.getHeaders("contact").length;
if(f.cseq===this.cseq)switch(null!==this.registrationTimer&&(b.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case /^1[0-9]{2}$/.test(f.status_code):this.emit("progress",f);break;case /^2[0-9]{2}$/.test(f.status_code):this.emit("accepted",f);f.hasHeader("expires")&&(c=f.getHeader("expires"));null!==this.registrationExpiredTimer&&(b.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null);if(!d){this.logger.warn("no Contact header in response to REGISTER, response ignored");
break}for(;d--;)if(a=f.parseHeader("contact",d),a.uri.user===this.ua.contact.uri.user){c=a.getParam("expires");break}else a=null;if(!a){this.logger.warn("no Contact header pointing to us, response ignored");break}c||(c=this.expires);this.registrationTimer=b.Timers.setTimeout(function(){e.registrationTimer=null;e.register(e.options)},1E3*c-3E3);this.registrationExpiredTimer=b.Timers.setTimeout(function(){e.logger.warn("registration expired");e.registered&&e.unregistered(null,b.C.causes.EXPIRES)},1E3*
c);a.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=b.URI.parse(a.getParam("temp-gruu").replace(/"/g,"")));a.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=b.URI.parse(a.getParam("pub-gruu").replace(/"/g,"")));this.registered=!0;this.emit("registered",f||null);break;case /^423$/.test(f.status_code):f.hasHeader("min-expires")?(this.expires=f.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(f,
b.C.causes.SIP_FAILURE_CODE));break;default:a=b.Utils.sipErrorCause(f.status_code),this.registrationFailure(f,a)}};this.onRequestTimeout=function(){this.registrationFailure(null,b.C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,b.C.causes.CONNECTION_ERROR)};this.cseq++;this.request.cseq=this.cseq;this.request.setHeader("cseq",this.cseq+" REGISTER");this.request.extraHeaders=g;this.send()},registrationFailure:function(b,e){this.emit("failed",b||null,e||null)},
onTransportClosed:function(){this.registered_before=this.registered;null!==this.registrationTimer&&(b.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null);null!==this.registrationExpiredTimer&&(b.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null);this.registered&&this.unregistered(null,b.C.causes.CONNECTION_ERROR)},onTransportConnected:function(){this.register(this.options)},close:function(){var b={all:!1,extraHeaders:this.closeHeaders};this.registered_before=
this.registered;this.unregister(b)},unregister:function(g){var e;this.registered?(g=g||{},e=(g.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(b.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),g.all?(e.push("Contact: *"),e.push("Expires: 0")):e.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(e){var a;switch(!0){case /^1[0-9]{2}$/.test(e.status_code):this.emit("progress",e);break;case /^2[0-9]{2}$/.test(e.status_code):this.emit("accepted",
e);null!==this.registrationExpiredTimer&&(b.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null);this.unregistered(e);break;default:a=b.Utils.sipErrorCause(e.status_code),this.unregistered(e,a)}},this.onRequestTimeout=function(){},this.onTransportError=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=e,this.send()):this.logger.warn("already unregistered")},unregistered:function(b,e){this.registered=
!1;this.emit("unregistered",b||null,e||null)}};b.RegisterContext=h}},{}],53:[function(k,l,m){l.exports=function(b){var h;h=function(g,e){this.logger=e.getLogger("sip.requestsender");this.ua=e;this.applicant=g;this.method=g.request.method;this.request=g.request;this.credentials=null;this.staled=this.challenged=!1;if(e.status===b.UA.C.STATUS_USER_CLOSED&&(this.method!==b.C.BYE||this.method!==b.C.ACK))this.onTransportError()};h.prototype={send:function(){switch(this.method){case "INVITE":this.clientTransaction=
new b.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case "ACK":this.clientTransaction=new b.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new b.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send();return this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},
receiveResponse:function(g){var e,f;f=g.status_code;401===f||407===f?(401===g.status_code?(e=g.parseHeader("www-authenticate"),f="authorization"):(e=g.parseHeader("proxy-authenticate"),f="proxy-authorization"),e?!this.challenged||!this.staled&&!0===e.stale?(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),this.credentials.authenticate(this.request,e)?(this.challenged=!0,e.stale&&(this.staled=!0),g.method===b.C.REGISTER?g=this.applicant.cseq+=1:this.request.dialog?
g=this.request.dialog.local_seqnum+=1:(g=this.request.cseq+1,this.request.cseq=g),this.request.setHeader("cseq",g+" "+this.method),this.request.setHeader(f,this.credentials.toString()),this.send()):this.applicant.receiveResponse(g)):this.applicant.receiveResponse(g):(this.logger.warn(g.status_code+" with wrong or missing challenge, cannot authenticate"),this.applicant.receiveResponse(g))):this.applicant.receiveResponse(g)}};b.RequestSender=h}},{}],54:[function(k,l,m){var b={};l.exports=function(h){var g=
k("../package.json");Object.defineProperties(b,{version:{get:function(){return g.version}},name:{get:function(){return g.title}}});k("./Utils")(b,h);b.LoggerFactory=k("./LoggerFactory")(h.console);b.EventEmitter=k("./EventEmitter")(h.console);b.C=k("./Constants")(b.name,b.version);b.Exceptions=k("./Exceptions");b.Timers=k("./Timers")(h.timers);b.Transport=h.Transport(b,h.WebSocket);k("./Parser")(b);k("./SIPMessage")(b);k("./URI")(b);k("./NameAddrHeader")(b);k("./Transactions")(b);k("./Dialogs")(b);
k("./RequestSender")(b);k("./RegisterContext")(b);b.MediaHandler=k("./MediaHandler")(b.EventEmitter);k("./ClientContext")(b);k("./ServerContext")(b);k("./Session")(b,h);k("./Subscription")(b);b.WebRTC=k("./WebRTC")(b,h);k("./UA")(b,h);b.Hacks=k("./Hacks")(b);k("./SanityCheck")(b);b.DigestAuthentication=k("./DigestAuthentication")(b.Utils);b.Grammar=k("./Grammar")(b);return b}},{"../package.json":37,"./ClientContext":38,"./Constants":39,"./Dialogs":41,"./DigestAuthentication":42,"./EventEmitter":43,
"./Exceptions":44,"./Grammar":45,"./Hacks":47,"./LoggerFactory":48,"./MediaHandler":49,"./NameAddrHeader":50,"./Parser":51,"./RegisterContext":52,"./RequestSender":53,"./SIPMessage":55,"./SanityCheck":56,"./ServerContext":57,"./Session":58,"./Subscription":60,"./Timers":61,"./Transactions":62,"./UA":64,"./URI":65,"./Utils":66,"./WebRTC":67}],55:[function(k,l,m){l.exports=function(b){var h,g,e,f;h=function(a,c,d,e,f,g){e=e||{};if(!a||!c||!d)return null;this.logger=d.getLogger("sip.sipmessage");this.ua=
d;this.headers={};this.method=a;this.ruri=c;this.body=g;this.extraHeaders=(f||[]).slice();this.statusCode=e.status_code;this.reasonPhrase=e.reason_phrase;e.route_set?this.setHeader("route",e.route_set):d.configuration.usePreloadedRoute&&this.setHeader("route",d.transport.server.sip_uri);this.setHeader("via","");this.setHeader("max-forwards",b.UA.C.MAX_FORWARDS);f=e.to_displayName||0===e.to_displayName?'"'+e.to_displayName+'" ':"";f+="<"+(e.to_uri||c)+">";f+=e.to_tag?";tag="+e.to_tag:"";this.to=new b.NameAddrHeader.parse(f);
this.setHeader("to",f);c=e.from_displayName||0===e.from_displayName?'"'+e.from_displayName+'" ':d.configuration.displayName?'"'+d.configuration.displayName+'" ':"";c+="<"+(e.from_uri||d.configuration.uri)+">;tag=";c+=e.from_tag||b.Utils.newTag();this.from=new b.NameAddrHeader.parse(c);this.setHeader("from",c);this.call_id=d=e.call_id||d.configuration.sipjsId+b.Utils.createRandomToken(15);this.setHeader("call-id",d);this.cseq=e=e.cseq||Math.floor(1E4*Math.random());this.setHeader("cseq",e+" "+a)};
h.prototype={setHeader:function(a,c){this.headers[b.Utils.headerize(a)]=c instanceof Array?c:[c]},getHeader:function(a){var c,d=this.extraHeaders.length,e=this.headers[b.Utils.headerize(a)];if(e){if(e[0])return e[0]}else for(a=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;c<d;c++)if(e=this.extraHeaders[c],a.test(e))return e.substring(e.indexOf(":")+1).trim()},getHeaders:function(a){var c,d,e=this.headers[b.Utils.headerize(a)],f=[];if(e)for(c=e.length,a=0;a<c;a++)f.push(e[a]);else for(c=this.extraHeaders.length,
d=new RegExp("^\\s*"+a+"\\s*:","i"),a=0;a<c;a++)e=this.extraHeaders[a],d.test(e)&&f.push(e.substring(e.indexOf(":")+1).trim());return f},hasHeader:function(a){var c,d=this.extraHeaders.length;if(this.headers[b.Utils.headerize(a)])return!0;a=new RegExp("^\\s*"+a+"\\s*:","i");for(c=0;c<d;c++)if(a.test(this.extraHeaders[c]))return!0;return!1},toString:function(){var a,c,d,e,f=[];a=""+(this.method+" "+this.ruri+" SIP/2.0\r\n");for(c in this.headers)for(d=this.headers[c].length,e=0;e<d;e++)a+=c+": "+this.headers[c][e]+
"\r\n";d=this.extraHeaders.length;for(e=0;e<d;e++)a+=this.extraHeaders[e].trim()+"\r\n";this.method===b.C.REGISTER?f.push("path","gruu"):this.method===b.C.INVITE&&(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&f.push("gruu");this.ua.configuration.rel100===b.C.supported.SUPPORTED&&f.push("100rel");this.ua.configuration.replaces===b.C.supported.SUPPORTED&&f.push("replaces");f.push("outbound");a=a+("Supported: "+f+"\r\n")+("User-Agent: "+this.ua.configuration.userAgentString+"\r\n");this.body?
(d=b.Utils.str_utf8_length(this.body),a+="Content-Length: "+d+"\r\n\r\n",a+=this.body):a+="Content-Length: 0\r\n\r\n";return a}};g=function(){this.body=this.to_tag=this.to=this.from_tag=this.from=this.cseq=this.call_id=this.via_branch=this.via=this.method=this.headers=this.data=null};g.prototype={addHeader:function(a,c){var d={raw:c};a=b.Utils.headerize(a);this.headers[a]?this.headers[a].push(d):this.headers[a]=[d]},getHeader:function(a){if((a=this.headers[b.Utils.headerize(a)])&&a[0])return a[0].raw},
getHeaders:function(a){var c,d=this.headers[b.Utils.headerize(a)],e=[];if(!d)return[];c=d.length;for(a=0;a<c;a++)e.push(d[a].raw);return e},hasHeader:function(a){return this.headers[b.Utils.headerize(a)]?!0:!1},parseHeader:function(a,c){var d,e,f;a=b.Utils.headerize(a);c=c||0;if(this.headers[a])if(c>=this.headers[a].length)this.logger.log('not so many "'+a+'" headers present');else{d=this.headers[a][c];e=d.raw;if(d.parsed)return d.parsed;f=b.Grammar.parse(e,a.replace(/-/g,"_"));if(-1===f)this.headers[a].splice(c,
1),this.logger.warn('error parsing "'+a+'" header field with value "'+e+'"');else return d.parsed=f}else this.logger.log('header "'+a+'" not present')},s:function(a,c){return this.parseHeader(a,c)},setHeader:function(a,c){var d={raw:c};this.headers[b.Utils.headerize(a)]=[d]},toString:function(){return this.data}};e=function(a){this.logger=a.getLogger("sip.sipmessage");this.ua=a;this.headers={};this.server_transaction=this.transport=this.ruri=null};e.prototype=new g;e.prototype.reply=function(a,c,
d,e,f,g){var h,k,l,m,q=[];l=this.getHeader("To");var r=k=0;m=b.Utils.buildStatusLine(a,c);d=(d||[]).slice();if(this.method===b.C.INVITE&&100<a&&200>=a)for(h=this.getHeaders("record-route"),c=h.length,k;k<c;k++)m+="Record-Route: "+h[k]+"\r\n";k=this.getHeaders("via");c=k.length;for(r;r<c;r++)m+="Via: "+k[r]+"\r\n";!this.to_tag&&100<a?l+=";tag="+b.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(l+=";tag="+this.to_tag);m=m+("To: "+l+"\r\n")+("From: "+this.getHeader("From")+"\r\n");m+="Call-ID: "+
this.call_id+"\r\n";m+="CSeq: "+this.cseq+" "+this.method+"\r\n";c=d.length;for(l=0;l<c;l++)m+=d[l].trim()+"\r\n";this.method===b.C.INVITE&&(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&q.push("gruu");this.ua.configuration.rel100===b.C.supported.SUPPORTED&&q.push("100rel");this.ua.configuration.replaces===b.C.supported.SUPPORTED&&q.push("replaces");q.push("outbound");m+="Supported: "+q+"\r\n";m+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";e?(c=b.Utils.str_utf8_length(e),m+=
"Content-Type: application/sdp\r\n",m+="Content-Length: "+c+"\r\n\r\n",m+=e):m+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(a,m).then(f,g);return m};e.prototype.reply_sl=function(a,c){var d,e;d=0;var f=this.getHeaders("via"),g=f.length;e=b.Utils.buildStatusLine(a,c);for(d;d<g;d++)e+="Via: "+f[d]+"\r\n";d=this.getHeader("To");!this.to_tag&&100<a?d+=";tag="+b.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(d+=";tag="+this.to_tag);e=e+("To: "+d+"\r\n")+("From: "+this.getHeader("From")+
"\r\n");e+="Call-ID: "+this.call_id+"\r\n";e+="CSeq: "+this.cseq+" "+this.method+"\r\n";e+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";e+="Content-Length: 0\r\n\r\n";this.transport.send(e)};f=function(a){this.logger=a.getLogger("sip.sipmessage");this.headers={};this.reason_phrase=this.status_code=null};f.prototype=new g;b.OutgoingRequest=h;b.IncomingRequest=e;b.IncomingResponse=f}},{}],56:[function(k,l,m){l.exports=function(b){function h(c){var d;c=b.Utils.buildStatusLine(c);d=e.getHeaders("via");
var f=d.length,g=0;for(g;g<f;g++)c+="Via: "+d[g]+"\r\n";d=e.getHeader("To");e.to_tag||(d+=";tag="+b.Utils.newTag());c=c+("To: "+d+"\r\n")+("From: "+e.getHeader("From")+"\r\n");c+="Call-ID: "+e.call_id+"\r\n";c+="CSeq: "+e.cseq+" "+e.method+"\r\n";c+="\r\n";a.send(c)}var g,e,f,a,c=[],d=[],p=[];c.push(function(){if(!e.ruri||"sip"!==e.ruri.scheme)return h(416),!1});c.push(function(){if(!e.to_tag&&e.call_id.substr(0,5)===f.configuration.sipjsId)return h(482),!1});c.push(function(){var a=b.Utils.str_utf8_length(e.body),
c=e.getHeader("content-length");if(a<c)return h(400),!1});c.push(function(){var a,c,d=e.from_tag,g=e.call_id,p=e.cseq;if(!e.to_tag)if(e.method===b.C.INVITE){if(a=f.transactions.ist[e.via_branch],!a)for(c in f.transactions.ist)if(a=f.transactions.ist[c],a.request.from_tag===d&&a.request.call_id===g&&a.request.cseq===p)return h(482),!1}else if(a=f.transactions.nist[e.via_branch],!a)for(c in f.transactions.nist)if(a=f.transactions.nist[c],a.request.from_tag===d&&a.request.call_id===g&&a.request.cseq===
p)return h(482),!1});d.push(function(){if(1<e.getHeaders("via").length)return g.warn("More than one Via header field present in the response. Dropping the response"),!1});d.push(function(){var a=b.Utils.str_utf8_length(e.body),c=e.getHeader("content-length");if(a<c)return g.warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1});p.push(function(){for(var a=["from","to","call_id","cseq","via"],c=a.length;c--;)if(!e.hasHeader(a[c]))return g.warn("Missing mandatory header field : "+
a[c]+". Dropping the response"),!1});b.sanityCheck=function(h,k,l){e=h;f=k;a=l;g=f.getLogger("sip.sanitycheck");for(h=p.length;h--;)if(k=p[h](e),!1===k)return!1;if(e instanceof b.IncomingRequest)for(h=c.length;h--;){if(k=c[h](e),!1===k)return!1}else if(e instanceof b.IncomingResponse)for(h=d.length;h--;)if(k=d[h](e),!1===k)return!1;return!0}}},{}],57:[function(k,l,m){l.exports=function(b){var h;h=function(g,e){this.ua=g;this.logger=g.getLogger("sip.servercontext");this.request=e;this.transaction=
e.method===b.C.INVITE?new b.Transactions.InviteServerTransaction(e,g):new b.Transactions.NonInviteServerTransaction(e,g);e.body&&(this.body=e.body);e.hasHeader("Content-Type")&&(this.contentType=e.getHeader("Content-Type"));this.method=e.method;this.data={};this.localIdentity=e.to;this.remoteIdentity=e.from};h.prototype=Object.create(b.EventEmitter.prototype);h.prototype.progress=function(b){b=Object.create(b||Object.prototype);b.statusCode||(b.statusCode=180);b.minCode=100;b.maxCode=199;b.events=
["progress"];return this.reply(b)};h.prototype.accept=function(b){b=Object.create(b||Object.prototype);b.statusCode||(b.statusCode=200);b.minCode=200;b.maxCode=299;b.events=["accepted"];return this.reply(b)};h.prototype.reject=function(b){b=Object.create(b||Object.prototype);b.statusCode||(b.statusCode=480);b.minCode=300;b.maxCode=699;b.events=["rejected","failed"];return this.reply(b)};h.prototype.reply=function(g){g=g||{};var e=g.statusCode||100,f=g.minCode||100,a=g.maxCode||699,c=b.Utils.getReasonPhrase(e,
g.reasonPhrase),d=g.extraHeaders||[],h=g.body;g=g.events||[];var n;if(e<f||e>a)throw new TypeError("Invalid statusCode: "+e);n=this.request.reply(e,c,d,h);g.forEach(function(a){this.emit(a,n,c)},this);return this};h.prototype.onRequestTimeout=function(){this.emit("failed",null,b.C.causes.REQUEST_TIMEOUT)};h.prototype.onTransportError=function(){this.emit("failed",null,b.C.causes.CONNECTION_ERROR)};b.ServerContext=h}},{}],58:[function(k,l,m){l.exports=function(b,h){var g=k("./Session/DTMF")(b),e,f,
a={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};e=function(c){this.status=a.STATUS_NULL;this.dialog=null;this.earlyDialogs={};this.mediaHandlerFactory=c||b.WebRTC.MediaHandler.defaultFactory;this.hasAnswer=this.hasOffer=!1;this.timers={ackTimer:null,
expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null};this.tones=this.endTime=this.startTime=null;this.remote_hold=this.local_hold=!1;this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(a){var c=0,b=this.actions.length;for(c;c<b;c++)if(this.actions[c].name===a)return!0;return!1},shift:function(){return this.actions.shift()},push:function(a){this.actions.push({name:a})},pop:function(a){var c=0,b=this.actions.length;
for(c;c<b;c++)this.actions[c].name===a&&(this.actions.splice(c,1),b--,c--)}};this.early_sdp=null;this.rel100=b.C.supported.UNSUPPORTED};e.prototype={dtmf:function(c,d){var e=[],f=this;d=d||{};if(void 0===c)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.status);if("string"!==typeof c&&"number"!==typeof c||!c.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+
c);for(c=c.toString().split("");0<c.length;)e.push(new g(this,c.shift(),d));if(this.tones)return this.tones=this.tones.concat(e),this;var h=function(){var c;if(f.status===a.STATUS_TERMINATED||!f.tones||0===f.tones.length)return f.tones=null,this;c=f.tones.shift();c.on("failed",function(){f.tones=null});c.send(d);b.Timers.setTimeout(h,c.duration+c.interToneGap)};this.tones=e;h();return this},bye:function(c){c=Object.create(c||Object.prototype);var d=c.statusCode;if(this.status===a.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),
this;this.logger.log("terminating Session");if(d&&(200>d||700<=d))throw new TypeError("Invalid statusCode: "+d);c.receiveResponse=function(){};return this.sendRequest(b.C.BYE,c).terminated()},refer:function(c,d){d=d||{};var e=(d.extraHeaders||[]).slice(),f=c instanceof b.InviteServerContext||c instanceof b.InviteClientContext,g=c;if(void 0===c)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);if(f)c='"'+c.remoteIdentity.friendlyName+
'" <'+c.dialog.remote_target.toString()+"?Replaces="+c.dialog.id.call_id+"%3Bto-tag%3D"+c.dialog.id.remote_tag+"%3Bfrom-tag%3D"+c.dialog.id.local_tag+">";else{try{c=b.Grammar.parse(c,"Refer_To").uri||c}catch(h){this.logger.debug(".refer() cannot parse Refer_To from",c),this.logger.debug("...falling through to normalizeTarget()")}c=this.ua.normalizeTarget(c);if(!c)throw new TypeError("Invalid target: "+g);}e.push("Contact: "+this.contact);e.push("Allow: "+b.Utils.getAllowedMethods(this.ua));e.push("Refer-To: "+
c);e.push("Allow-Events: refer");e.push("Event: refer;id="+Math.floor(1E3*Math.random()+1));this.sendRequest(b.C.REFER,{extraHeaders:e,body:d.body,receiveResponse:function(a){/^2[0-9]{2}$/.test(a.status_code)}.bind(this)});return this},followRefer:function(a){return function(a,c){var e=c.parseHeader("refer-to"),f=e.uri;if(f.scheme.match("^sips?$")){var g=[],k=f.getHeader("Replaces");void 0!==k&&g.push("Replaces: "+decodeURIComponent(k));f.clearHeaders();k=(k=this.mediaHandler.getReferMedia)?k.call(this.mediaHandler):
this.mediaHint;b.Hacks.Chrome.getsConfusedAboutGUM(this);e=this.ua.invite(f,{media:k,params:{to_displayName:e.friendlyName},extraHeaders:g});a.call(this,c,e);this.terminate()}else e=f.toString(),"function"===typeof h.open?h.open(e):this.logger.warn("referred to non-SIP URI but `open` isn't in the environment: "+e)}.bind(this,a)},sendRequest:function(a,d){d=d||{};var e=this,f=new b.OutgoingRequest(a,this.dialog.remote_target,this.ua,{cseq:d.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,
from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:d.statusCode,reasonPhrase:d.reasonPhrase},d.extraHeaders||[],d.body);(new b.RequestSender({request:f,onRequestTimeout:function(){e.onRequestTimeout()},onTransportError:function(){e.onTransportError()},receiveResponse:d.receiveResponse||function(a){e.receiveNonInviteResponse(a)}},this.ua)).send();this.emit(a.toLowerCase(),f);return this},
close:function(){var c;if(this.status===a.STATUS_TERMINATED)return this;this.logger.log("closing INVITE session "+this.id);this.mediaHandler&&this.mediaHandler.close();for(c in this.timers)b.Timers.clearTimeout(this.timers[c]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(c in this.earlyDialogs)this.earlyDialogs[c].terminate(),delete this.earlyDialogs[c];this.status=a.STATUS_TERMINATED;delete this.ua.sessions[this.id];return this},createDialog:function(a,d,e){var f,g=a.call_id+a["UAS"===
d?"to_tag":"from_tag"]+a["UAS"===d?"from_tag":"to_tag"];f=this.earlyDialogs[g];if(e){if(f)return!0;f=new b.Dialog(this,a,d,b.Dialog.C.STATUS_EARLY);if(f.error)return this.logger.error(f.error),this.failed(a,b.C.causes.INTERNAL_ERROR),!1;this.earlyDialogs[g]=f;return!0}if(f){f.update(a,d);this.dialog=f;delete this.earlyDialogs[g];for(var h in this.earlyDialogs)this.earlyDialogs[h].terminate(),delete this.earlyDialogs[h];return!0}d=new b.Dialog(this,a,d);if(d.error)return this.logger.error(d.error),
this.failed(a,b.C.causes.INTERNAL_ERROR),!1;this.to_tag=a.to_tag;this.dialog=d;return!0},isReadyToReinvite:function(){return this.mediaHandler.isReady()&&!this.dialog.uac_pending_reply&&!this.dialog.uas_pending_reply},mute:function(a){if(a=this.mediaHandler.mute(a))this.onmute(a)},unmute:function(a){if(a=this.mediaHandler.unmute(a))this.onunmute(a)},hold:function(){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);this.mediaHandler.hold();
this.isReadyToReinvite()?!0!==this.local_hold&&(this.onhold("local"),this.sendReinvite({mangle:function(a){/a=(sendrecv|sendonly|recvonly|inactive)/.test(a)?(a=a.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),a=a.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):a=a.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n");return a}})):this.pending_actions.isPending("unhold")?this.pending_actions.pop("unhold"):this.pending_actions.isPending("hold")||this.pending_actions.push("hold")},unhold:function(){if(this.status!==
a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);this.mediaHandler.unhold();this.isReadyToReinvite()?!1!==this.local_hold&&(this.onunhold("local"),this.sendReinvite()):this.pending_actions.isPending("hold")?this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")||this.pending_actions.push("unhold")},isOnHold:function(){return{local:this.local_hold,remote:this.remote_hold}},receiveReinvite:function(c){var d=this;c.body&&
("application/sdp"!==c.getHeader("Content-Type")?(this.logger.warn("invalid Content-Type"),c.reply(415)):this.mediaHandler.setDescription(c.body).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(b){c.reply(200,null,["Contact: "+d.contact],b,function(){d.status=a.STATUS_WAITING_FOR_ACK;d.setInvite2xxTimer(c,b);d.setACKTimer();var e=/a=(sendonly|inactive)/.test(c.body);if(d.remote_hold&&!e)d.onunhold("remote");else if(!d.remote_hold&&e)d.onhold("remote")})}).catch(function(a){a instanceof
b.Exceptions.GetDescriptionError?a=500:(d.logger.error(a),a=488);c.reply(a)}))},sendReinvite:function(c){c=c||{};var d=this,e=(c.extraHeaders||[]).slice(),f=c.eventHandlers||{};c=c.mangle||null;this.reinviteSucceeded=f.succeeded?f.succeeded:function(){b.Timers.clearTimeout(d.timers.ackTimer);b.Timers.clearTimeout(d.timers.invite2xxTimer);d.status=a.STATUS_CONFIRMED};this.reinviteFailed=f.failed?f.failed:function(){};e.push("Contact: "+this.contact);e.push("Allow: "+b.Utils.getAllowedMethods(this.ua));
e.push("Content-Type: application/sdp");this.receiveResponse=this.receiveReinviteResponse;this.mediaHandler.getDescription(d.mediaHint).then(c).then(function(a){d.dialog.sendRequest(d,b.C.INVITE,{extraHeaders:e,body:a})},function(){if(d.isReadyToReinvite())d.onReadyToReinvite();d.reinviteFailed()})},receiveRequest:function(c){switch(c.method){case b.C.BYE:c.reply(200);this.status===a.STATUS_CONFIRMED&&(this.emit("bye",c),this.terminated(c,b.C.causes.BYE));break;case b.C.INVITE:this.status===a.STATUS_CONFIRMED&&
(this.logger.log("re-INVITE received"),this.receiveReinvite(c));break;case b.C.INFO:if(this.status===a.STATUS_CONFIRMED||this.status===a.STATUS_WAITING_FOR_ACK){var d,e,f;d=c.getHeader("content-type");var h=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,k=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;d&&(d.match(/^application\/dtmf-relay/i)?(c.body&&(d=c.body.split("\r\n",2),2===d.length&&(h.test(d[0])&&(e=d[0].replace(h,"$2")),k.test(d[1])&&(f=parseInt(d[1].replace(k,"$2"),10)))),(new g(this,e,{duration:f})).init_incoming(c)):
c.reply(415,null,["Accept: application/dtmf-relay"]))}break;case b.C.REFER:this.status===a.STATUS_CONFIRMED&&(this.logger.log("REFER received"),c.reply(202,"Accepted"),e=this.listeners("refer").length,this.sendRequest(b.C.NOTIFY,{extraHeaders:["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],body:e?"SIP/2.0 100 Trying":"SIP/2.0 603 Declined",receiveResponse:function(){}}),e&&this.emit("refer",c));break;case b.C.NOTIFY:c.reply(200,"OK")}},receiveReinviteResponse:function(c){var d=
this,e=c.getHeader("Content-Type");if(this.status!==a.STATUS_TERMINATED)switch(!0){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):this.status=a.STATUS_CONFIRMED;this.sendRequest(b.C.ACK,{cseq:c.cseq});if(!c.body){this.reinviteFailed();break}else if("application/sdp"!==e){this.reinviteFailed();break}this.mediaHandler.setDescription(c.body).then(function(){d.reinviteSucceeded()},function(){d.reinviteFailed()});break;default:this.reinviteFailed()}},acceptAndTerminate:function(a,
d,e){var f=[];d&&f.push("Reason: "+b.Utils.getReasonHeaderValue(d,e));if(this.dialog||this.createDialog(a,"UAC"))this.sendRequest(b.C.ACK,{cseq:a.cseq}),this.sendRequest(b.C.BYE,{extraHeaders:f});return this},setInvite2xxTimer:function(c,d){var e=this,f=b.Timers.T1;this.timers.invite2xxTimer=b.Timers.setTimeout(function x(){e.status===a.STATUS_WAITING_FOR_ACK&&(e.logger.log("no ACK received, attempting to retransmit OK"),c.reply(200,null,["Contact: "+e.contact],d),f=Math.min(2*f,b.Timers.T2),e.timers.invite2xxTimer=
b.Timers.setTimeout(x,f))},f)},setACKTimer:function(){var c=this;this.timers.ackTimer=b.Timers.setTimeout(function(){c.status===a.STATUS_WAITING_FOR_ACK&&(c.logger.log("no ACK received for an extended period of time, terminating the call"),b.Timers.clearTimeout(c.timers.invite2xxTimer),c.sendRequest(b.C.BYE),c.terminated(null,b.C.causes.NO_ACK))},b.Timers.TIMER_H)},onReadyToReinvite:function(){var a=this.pending_actions.shift();if(a&&this[a.name])this[a.name]()},onTransportError:function(){this.status!==
a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,b.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,b.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,b.C.causes.REQUEST_TIMEOUT),this.terminated(null,b.C.causes.REQUEST_TIMEOUT))},onDialogError:function(c){this.status===a.STATUS_CONFIRMED?this.terminated(c,b.C.causes.DIALOG_ERROR):this.status!==a.STATUS_TERMINATED&&(this.failed(c,b.C.causes.DIALOG_ERROR),
this.terminated(c,b.C.causes.DIALOG_ERROR))},onhold:function(a){this["local"===a?"local_hold":"remote_hold"]=!0;this.emit("hold",{originator:a})},onunhold:function(a){this["local"===a?"local_hold":"remote_hold"]=!1;this.emit("unhold",{originator:a})},onmute:function(a){this.emit("muted",{audio:a.audio,video:a.video})},onunmute:function(a){this.emit("unmuted",{audio:a.audio,video:a.video})},failed:function(c,b){if(this.status===a.STATUS_TERMINATED)return this;this.emit("failed",c||null,b||null);return this},
rejected:function(a,b){this.emit("rejected",a||null,b||null);return this},canceled:function(){this.emit("cancel");return this},accepted:function(a,d){d=b.Utils.getReasonPhrase(a&&a.status_code,d);this.startTime=new Date;this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate());this.emit("accepted",a,d);return this},terminated:function(c,b){if(this.status===a.STATUS_TERMINATED)return this;this.endTime=new Date;this.close();this.emit("terminated",c||null,b||null);return this},connecting:function(a){this.emit("connecting",
{request:a});return this}};e.desugar=function(a){h.HTMLMediaElement&&a instanceof h.HTMLMediaElement&&(a={media:{constraints:{audio:!0,video:"VIDEO"===a.tagName},render:{remote:a}}});return a||{}};e.C=a;b.Session=e;f=function(c,d){function e(a,c){d.hasHeader(a)&&0<=d.getHeader(a).toLowerCase().indexOf("100rel")&&(h.rel100=c)}function f(){var c={extraHeaders:["Contact: "+h.contact]};h.rel100!==b.C.supported.REQUIRED&&h.progress(c);h.status=a.STATUS_WAITING_FOR_ANSWER;h.timers.userNoAnswerTimer=b.Timers.setTimeout(function(){d.reply(408);
h.failed(d,b.C.causes.NO_ANSWER);h.terminated(d,b.C.causes.NO_ANSWER)},h.ua.configuration.noAnswerTimeout);g&&(h.timers.expiresTimer=b.Timers.setTimeout(function(){h.status===a.STATUS_WAITING_FOR_ANSWER&&(d.reply(487),h.failed(d,b.C.causes.EXPIRES),h.terminated(d,b.C.causes.EXPIRES))},g));h.emit("invite",d)}var g,h=this,k=d.getHeader("Content-Type"),l=d.parseHeader("Content-Disposition");if(!l&&"application/sdp"!==k||l&&"render"===l.type)this.renderbody=d.body,this.rendertype=k;else if("application/sdp"!==
k&&l&&"session"===l.type){d.reply(415);return}b.Hacks.Firefox.cannotHandleExtraWhitespace(d);b.Hacks.AllBrowsers.maskDtls(d);b.Utils.augment(this,b.ServerContext,[c,d]);b.Utils.augment(this,b.Session,[c.configuration.mediaHandlerFactory]);this.status=a.STATUS_INVITE_RECEIVED;this.from_tag=d.from_tag;this.id=d.call_id+this.from_tag;this.request=d;this.contact=this.ua.contact.toString();this.receiveNonInviteResponse=function(){};this.logger=c.getLogger("sip.inviteservercontext",this.id);this.ua.sessions[this.id]=
this;d.hasHeader("expires")&&(g=1E3*d.getHeader("expires"));e("require",b.C.supported.REQUIRED);e("supported",b.C.supported.SUPPORTED);d.to_tag=b.Utils.newTag();this.createDialog(d,"UAS",!0)?((this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}))&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),
!d.body||this.renderbody?b.Timers.setTimeout(f,0):(this.hasOffer=!0,this.mediaHandler.setDescription(d.body).then(f,function(a){h.logger.warn("invalid SDP");h.logger.warn(a);d.reply(488)}))):d.reply(500,"Missing Contact header field")};f.prototype={reject:function(c){if(this.status===a.STATUS_TERMINATED)throw new b.Exceptions.InvalidStateError(this.status);this.logger.log("rejecting RTCSession");b.ServerContext.prototype.reject.call(this,c);return this.terminated()},terminate:function(c){c=c||{};
var d=(c.extraHeaders||[]).slice(),e=c.body,f,g=this;this.status===a.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==b.Transactions.C.STATUS_TERMINATED?(f=this.dialog,this.receiveRequest=function(a){a.method===b.C.ACK&&(this.request(b.C.BYE,{extraHeaders:d,body:e}),f.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===b.Transactions.C.STATUS_TERMINATED&&(this.request=new b.OutgoingRequest(b.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=
1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},d,e),(new b.RequestSender({request:this.request,onRequestTimeout:function(){g.onRequestTimeout()},onTransportError:function(){g.onTransportError()},receiveResponse:function(){}},this.ua)).send(),f.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=f,this.ua.dialogs[f.id.toString()]=
f):this.status===a.STATUS_CONFIRMED?this.bye(c):this.reject(c);return this},progress:function(c){function d(){f=c.statusCode||183;this.status=a.STATUS_WAITING_FOR_PRACK;h.push("Contact: "+this.contact);h.push("Require: 100rel");h.push("RSeq: "+Math.floor(1E4*Math.random()));this.mediaHint=c.media;this.mediaHandler.getDescription(c.media).then(function(c){if(!this.isCanceled&&this.status!==a.STATUS_TERMINATED){this.early_sdp=c;this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var d=b.Timers.T1;this.timers.rel1xxTimer=
b.Timers.setTimeout(function t(){this.request.reply(f,null,h,c);d*=2;this.timers.rel1xxTimer=b.Timers.setTimeout(t.bind(this),d)}.bind(this),d);this.timers.prackTimer=b.Timers.setTimeout(function(){this.status===a.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),b.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,b.C.causes.NO_PRACK))}.bind(this),64*b.Timers.T1);l=this.request.reply(f,g,h,c);this.emit("progress",l,g)}}.bind(this),
function(){this.request.reply(480);this.failed(null,b.C.causes.WEBRTC_ERROR);this.terminated(null,b.C.causes.WEBRTC_ERROR)}.bind(this))}function e(){l=this.request.reply(f,g,h,k);this.emit("progress",l,g)}c=c||{};var f=c.statusCode||180,g=c.reasonPhrase,h=(c.extraHeaders||[]).slice(),k=c.body,l;if(100>f||199<f)throw new TypeError("Invalid statusCode: "+f);if(this.isCanceled||this.status===a.STATUS_TERMINATED)return this;100!==c.statusCode&&(this.rel100===b.C.supported.REQUIRED||this.rel100===b.C.supported.SUPPORTED&&
c.rel100||this.rel100===b.C.supported.SUPPORTED&&this.ua.configuration.rel100===b.C.supported.REQUIRED)?d.apply(this):e.apply(this);return this},accept:function(c){c=Object.create(e.desugar(c));b.Utils.optionsOverride(c,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media);this.mediaHint=c.media;var d=this,f=this.request,g=(c.extraHeaders||[]).slice();c=function(c){var e;d.mediaHandler.render();g.push("Contact: "+d.contact);g.push("Allow: "+b.Utils.getAllowedMethods(d.ua));d.hasOffer?
d.hasAnswer=!0:d.hasOffer=!0;e=f.reply(200,null,g,c,function(){d.status=a.STATUS_WAITING_FOR_ACK;d.setInvite2xxTimer(f,c);d.setACKTimer()},function(){d.failed(null,b.C.causes.CONNECTION_ERROR);d.terminated(null,b.C.causes.CONNECTION_ERROR)});d.status!==a.STATUS_TERMINATED&&d.accepted(e,b.Utils.getReasonPhrase(200))};var h=function(){d.status!==a.STATUS_TERMINATED&&(d.request.reply(480),d.failed(null,b.C.causes.WEBRTC_ERROR),d.terminated(null,b.C.causes.WEBRTC_ERROR))};if(this.status===a.STATUS_WAITING_FOR_PRACK)return this.status=
a.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===a.STATUS_WAITING_FOR_ANSWER)this.status=a.STATUS_ANSWERED;else if(this.status!==a.STATUS_EARLY_MEDIA)throw new b.Exceptions.InvalidStateError(this.status);if(!this.createDialog(f,"UAS"))return f.reply(500,"Missing Contact header field"),this;b.Timers.clearTimeout(this.timers.userNoAnswerTimer);this.status===a.STATUS_EARLY_MEDIA?c():this.mediaHandler.getDescription(d.mediaHint).then(c,h);return this},receiveRequest:function(c){function d(){var d;
b.Timers.clearTimeout(this.timers.ackTimer);b.Timers.clearTimeout(this.timers.invite2xxTimer);this.status=a.STATUS_CONFIRMED;this.unmute();d=c.getHeader("Content-Type");"application/sdp"!==d&&(this.renderbody=c.body,this.rendertype=d)}switch(c.method){case b.C.CANCEL:if(this.status===a.STATUS_WAITING_FOR_ANSWER||this.status===a.STATUS_WAITING_FOR_PRACK||this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK||this.status===a.STATUS_EARLY_MEDIA||this.status===a.STATUS_ANSWERED)this.status=a.STATUS_CANCELED,
this.request.reply(487),this.canceled(c),this.rejected(c,b.C.causes.CANCELED),this.failed(c,b.C.causes.CANCELED),this.terminated(c,b.C.causes.CANCELED);break;case b.C.ACK:this.status===a.STATUS_WAITING_FOR_ACK&&(this.hasAnswer?d.apply(this):c.body&&"application/sdp"===c.getHeader("content-type")?(b.Hacks.Firefox.cannotHandleExtraWhitespace(c),b.Hacks.AllBrowsers.maskDtls(c),this.hasAnswer=!0,this.mediaHandler.setDescription(c.body).then(d.bind(this),function(a){this.logger.warn(a);this.terminate({statusCode:"488",
reasonPhrase:"Bad Media Description"});this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):this.early_sdp?d.apply(this):(this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)));break;case b.C.PRACK:this.status===a.STATUS_WAITING_FOR_PRACK||this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(b.Timers.clearTimeout(this.timers.rel1xxTimer),b.Timers.clearTimeout(this.timers.prackTimer),
c.reply(200),this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept()),this.status=a.STATUS_EARLY_MEDIA,this.mute()):c.body&&"application/sdp"===c.getHeader("content-type")?(this.hasAnswer=!0,this.mediaHandler.setDescription(c.body).then(function(){b.Timers.clearTimeout(this.timers.rel1xxTimer);b.Timers.clearTimeout(this.timers.prackTimer);c.reply(200);this.status===a.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=a.STATUS_EARLY_MEDIA,this.accept());this.status=
a.STATUS_EARLY_MEDIA;this.mute()}.bind(this),function(a){this.logger.warn(a);this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"});this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(c,b.C.causes.BAD_MEDIA_DESCRIPTION)):this.status===a.STATUS_EARLY_MEDIA&&c.reply(200);break;default:e.prototype.receiveRequest.apply(this,
[c])}},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,b.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===a.STATUS_CONFIRMED?this.terminated(null,b.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,b.C.causes.REQUEST_TIMEOUT),this.terminated(null,b.C.causes.REQUEST_TIMEOUT))}};b.InviteServerContext=f;f=function(c,d,f){f=Object.create(e.desugar(f));f.params=Object.create(f.params||Object.prototype);
var g=(f.extraHeaders||[]).slice(),h=f.stunServers||null,k=f.turnServers||null,l=c.configuration.mediaHandlerFactory.isSupported;if(l&&!l())throw new b.Exceptions.NotSupportedError("Media not supported");this.RTCConstraints=f.RTCConstraints||{};this.inviteWithoutSdp=f.inviteWithoutSdp||!1;this.anonymous=f.anonymous||!1;this.renderbody=f.renderbody||null;this.rendertype=f.rendertype||"text/plain";f.params.from_tag=this.from_tag;this.contact=c.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?
!c.contact.temp_gruu:!c.contact.pub_gruu});this.anonymous&&(f.params.from_displayName="Anonymous",f.params.from_uri="sip:anonymous@anonymous.invalid",g.push("P-Preferred-Identity: "+c.configuration.uri.toString()),g.push("Privacy: id"));g.push("Contact: "+this.contact);g.push("Allow: "+b.Utils.getAllowedMethods(c));this.inviteWithoutSdp?this.renderbody&&(g.push("Content-Type: "+this.rendertype),g.push("Content-Disposition: render;handling=optional")):g.push("Content-Type: application/sdp");c.configuration.rel100===
b.C.supported.REQUIRED&&g.push("Require: 100rel");c.configuration.replaces===b.C.supported.REQUIRED&&g.push("Require: replaces");f.extraHeaders=g;b.Utils.augment(this,b.ClientContext,[c,b.C.INVITE,d,f]);b.Utils.augment(this,b.Session,[c.configuration.mediaHandlerFactory]);if(this.status!==a.STATUS_NULL)throw new b.Exceptions.InvalidStateError(this.status);this.from_tag=b.Utils.newTag();this.received_100=this.isCanceled=!1;this.method=b.C.INVITE;this.receiveNonInviteResponse=this.receiveResponse;this.receiveResponse=
this.receiveInviteResponse;this.logger=c.getLogger("sip.inviteclientcontext");if(h)if(d=b.UA.configuration_check.optional.stunServers(h))this.stunServers=d;else throw new TypeError("Invalid stunServers: "+h);if(k)if(d=b.UA.configuration_check.optional.turnServers(k))this.turnServers=d;else throw new TypeError("Invalid turnServers: "+k);c.applicants[this]=this;this.id=this.request.call_id+this.from_tag;(this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:this.RTCConstraints,stunServers:this.stunServers,
turnServers:this.turnServers}))&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler));b.Utils.optionsOverride(f,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media);this.mediaHint=f.media};f.prototype={invite:function(){var c=this;this.ua.sessions[this.id]=this;this.inviteWithoutSdp?(this.request.body=c.renderbody,this.status=a.STATUS_INVITE_SENT,
this.send()):this.mediaHandler.getDescription(c.mediaHint).then(function(b){c.isCanceled||c.status===a.STATUS_TERMINATED||(c.hasOffer=!0,c.request.body=b,c.status=a.STATUS_INVITE_SENT,c.send())},function(){c.status!==a.STATUS_TERMINATED&&(c.failed(null,b.C.causes.WEBRTC_ERROR),c.terminated(null,b.C.causes.WEBRTC_ERROR))});return this},receiveInviteResponse:function(c){var d,e=this;d=c.call_id+c.from_tag+c.to_tag;var f=[],g={};if(this.status!==a.STATUS_TERMINATED&&c.method===b.C.INVITE){if(this.dialog&&
200<=c.status_code&&299>=c.status_code){if(d!==this.dialog.id.toString()){if(!this.createDialog(c,"UAC",!0))return;this.earlyDialogs[d].sendRequest(this,b.C.ACK,{body:b.Utils.generateFakeSDP(c.body)});this.earlyDialogs[d].sendRequest(this,b.C.BYE);this.status!==a.STATUS_CONFIRMED&&(this.failed(c,b.C.causes.WEBRTC_ERROR),this.terminated(c,b.C.causes.WEBRTC_ERROR));return}if(this.status===a.STATUS_CONFIRMED){this.sendRequest(b.C.ACK,{cseq:c.cseq});return}if(!this.hasAnswer)return}if(this.dialog&&200>
c.status_code)-1!==this.dialog.pracked.indexOf(c.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=c.getHeader("rseq")&&0<this.dialog.pracked.length||!this.earlyDialogs[d]&&!this.createDialog(c,"UAC",!0)||-1!==this.earlyDialogs[d].pracked.indexOf(c.getHeader("rseq"))||this.earlyDialogs[d].pracked[this.earlyDialogs[d].pracked.length-1]>=c.getHeader("rseq")&&0<this.earlyDialogs[d].pracked.length||(f.push("RAck: "+c.getHeader("rseq")+" "+c.getHeader("cseq")),this.earlyDialogs[d].pracked.push(c.getHeader("rseq")),
this.earlyDialogs[d].sendRequest(this,b.C.PRACK,{extraHeaders:f,body:b.Utils.generateFakeSDP(c.body)}));else if(this.isCanceled)100<=c.status_code&&200>c.status_code?(this.request.cancel(this.cancelReason),this.canceled(null)):200<=c.status_code&&299>c.status_code?(this.acceptAndTerminate(c),this.emit("bye",this.request)):300<=c.status_code&&(d=b.C.REASON_PHRASE[c.status_code]||b.C.causes.CANCELED,this.rejected(c,d),this.failed(c,d),this.terminated(c,d));else switch(!0){case /^100$/.test(c.status_code):this.received_100=
!0;this.emit("progress",c);break;case /^1[0-9]{2}$/.test(c.status_code):if(!c.to_tag){this.logger.warn("1xx response received without to tag");break}if(c.hasHeader("contact")&&!this.createDialog(c,"UAC",!0))break;this.status=a.STATUS_1XX_RECEIVED;if(c.hasHeader("require")&&-1!==c.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[d])break;if(-1!==this.earlyDialogs[d].pracked.indexOf(c.getHeader("rseq"))||this.earlyDialogs[d].pracked[this.earlyDialogs[d].pracked.length-1]>=
c.getHeader("rseq")&&0<this.earlyDialogs[d].pracked.length)break;b.Hacks.Firefox.cannotHandleExtraWhitespace(c);b.Hacks.AllBrowsers.maskDtls(c);if(c.body)if(this.hasOffer){if(!this.createDialog(c,"UAC"))break;this.hasAnswer=!0;this.dialog.pracked.push(c.getHeader("rseq"));this.mediaHandler.setDescription(c.body).then(function(){f.push("RAck: "+c.getHeader("rseq")+" "+c.getHeader("cseq"));e.sendRequest(b.C.PRACK,{extraHeaders:f,receiveResponse:function(){}});e.status=a.STATUS_EARLY_MEDIA;e.mute();
e.emit("progress",c)},function(a){e.logger.warn(a);e.acceptAndTerminate(c,488,"Not Acceptable Here");e.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var h=this.earlyDialogs[d];d=h.mediaHandler;h.pracked.push(c.getHeader("rseq"));d.setDescription(c.body).then(d.getDescription.bind(d,e.mediaHint)).then(function(d){f.push("Content-Type: application/sdp");f.push("RAck: "+c.getHeader("rseq")+" "+c.getHeader("cseq"));h.sendRequest(e,b.C.PRACK,{extraHeaders:f,body:d});e.status=a.STATUS_EARLY_MEDIA;e.emit("progress",
c)}).catch(function(d){d instanceof b.Exceptions.GetDescriptionError?(h.pracked.push(c.getHeader("rseq")),e.status!==a.STATUS_TERMINATED&&(e.failed(null,b.C.causes.WEBRTC_ERROR),e.terminated(null,b.C.causes.WEBRTC_ERROR))):(h.pracked.splice(h.pracked.indexOf(c.getHeader("rseq")),1),e.logger.warn("invalid SDP"),e.logger.warn(d))})}else f.push("RAck: "+c.getHeader("rseq")+" "+c.getHeader("cseq")),this.earlyDialogs[d].pracked.push(c.getHeader("rseq")),this.earlyDialogs[d].sendRequest(this,b.C.PRACK,
{extraHeaders:f}),this.emit("progress",c)}else this.emit("progress",c);break;case /^2[0-9]{2}$/.test(c.status_code):if(this.request.cseq+" "+this.request.method!==c.getHeader("cseq"))break;if(this.status===a.STATUS_EARLY_MEDIA&&this.dialog){this.status=a.STATUS_CONFIRMED;this.unmute();g={};this.renderbody&&(f.push("Content-Type: "+this.rendertype),g.extraHeaders=f,g.body=this.renderbody);g.cseq=c.cseq;this.sendRequest(b.C.ACK,g);this.accepted(c);break}if(this.dialog)break;b.Hacks.Firefox.cannotHandleExtraWhitespace(c);
b.Hacks.AllBrowsers.maskDtls(c);if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(f.push("Content-Type: "+e.rendertype),g.extraHeaders=f,g.body=this.renderbody),this.sendRequest(b.C.ACK,g);else{if(!c.body){this.acceptAndTerminate(c,400,"Missing session description");this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(c,"UAC"))break;this.hasAnswer=!0;this.mediaHandler.setDescription(c.body).then(function(){var d={};e.status=a.STATUS_CONFIRMED;e.unmute();e.renderbody&&(f.push("Content-Type: "+
e.rendertype),d.extraHeaders=f,d.body=e.renderbody);d.cseq=c.cseq;e.sendRequest(b.C.ACK,d);e.accepted(c)},function(a){e.logger.warn(a);e.acceptAndTerminate(c,488,"Not Acceptable Here");e.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[d]&&this.earlyDialogs[d].mediaHandler.localMedia){this.hasAnswer=this.hasOffer=!0;this.mediaHandler=this.earlyDialogs[d].mediaHandler;if(!this.createDialog(c,"UAC"))break;this.status=a.STATUS_CONFIRMED;this.sendRequest(b.C.ACK,{cseq:c.cseq});this.unmute();
this.accepted(c)}else{if(!c.body){this.acceptAndTerminate(c,400,"Missing session description");this.failed(c,b.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(c,"UAC"))break;this.hasOffer=!0;this.mediaHandler.setDescription(c.body).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(d){e.isCanceled||e.status===a.STATUS_TERMINATED||(d=b.Hacks.Firefox.hasMissingCLineInSDP(d),e.status=a.STATUS_CONFIRMED,e.hasAnswer=!0,e.unmute(),e.sendRequest(b.C.ACK,
{body:d,extraHeaders:["Content-Type: application/sdp"],cseq:c.cseq}),e.accepted(c))}).catch(function(a){a instanceof b.Exceptions.GetDescriptionError?e.logger.warn("there was a problem"):(e.logger.warn("invalid SDP"),e.logger.warn(a),c.reply(488))})}break;default:d=b.Utils.sipErrorCause(c.status_code),this.rejected(c,d),this.failed(c,d),this.terminated(c,d)}}},cancel:function(c){c=c||{};if(this.status===a.STATUS_TERMINATED||this.status===a.STATUS_CONFIRMED)throw new b.Exceptions.InvalidStateError(this.status);
this.logger.log("canceling RTCSession");c=b.Utils.getCancelReason(c.status_code,c.reason_phrase);this.status===a.STATUS_NULL||this.status===a.STATUS_INVITE_SENT&&!this.received_100?(this.isCanceled=!0,this.cancelReason=c):this.status!==a.STATUS_INVITE_SENT&&this.status!==a.STATUS_1XX_RECEIVED&&this.status!==a.STATUS_EARLY_MEDIA||this.request.cancel(c);return this.canceled()},terminate:function(c){if(this.status===a.STATUS_TERMINATED)return this;this.status===a.STATUS_WAITING_FOR_ACK||this.status===
a.STATUS_CONFIRMED?this.bye(c):this.cancel(c);return this},receiveRequest:function(c){c.method===b.C.ACK&&this.status===a.STATUS_WAITING_FOR_ACK&&(b.Timers.clearTimeout(this.timers.ackTimer),b.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED,this.unmute(),this.accepted());return e.prototype.receiveRequest.apply(this,[c])},onTransportError:function(){this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_TERMINATED&&this.failed(null,b.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===
a.STATUS_CONFIRMED?this.terminated(null,b.C.causes.REQUEST_TIMEOUT):this.status!==a.STATUS_TERMINATED&&(this.failed(null,b.C.causes.REQUEST_TIMEOUT),this.terminated(null,b.C.causes.REQUEST_TIMEOUT))}};b.InviteClientContext=f}},{"./Session/DTMF":59}],59:[function(k,l,m){l.exports=function(b){var h;h=function(g,e,f){if(void 0===e)throw new TypeError("Not enough arguments");this.logger=g.ua.getLogger("sip.invitecontext.dtmf",g.id);this.owner=g;this.direction=null;f=f||{};g=f.duration||null;f=f.interToneGap||
null;if("string"===typeof e)e=e.toUpperCase();else if("number"===typeof e)e=e.toString();else throw new TypeError("Invalid tone: "+e);if(e.match(/^[0-9A-D#*]$/))this.tone=e;else throw new TypeError("Invalid tone: "+e);if(g&&!b.Utils.isDecimal(g))throw new TypeError("Invalid tone duration: "+g);g?g<h.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+h.C.MIN_DURATION+" milliseconds"),g=h.C.MIN_DURATION):g>h.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+
h.C.MAX_DURATION+" milliseconds"),g=h.C.MAX_DURATION):g=Math.abs(g):g=h.C.DEFAULT_DURATION;this.duration=g;if(f&&!b.Utils.isDecimal(f))throw new TypeError("Invalid interToneGap: "+f);f?f<h.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+h.C.MIN_INTER_TONE_GAP+" milliseconds"),f=h.C.MIN_INTER_TONE_GAP):f=Math.abs(f):f=h.C.DEFAULT_INTER_TONE_GAP;this.interToneGap=f};h.prototype=Object.create(b.EventEmitter.prototype);h.prototype.send=function(g){var e;
this.direction="outgoing";if(this.owner.status!==b.Session.C.STATUS_CONFIRMED&&this.owner.status!==b.Session.C.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.owner.status);g=g||{};g=g.extraHeaders?g.extraHeaders.slice():[];g.push("Content-Type: application/dtmf-relay");e="Signal= "+this.tone+"\r\n";e+="Duration= "+this.duration;this.request=this.owner.dialog.sendRequest(this,b.C.INFO,{extraHeaders:g,body:e});this.owner.emit("dtmf",this.request,this)};h.prototype.receiveResponse=
function(g){var e;switch(!0){case /^1[0-9]{2}$/.test(g.status_code):break;case /^2[0-9]{2}$/.test(g.status_code):this.emit("succeeded",{originator:"remote",response:g});break;default:e=b.Utils.sipErrorCause(g.status_code),this.emit("failed",g,e)}};h.prototype.onRequestTimeout=function(){this.emit("failed",null,b.C.causes.REQUEST_TIMEOUT);this.owner.onRequestTimeout()};h.prototype.onTransportError=function(){this.emit("failed",null,b.C.causes.CONNECTION_ERROR);this.owner.onTransportError()};h.prototype.onDialogError=
function(g){this.emit("failed",g,b.C.causes.DIALOG_ERROR);this.owner.onDialogError(g)};h.prototype.init_incoming=function(b){this.direction="incoming";this.request=b;b.reply(200);this.tone&&this.duration?this.owner.emit("dtmf",b,this):this.logger.warn("invalid INFO DTMF received, discarded")};h.C={MIN_DURATION:70,MAX_DURATION:6E3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return h}},{}],60:[function(k,l,m){l.exports=function(b){b.Subscription=function(h,g,e,f){f=Object.create(f||
Object.prototype);this.extraHeaders=f.extraHeaders=(f.extraHeaders||[]).slice();this.id=null;this.state="init";if(e)this.event=e;else throw new TypeError("Event necessary to create a subscription.");"number"!==typeof f.expires?(h.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=f.expires;f.extraHeaders.push("Event: "+this.event);f.extraHeaders.push("Expires: "+this.expires);f.body&&(this.body=f.body);this.contact=h.contact.toString();f.extraHeaders.push("Contact: "+
this.contact);f.extraHeaders.push("Allow: "+b.Utils.getAllowedMethods(h));b.Utils.augment(this,b.ClientContext,[h,b.C.SUBSCRIBE,g,f]);this.logger=h.getLogger("sip.subscription");this.dialog=null;this.timers={N:null,sub_duration:null};this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]};b.Subscription.prototype={subscribe:function(){b.Timers.clearTimeout(this.timers.sub_duration);b.Timers.clearTimeout(this.timers.N);this.timers.N=b.Timers.setTimeout(this.timer_fire.bind(this),b.Timers.TIMER_N);
this.send();this.state="notify_wait";return this},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,b.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(h){var g,e=b.Utils.getReasonPhrase(h.status_code);-1!==this.errorCodes.indexOf(h.status_code)?this.failed(h,null):/^2[0-9]{2}$/.test(h.status_code)&&(g=h.getHeader("Expires"),b.Timers.clearTimeout(this.timers.N),this.createConfirmedDialog(h,
"UAC")&&(this.id=this.dialog.id.toString(),this.ua.subscriptions[this.id]=this,this.emit("accepted",h,e)),g&&g<=this.expires?this.timers.sub_duration=b.Timers.setTimeout(this.refresh.bind(this),900*g):g?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(h,b.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(h,b.C.EXPIRES_HEADER_MISSING)))},unsubscribe:function(){var h=
[];this.state="terminated";h.push("Event: "+this.event);h.push("Expires: 0");h.push("Contact: "+this.contact);h.push("Allow: "+b.Utils.getAllowedMethods(this.ua));this.request=new b.OutgoingRequest(this.method,this.request.to.uri.toString(),this.ua,null,h);this.receiveResponse=function(){};b.Timers.clearTimeout(this.timers.sub_duration);b.Timers.clearTimeout(this.timers.N);this.timers.N=b.Timers.setTimeout(this.timer_fire.bind(this),b.Timers.TIMER_N);this.send()},timer_fire:function(){"terminated"===
this.state?this.close():"pending"===this.state||"notify_wait"===this.state?(this.state="terminated",this.close()):this.refresh()},close:function(){"terminated"!==this.state&&this.unsubscribe();this.terminateDialog();b.Timers.clearTimeout(this.timers.N);b.Timers.clearTimeout(this.timers.sub_duration);delete this.ua.subscriptions[this.id]},createConfirmedDialog:function(h,g){var e;this.terminateDialog();e=new b.Dialog(this,h,g);if(e.error)return!1;this.dialog=e;return!0},terminateDialog:function(){this.dialog&&
(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(h){function g(){e.expires&&(e.expires=Math.min(f.expires,Math.max(e.expires,0)),f.timers.sub_duration=b.Timers.setTimeout(f.refresh.bind(f),900*e.expires))}var e,f=this;if(this.matchEvent(h))switch(e=h.parseHeader("Subscription-State"),h.reply(200,b.C.REASON_200),b.Timers.clearTimeout(this.timers.N),b.Timers.clearTimeout(this.timers.sub_duration),this.emit("notify",{request:h}),e.state){case "active":this.state=
"active";g();break;case "pending":"notify_wait"===this.state&&g();this.state="pending";break;case "terminated":if(e.reason)switch(this.logger.log("terminating subscription with reason "+e.reason),e.reason){case "deactivated":case "timeout":this.subscribe();return;case "probation":case "giveup":e.params&&e.params["retry-after"]?this.timers.sub_duration=b.Timers.setTimeout(f.subscribe.bind(f),e.params["retry-after"]):this.subscribe();return}this.close()}else h.reply(489)},failed:function(b,g){this.close();
this.emit("failed",b,g);return this},matchEvent:function(b){var g;if(!b.hasHeader("Event"))return this.logger.warn("missing Event header"),!1;if(!b.hasHeader("Subscription-State"))return this.logger.warn("missing Subscription-State header"),!1;g=b.parseHeader("event").event;return this.event!==g?(this.logger.warn("event match failed"),b.reply(481,"Event Match Failed"),!1):!0}}}},{}],61:[function(k,l,m){l.exports=function(b){var h={T1:500,T2:4E3,T4:5E3,TIMER_B:32E3,TIMER_D:0,TIMER_F:32E3,TIMER_H:32E3,
TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32E3,TIMER_M:32E3,TIMER_N:32E3,PROVISIONAL_RESPONSE_INTERVAL:6E4};["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(g){h[g]=function(){return b[g].apply(b,arguments)}});return h}},{}],62:[function(k,l,m){l.exports=function(b){var h={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},
g=function(a,c,b){this.type=h.NON_INVITE_CLIENT;this.transport=b;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=c;this.logger=a.ua.getLogger("sip.transaction.nict",this.id);c="SIP/2.0/"+(a.ua.configuration.hackViaTcp?"TCP":b.server.scheme);c+=" "+a.ua.configuration.viaHost+";branch="+this.id;this.request.setHeader("via",c);this.request_sender.ua.newTransaction(this)};g.prototype=Object.create(b.EventEmitter.prototype);g.prototype.stateChanged=function(a){this.state=
a;this.emit("stateChanged")};g.prototype.send=function(){this.stateChanged(h.STATUS_TRYING);this.F=b.Timers.setTimeout(this.timer_F.bind(this),b.Timers.TIMER_F);if(!this.transport.send(this.request))this.onTransportError()};g.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id);b.Timers.clearTimeout(this.F);b.Timers.clearTimeout(this.K);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);
this.request_sender.onTransportError()};g.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onRequestTimeout()};g.prototype.timer_K=function(){this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};g.prototype.receiveResponse=function(a){var c=a.status_code;if(200>c)switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_PROCEEDING),
this.request_sender.receiveResponse(a)}else switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED);b.Timers.clearTimeout(this.F);if(408===c)this.request_sender.onRequestTimeout();else this.request_sender.receiveResponse(a);this.K=b.Timers.setTimeout(this.timer_K.bind(this),b.Timers.TIMER_K)}};var e=function(a,c,b){var e=this;this.type=h.INVITE_CLIENT;this.transport=b;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=
c;this.logger=a.ua.getLogger("sip.transaction.ict",this.id);c="SIP/2.0/"+(a.ua.configuration.hackViaTcp?"TCP":b.server.scheme);c+=" "+a.ua.configuration.viaHost+";branch="+this.id;this.request.setHeader("via",c);this.request_sender.ua.newTransaction(this);this.request.cancel=function(a){e.cancel_request(e,a)}};e.prototype=Object.create(b.EventEmitter.prototype);e.prototype.stateChanged=function(a){this.state=a;this.emit("stateChanged")};e.prototype.send=function(){this.stateChanged(h.STATUS_CALLING);
this.B=b.Timers.setTimeout(this.timer_B.bind(this),b.Timers.TIMER_B);if(!this.transport.send(this.request))this.onTransportError()};e.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id);b.Timers.clearTimeout(this.B);b.Timers.clearTimeout(this.D);b.Timers.clearTimeout(this.M);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);if(this.state!==h.STATUS_ACCEPTED)this.request_sender.onTransportError()};
e.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id);this.state===h.STATUS_ACCEPTED&&(b.Timers.clearTimeout(this.B),this.stateChanged(h.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))};e.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id);this.state===h.STATUS_CALLING&&(this.stateChanged(h.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())};
e.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id);b.Timers.clearTimeout(this.B);this.stateChanged(h.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};e.prototype.sendACK=function(a){this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n";this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n");this.ack+="To: "+a.getHeader("to")+"\r\n";
this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="Content-Length: 0\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n\r\n";this.D=b.Timers.setTimeout(this.timer_D.bind(this),b.Timers.TIMER_D);this.transport.send(this.ack)};e.prototype.cancel_request=function(a,c){var e=a.request;this.cancel=b.C.CANCEL+" "+e.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+e.headers.Via.toString()+
"\r\n";this.request.headers.Route&&(this.cancel+="Route: "+e.headers.Route.toString()+"\r\n");this.cancel+="To: "+e.headers.To.toString()+"\r\n";this.cancel+="From: "+e.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+e.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+e.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";c&&(this.cancel+="Reason: "+c+"\r\n");this.cancel+="Content-Length: 0\r\n\r\n";this.state===h.STATUS_PROCEEDING&&this.transport.send(this.cancel)};e.prototype.receiveResponse=
function(a){var c=a.status_code;if(100<=c&&199>=c)switch(this.state){case h.STATUS_CALLING:this.stateChanged(h.STATUS_PROCEEDING);this.request_sender.receiveResponse(a);this.cancel&&this.transport.send(this.cancel);break;case h.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(200<=c&&299>=c)switch(this.state){case h.STATUS_CALLING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_ACCEPTED);this.M=b.Timers.setTimeout(this.timer_M.bind(this),b.Timers.TIMER_M);this.request_sender.receiveResponse(a);
break;case h.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(300<=c&&699>=c)switch(this.state){case h.STATUS_CALLING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED);this.sendACK(a);this.request_sender.receiveResponse(a);break;case h.STATUS_COMPLETED:this.sendACK(a)}};var f=function(a,c,b){this.transport=b;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=c;this.logger=a.ua.getLogger("sip.transaction.nict",this.id);c="SIP/2.0/"+(a.ua.configuration.hackViaTcp?
"TCP":b.server.scheme);c+=" "+a.ua.configuration.viaHost+";branch="+this.id;this.request.setHeader("via",c)};f.prototype=Object.create(b.EventEmitter.prototype);f.prototype.send=function(){if(!this.transport.send(this.request))this.onTransportError()};f.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id);this.request_sender.onTransportError()};var a=function(a,c){this.type=h.NON_INVITE_SERVER;this.id=a.via_branch;this.request=a;
this.transport=a.transport;this.ua=c;this.last_response="";a.server_transaction=this;this.logger=c.getLogger("sip.transaction.nist",this.id);this.state=h.STATUS_TRYING;c.newTransaction(this)};a.prototype=Object.create(b.EventEmitter.prototype);a.prototype.stateChanged=function(a){this.state=a;this.emit("stateChanged")};a.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id);this.stateChanged(h.STATUS_TERMINATED);this.ua.destroyTransaction(this)};
a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),b.Timers.clearTimeout(this.J),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))};a.prototype.receiveResponse=function(a,c){var e=b.Utils.defer();if(100===a)switch(this.state){case h.STATUS_TRYING:this.stateChanged(h.STATUS_PROCEEDING);if(!this.transport.send(c))this.onTransportError();break;case h.STATUS_PROCEEDING:this.last_response=
c,this.transport.send(c)?e.resolve():(this.onTransportError(),e.reject())}else if(200<=a&&699>=a)switch(this.state){case h.STATUS_TRYING:case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_COMPLETED),this.last_response=c,this.J=b.Timers.setTimeout(this.timer_J.bind(this),b.Timers.TIMER_J),this.transport.send(c)?e.resolve():(this.onTransportError(),e.reject())}return e.promise};var c=function(a,c){this.type=h.INVITE_SERVER;this.id=a.via_branch;this.request=a;this.transport=a.transport;this.ua=c;this.last_response=
"";a.server_transaction=this;this.logger=c.getLogger("sip.transaction.ist",this.id);this.state=h.STATUS_PROCEEDING;c.newTransaction(this);this.resendProvisionalTimer=null;a.reply(100)};c.prototype=Object.create(b.EventEmitter.prototype);c.prototype.stateChanged=function(a){this.state=a;this.emit("stateChanged")};c.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id);this.state===h.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated");
this.stateChanged(h.STATUS_TERMINATED);this.ua.destroyTransaction(this)};c.prototype.timer_I=function(){this.stateChanged(h.STATUS_TERMINATED);this.ua.destroyTransaction(this)};c.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id);this.state===h.STATUS_ACCEPTED&&(this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))};c.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+
this.id),null!==this.resendProvisionalTimer&&(b.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),b.Timers.clearTimeout(this.L),b.Timers.clearTimeout(this.H),b.Timers.clearTimeout(this.I),this.stateChanged(h.STATUS_TERMINATED),this.ua.destroyTransaction(this))};c.prototype.resend_provisional=function(){if(!this.transport.send(this.last_response))this.onTransportError()};c.prototype.receiveResponse=function(a,c){var e=b.Utils.defer();if(100<=a&&199>=a)switch(this.state){case h.STATUS_PROCEEDING:if(!this.transport.send(c))this.onTransportError();
this.last_response=c}if(100<a&&199>=a&&this.state===h.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=b.Timers.setInterval(this.resend_provisional.bind(this),b.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(200<=a&&299>=a)switch(this.state){case h.STATUS_PROCEEDING:this.stateChanged(h.STATUS_ACCEPTED),this.last_response=c,this.L=b.Timers.setTimeout(this.timer_L.bind(this),b.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(b.Timers.clearInterval(this.resendProvisionalTimer),
this.resendProvisionalTimer=null);case h.STATUS_ACCEPTED:this.transport.send(c)?e.resolve():(this.onTransportError(),e.reject())}else if(300<=a&&699>=a)switch(this.state){case h.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(b.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(c)?(this.stateChanged(h.STATUS_COMPLETED),this.H=b.Timers.setTimeout(this.timer_H.bind(this),b.Timers.TIMER_H),e.resolve()):(this.onTransportError(),e.reject())}return e.promise};
b.Transactions={C:h,checkTransaction:function(a,c){var e;switch(c.method){case b.C.INVITE:if(e=a.transactions.ist[c.via_branch]){switch(e.state){case h.STATUS_PROCEEDING:e.transport.send(e.last_response)}return!0}break;case b.C.ACK:if(e=a.transactions.ist[c.via_branch]){if(e.state===h.STATUS_ACCEPTED)return!1;if(e.state===h.STATUS_COMPLETED)return e.state=h.STATUS_CONFIRMED,e.I=b.Timers.setTimeout(e.timer_I.bind(e),b.Timers.TIMER_I),!0}else return!1;break;case b.C.CANCEL:if(e=a.transactions.ist[c.via_branch])return c.reply_sl(200),
e.state===h.STATUS_PROCEEDING?!1:!0;c.reply_sl(481);return!0;default:if(e=a.transactions.nist[c.via_branch]){switch(e.state){case h.STATUS_PROCEEDING:case h.STATUS_COMPLETED:e.transport.send(e.last_response)}return!0}}},NonInviteClientTransaction:g,InviteClientTransaction:e,AckClientTransaction:f,NonInviteServerTransaction:a,InviteServerTransaction:c}}},{}],63:[function(k,l,m){l.exports=function(b,h){function g(b){var a=.8*b;return 1E3*(Math.random()*(b-a)+a)}var e;e=function(b,a){this.logger=b.getLogger("sip.transport");
this.ua=b;this.ws=null;this.server=a;this.reconnection_attempts=0;this.connected=this.closed=!1;this.reconnectTimer=null;this.lastTransportError={};this.keepAliveInterval=b.configuration.keepAliveInterval;this.keepAliveTimer=this.keepAliveTimeout=null;this.ua.transport=this;this.connect()};e.prototype={send:function(b){b=b.toString();if(this.ws&&this.ws.readyState===h.OPEN)return!0===this.ua.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0;this.logger.warn("unable to send message, WebSocket is not open");
return!1},sendKeepAlive:function(){if(!this.keepAliveTimeout)return this.keepAliveTimeout=b.Timers.setTimeout(function(){this.ua.emit("keepAliveTimeout")}.bind(this),1E4),this.send("\r\n\r\n")},startSendingKeepAlives:function(){this.keepAliveInterval&&!this.keepAliveTimer&&(this.keepAliveTimer=b.Timers.setTimeout(function(){this.sendKeepAlive();this.keepAliveTimer=null;this.startSendingKeepAlives()}.bind(this),g(this.keepAliveInterval)))},stopSendingKeepAlives:function(){b.Timers.clearTimeout(this.keepAliveTimer);
b.Timers.clearTimeout(this.keepAliveTimeout);this.keepAliveTimeout=this.keepAliveTimer=null},disconnect:function(){this.ws&&(b.Timers.clearTimeout(this.reconnectTimer),this.stopSendingKeepAlives(),this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close());null!==this.reconnectTimer&&(b.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},
connect:function(){var b=this;if(this.ws&&(this.ws.readyState===h.OPEN||this.ws.readyState===h.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close();this.logger.log("connecting to WebSocket "+this.server.ws_uri);this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new h(this.server.ws_uri,"sip")}catch(a){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+
a)}this.ws.binaryType="arraybuffer";this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(a){b.onClose(a)};this.ws.onmessage=function(a){b.onMessage(a)};this.ws.onerror=function(a){b.onError(a)}},onOpen:function(){this.connected=!0;this.logger.log("WebSocket "+this.server.ws_uri+" connected");null!==this.reconnectTimer&&(b.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null);this.reconnection_attempts=0;this.closed=!1;this.ua.onTransportConnected(this);this.startSendingKeepAlives()},
onClose:function(b){var a=this.connected;this.lastTransportError.code=b.code;this.lastTransportError.reason=b.reason;this.stopSendingKeepAlives();if(0<this.reconnection_attempts)this.logger.log("Reconnection attempt "+this.reconnection_attempts+" failed (code: "+b.code+(b.reason?"| reason: "+b.reason:"")+")"),this.reconnect();else if(this.connected=!1,this.logger.log("WebSocket disconnected (code: "+b.code+(b.reason?"| reason: "+b.reason:"")+")"),!1===b.wasClean&&this.logger.warn("WebSocket abrupt disconnection"),
!0===a)this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reconnect();else this.ua.onTransportError(this)},onMessage:function(e){var a;e=e.data;if("\r\n"===e)b.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=null,!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response");else{if("string"!==typeof e){try{e=String.fromCharCode.apply(null,
new Uint8Array(e))}catch(c){this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded");return}!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+e+"\n")}else!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+e+"\n");if((e=b.Parser.parseMessage(e,this.ua))&&!(this.ua.status===b.UA.C.STATUS_USER_CLOSED&&e instanceof b.IncomingRequest)&&b.sanityCheck(e,this.ua,this))if(e instanceof
b.IncomingRequest)e.transport=this,this.ua.receiveRequest(e);else if(e instanceof b.IncomingResponse)switch(e.method){case b.C.INVITE:(a=this.ua.transactions.ict[e.via_branch])&&a.receiveResponse(e);break;case b.C.ACK:break;default:(a=this.ua.transactions.nict[e.via_branch])&&a.receiveResponse(e)}}},onError:function(b){this.logger.warn("WebSocket connection error: "+JSON.stringify(b))},reconnect:function(){var e=this;this.reconnection_attempts+=1;this.reconnection_attempts>this.ua.configuration.wsServerMaxReconnection?
(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):1===this.reconnection_attempts?(this.logger.log("Connection to WebSocket "+this.server.ws_uri+" severed, attempting first reconnect"),e.connect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=b.Timers.setTimeout(function(){e.connect();e.reconnectTimer=null},1E3*this.ua.configuration.wsServerReconnectionTimeout))}};
e.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};return e}},{}],64:[function(k,l,m){(function(b){l.exports=function(h,g){function e(a){if(a instanceof Function)return a.initialize||(a.initialize=function(){return h.Utils.Promise.resolve()}),a}var f,a={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{invite:"INVITE",message:"MESSAGE"},ALLOWED_METHODS:"ACK CANCEL BYE OPTIONS INFO NOTIFY".split(" "),ACCEPTED_BODY_TYPES:["application/sdp",
"application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};f=function(c){a.ACCEPTED_BODY_TYPES=a.ACCEPTED_BODY_TYPES.toString();this.log=new h.LoggerFactory;this.logger=this.getLogger("sip.ua");this.cache={credentials:{}};this.configuration={};this.dialogs={};this.applicants={};this.data={};this.sessions={};this.subscriptions={};this.contact=this.transport=null;this.status=a.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.transportRecoverAttempts=0;this.transportRecoveryTimer=
null;Object.defineProperties(this,{transactionsCount:{get:function(){var a,c=["nist","nict","ist","ict"],b=0;for(a in c)b+=Object.keys(this.transactions[c[a]]).length;return b}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}});
if(void 0===c)c={};else if("string"===typeof c||c instanceof String)c={uri:c};c.log&&(c.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=c.log.builtinEnabled),c.log.hasOwnProperty("level")&&(this.log.level=c.log.level),c.log.hasOwnProperty("connector")&&(this.log.connector=c.log.connector));try{this.loadConfig(c)}catch(d){throw this.status=a.STATUS_NOT_READY,this.error=a.CONFIGURATION_ERROR,d;}this.registerContext=new h.RegisterContext(this);this.registerContext.on("failed",this.emit.bind(this,
"registrationFailed"));this.registerContext.on("registered",this.emit.bind(this,"registered"));this.registerContext.on("unregistered",this.emit.bind(this,"unregistered"));this.configuration.autostart&&this.start();"function"===typeof g.addEventListener&&(b.chrome&&b.chrome.app&&b.chrome.app.runtime||g.addEventListener("unload",this.stop.bind(this)))};f.prototype=Object.create(h.EventEmitter.prototype);f.prototype.register=function(a){this.configuration.register=!0;this.registerContext.register(a);
return this};f.prototype.unregister=function(a){this.configuration.register=!1;this.registerContext.unregister(a);return this};f.prototype.isRegistered=function(){return this.registerContext.registered};f.prototype.isConnected=function(){return this.transport?this.transport.connected:!1};f.prototype.afterConnected=function(a){if(this.isConnected())a();else this.once("connected",a)};f.prototype.invite=function(a,b){var e=new h.InviteClientContext(this,a,b);this.afterConnected(e.invite.bind(e));return e};
f.prototype.subscribe=function(a,b,e){a=new h.Subscription(this,a,b,e);this.afterConnected(a.subscribe.bind(a));return a};f.prototype.message=function(a,b,e){if(void 0===b)throw new TypeError("Not enough arguments");e=Object.create(e||Object.prototype);e.contentType||(e.contentType="text/plain");e.body=b;return this.request(h.C.MESSAGE,a,e)};f.prototype.request=function(a,b,e){a=new h.ClientContext(this,a,b,e);this.afterConnected(a.send.bind(a));return a};f.prototype.stop=function(){function c(){0===
g.nistTransactionsCount&&0===g.nictTransactionsCount&&(g.removeListener("transactionDestroyed",c),g.transport.disconnect())}var b,e,f,g=this;this.logger.log("user requested closure...");if(this.status===a.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;h.Timers.clearTimeout(this.transportRecoveryTimer);this.logger.log("closing registerContext");this.registerContext.close();for(b in this.sessions)this.logger.log("closing session "+b),this.sessions[b].terminate();for(e in this.subscriptions)this.logger.log("unsubscribing from subscription "+
e),this.subscriptions[e].close();for(f in this.applicants)this.applicants[f].close();this.status=a.STATUS_USER_CLOSED;if(0===this.nistTransactionsCount&&0===this.nictTransactionsCount)this.transport.disconnect();else this.on("transactionDestroyed",c);return this};f.prototype.start=function(){var c;this.logger.log("user requested startup...");this.status===a.STATUS_INIT?(c=this.getNextWsServer(),this.status=a.STATUS_STARTING,new h.Transport(this,c)):this.status===a.STATUS_USER_CLOSED?(this.logger.log("resuming"),
this.status=a.STATUS_READY,this.transport.connect()):this.status===a.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===a.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this};f.prototype.normalizeTarget=function(a){return h.Utils.normalizeTarget(a,this.configuration.hostportParams)};f.prototype.saveCredentials=function(a){this.cache.credentials[a.realm]=
this.cache.credentials[a.realm]||{};this.cache.credentials[a.realm][a.uri]=a;return this};f.prototype.getCredentials=function(a){var b,e;b=a.ruri.host;this.cache.credentials[b]&&this.cache.credentials[b][a.ruri]&&(e=this.cache.credentials[b][a.ruri],e.method=a.method);return e};f.prototype.getLogger=function(a,b){return this.log.getLogger(a,b)};f.prototype.onTransportClosed=function(a){var b,e,f=["nict","ict","nist","ist"];a.server.status=h.Transport.C.STATUS_DISCONNECTED;this.logger.log("connection state set to "+
h.Transport.C.STATUS_DISCONNECTED);e=f.length;for(a=0;a<e;a++)for(b in this.transactions[f[a]])this.transactions[f[a]][b].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()};f.prototype.onTransportError=function(c){this.logger.log("transport "+c.server.ws_uri+" failed | connection state set to "+h.Transport.C.STATUS_ERROR);c.server.status=h.Transport.C.STATUS_ERROR;this.emit("disconnected",{transport:c});this.status!==a.STATUS_USER_CLOSED&&((c=this.getNextWsServer())?new h.Transport(this,
c):(this.closeSessionsOnTransportError(),this.error&&this.error===a.NETWORK_ERROR||(this.status=a.STATUS_NOT_READY,this.error=a.NETWORK_ERROR),this.recoverTransport()))};f.prototype.onTransportConnected=function(c){this.transport=c;this.transportRecoverAttempts=0;c.server.status=h.Transport.C.STATUS_READY;this.logger.log("connection state set to "+h.Transport.C.STATUS_READY);this.status!==a.STATUS_USER_CLOSED&&(this.status=a.STATUS_READY,this.error=null,this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this)),
this.emit("connected",{transport:c}))};f.prototype.onTransportConnecting=function(a,b){this.emit("connecting",{transport:a,attempts:b})};f.prototype.newTransaction=function(a){this.transactions[a.type][a.id]=a;this.emit("newTransaction",{transaction:a})};f.prototype.destroyTransaction=function(a){delete this.transactions[a.type][a.id];this.emit("transactionDestroyed",{transaction:a})};f.prototype.receiveRequest=function(c){function b(a){return a&&a.user===c.ruri.user}var e,f,g;f=c.method;g=c.method.toLowerCase();
var k=this;if(!(b(this.configuration.uri)||b(this.contact.uri)||b(this.contact.pub_gruu)||b(this.contact.temp_gruu)))this.logger.warn("Request-URI does not point to us"),c.method!==h.C.ACK&&c.reply_sl(404);else if(c.ruri.scheme===h.C.SIPS)c.reply_sl(416);else if(!h.Transactions.checkTransaction(this,c)){if(f===h.C.OPTIONS)new h.Transactions.NonInviteServerTransaction(c,this),c.reply(200,null,["Allow: "+h.Utils.getAllowedMethods(this),"Accept: "+a.ACCEPTED_BODY_TYPES]);else if(f===h.C.MESSAGE){if(!this.listeners(g).length){new h.Transactions.NonInviteServerTransaction(c,
this);c.reply(405,null,["Allow: "+h.Utils.getAllowedMethods(this)]);return}g=new h.ServerContext(this,c);g.body=c.body;g.content_type=c.getHeader("Content-Type")||"text/plain";c.reply(200,null);this.emit("message",g)}else f!==h.C.INVITE&&f!==h.C.ACK&&new h.ServerContext(this,c);if(c.to_tag)(e=this.findDialog(c))?(f===h.C.INVITE&&new h.Transactions.InviteServerTransaction(c,this),e.receiveRequest(c)):f===h.C.NOTIFY?(f=this.findSession(c))?f.receiveRequest(c):(this.logger.warn("received NOTIFY request for a non existent session"),
c.reply(481,"Subscription does not exist")):f!==h.C.ACK&&c.reply(481);else switch(f){case h.C.INVITE:if(f=this.configuration.replaces!==h.C.supported.UNSUPPORTED&&c.parseHeader("replaces"))if(e=this.dialogs[f.call_id+f.replaces_to_tag+f.replaces_from_tag],!e){c.reply_sl(481,null);break}else if(e.owner.status===h.Session.C.STATUS_TERMINATED){c.reply_sl(603,null);break}else if(e.state===h.Dialog.C.STATUS_CONFIRMED&&f.early_only){c.reply_sl(486,null);break}f=this.configuration.mediaHandlerFactory.isSupported;
!f||f()?(f=new h.InviteServerContext(this,c),f.replacee=e&&e.owner,f.on("invite",function(){k.emit("invite",this)})):(this.logger.warn("INVITE received but WebRTC is not supported"),c.reply(488));break;case h.C.BYE:c.reply(481);break;case h.C.CANCEL:(f=this.findSession(c))?f.receiveRequest(c):this.logger.warn("received CANCEL request for a non existent session");break;case h.C.ACK:break;default:c.reply(405)}}};f.prototype.findSession=function(a){return this.sessions[a.call_id+a.from_tag]||this.sessions[a.call_id+
a.to_tag]||null};f.prototype.findDialog=function(a){return this.dialogs[a.call_id+a.from_tag+a.to_tag]||this.dialogs[a.call_id+a.to_tag+a.from_tag]||null};f.prototype.getNextWsServer=function(){var a,b,e,f=[];b=this.configuration.wsServers.length;for(a=0;a<b;a++)e=this.configuration.wsServers[a],e.status!==h.Transport.C.STATUS_ERROR&&(0===f.length?f.push(e):e.weight>f[0].weight?f=[e]:e.weight===f[0].weight&&f.push(e));a=Math.floor(Math.random()*f.length);return f[a]};f.prototype.closeSessionsOnTransportError=
function(){for(var a in this.sessions)this.sessions[a].onTransportError();this.registerContext.onTransportClosed()};f.prototype.recoverTransport=function(a){var b,e,f,g;a=a||this;f=a.transportRecoverAttempts;e=a.configuration.wsServers.length;for(b=0;b<e;b++)a.configuration.wsServers[b].status=0;g=a.getNextWsServer();b=Math.floor(Math.random()*Math.pow(2,f)+1)*a.configuration.connectionRecoveryMinInterval;b>a.configuration.connectionRecoveryMaxInterval&&(this.logger.log("time for next connection attempt exceeds connectionRecoveryMaxInterval, resetting counter"),
b=a.configuration.connectionRecoveryMinInterval,f=0);this.logger.log("next connection attempt in "+b+" seconds");this.transportRecoveryTimer=h.Timers.setTimeout(function(){a.transportRecoverAttempts=f+1;new h.Transport(a,g)},1E3*b)};f.prototype.loadConfig=function(a){function b(e,d){var f=e.replace(/([a-z][A-Z])/g,function(a){return a[0]+"_"+a[1].toLowerCase()});if(e!==f){var g=a.hasOwnProperty(e);a.hasOwnProperty(f)&&(d.warn(f+" is deprecated, please use "+e),g&&d.warn(e+" overriding "+f));a[e]=
g?a[e]:a[f]}}var g,k,l,m={viaHost:h.Utils.createRandomToken(12)+".invalid",uri:new h.URI("sip","anonymous."+h.Utils.createRandomToken(6),"anonymous.invalid",null,null),wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",status:0,weight:0,ws_uri:"wss://edge.sip.onsip.com"}],password:null,registerExpires:600,register:!0,registrarServer:null,wsServerMaxReconnection:3,wsServerReconnectionTimeout:4,connectionRecoveryMinInterval:2,connectionRecoveryMaxInterval:30,keepAliveInterval:0,
usePreloadedRoute:!1,userAgentString:h.C.USER_AGENT,iceCheckingTimeout:5E3,noAnswerTimeout:60,stunServers:["stun:stun.l.google.com:19302"],turnServers:[],traceSip:!1,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,autostart:!0,rel100:h.C.supported.UNSUPPORTED,replaces:h.C.supported.UNSUPPORTED,mediaHandlerFactory:h.WebRTC.MediaHandler.defaultFactory,authenticationFactory:e(function(a){return new h.DigestAuthentication(a)})};for(g in f.configuration_check.mandatory)if(b(g,this.logger),a.hasOwnProperty(g))if(k=
a[g],l=f.configuration_check.mandatory[g](k),void 0!==l)m[g]=l;else throw new h.Exceptions.ConfigurationError(g,k);else throw new h.Exceptions.ConfigurationError(g);h.Utils.optionsOverride(a,"rel100","reliable",!0,this.logger,h.C.supported.UNSUPPORTED);var z=["stunServers","turnServers"];for(g in f.configuration_check.optional)if(b(g,this.logger),a.hasOwnProperty(g)&&(k=a[g],!(k instanceof Array&&0===k.length&&0>z.indexOf(g)||null===k||""===k||void 0===k||"number"===typeof k&&isNaN(k))))if(l=f.configuration_check.optional[g](k),
void 0!==l)m[g]=l;else throw new h.Exceptions.ConfigurationError(g,k);if(m.connectionRecoveryMaxInterval<m.connectionRecoveryMinInterval)throw new h.Exceptions.ConfigurationError("connectionRecoveryMaxInterval",m.connectionRecoveryMaxInterval);0===m.displayName&&(m.displayName="0");m.instanceId||(m.instanceId=h.Utils.newUUID());m.sipjsId=h.Utils.createRandomToken(5);k=m.uri.clone();k.user=null;m.hostportParams=k.toString().replace(/^sip:/i,"");m.authorizationUser||(m.authorizationUser=m.uri.user);
m.registrarServer||(k=m.uri.clone(),k.user=null,m.registrarServer=k);m.noAnswerTimeout*=1E3;m.hackIpInContact&&(m.viaHost=h.Utils.getRandomTestNetIP());this.contact={pub_gruu:null,temp_gruu:null,uri:new h.URI("sip",h.Utils.createRandomToken(8),m.viaHost,null,{transport:m.hackWssInTransport?"wss":"ws"}),toString:function(a){a=a||{};var c=a.outbound||null,b="<",b=a.anonymous?b+(this.temp_gruu||("sip:anonymous@anonymous.invalid;transport="+m.hackWssInTransport?"wss":"ws")).toString():b+(this.pub_gruu||
this.uri).toString();c&&(b+=";ob");return b+">"}};h.Utils.optionsOverride(m,"media","mediaConstraints",!0,this.logger);for(g in m)f.configuration_skeleton[g].value=m[g];Object.defineProperties(this.configuration,f.configuration_skeleton);for(g in m)f.configuration_skeleton[g].value="";this.logger.log("configuration parameters after validation:");for(g in m)switch(g){case "uri":case "registrarServer":case "mediaHandlerFactory":this.logger.log("\u00b7 "+g+": "+m[g]);break;case "password":this.logger.log("\u00b7 "+
g+": NOT SHOWN");break;default:this.logger.log("\u00b7 "+g+": "+JSON.stringify(m[g]))}};f.configuration_skeleton=function(){var a,b,e={},f="sipjsId hostportParams uri wsServers authorizationUser connectionRecoveryMaxInterval connectionRecoveryMinInterval keepAliveInterval displayName hackViaTcp hackIpInContact hackWssInTransport iceCheckingTimeout instanceId noAnswerTimeout password registerExpires registrarServer reliable rel100 replaces userAgentString autostart stunServers traceSip turnServers usePreloadedRoute wsServerMaxReconnection wsServerReconnectionTimeout mediaHandlerFactory media mediaConstraints authenticationFactory via_core_value viaHost".split(" ");
for(a in f)b=f[a],e[b]={value:"",writable:!1,configurable:!1};e.register={value:"",writable:!0,configurable:!1};return e}();f.configuration_check={mandatory:{},optional:{uri:function(a){/^sip:/i.test(a)||(a=h.C.SIP+":"+a);if((a=h.URI.parse(a))&&a.user)return a},wsServers:function(a){var b,e,f;if("string"===typeof a)a=[{ws_uri:a}];else if(a instanceof Array)for(e=a.length,b=0;b<e;b++)"string"===typeof a[b]&&(a[b]={ws_uri:a[b]});else return;if(0===a.length)return!1;e=a.length;for(b=0;b<e;b++){if(!a[b].ws_uri||
a[b].weight&&!Number(a[b].weight))return;f=h.Grammar.parse(a[b].ws_uri,"absoluteURI");if(-1===f||"wss"!==f.scheme&&"ws"!==f.scheme)return;a[b].sip_uri="<sip:"+f.host+(f.port?":"+f.port:"")+";transport=ws;lr>";a[b].weight||(a[b].weight=0);a[b].status=0;a[b].scheme=f.scheme.toUpperCase()}return a},authorizationUser:function(a){if(-1!==h.Grammar.parse('"'+a+'"',"quoted_string"))return a},connectionRecoveryMaxInterval:function(a){if(h.Utils.isDecimal(a)&&(a=Number(a),0<a))return a},connectionRecoveryMinInterval:function(a){if(h.Utils.isDecimal(a)&&
(a=Number(a),0<a))return a},displayName:function(a){if(-1!==h.Grammar.parse('"'+a+'"',"displayName"))return a},hackViaTcp:function(a){if("boolean"===typeof a)return a},hackIpInContact:function(a){if("boolean"===typeof a)return a},iceCheckingTimeout:function(a){if(h.Utils.isDecimal(a))return 500>a?5E3:a},hackWssInTransport:function(a){if("boolean"===typeof a)return a},instanceId:function(a){if("string"===typeof a&&(/^uuid:/i.test(a)&&(a=a.substr(5)),-1!==h.Grammar.parse(a,"uuid")))return a},keepAliveInterval:function(a){if(h.Utils.isDecimal(a)&&
(a=Number(a),0<a))return a},noAnswerTimeout:function(a){if(h.Utils.isDecimal(a)&&(a=Number(a),0<a))return a},password:function(a){return String(a)},rel100:function(a){return a===h.C.supported.REQUIRED?h.C.supported.REQUIRED:a===h.C.supported.SUPPORTED?h.C.supported.SUPPORTED:h.C.supported.UNSUPPORTED},replaces:function(a){return a===h.C.supported.REQUIRED?h.C.supported.REQUIRED:a===h.C.supported.SUPPORTED?h.C.supported.SUPPORTED:h.C.supported.UNSUPPORTED},register:function(a){if("boolean"===typeof a)return a},
registerExpires:function(a){if(h.Utils.isDecimal(a)&&(a=Number(a),0<a))return a},registrarServer:function(a){if("string"===typeof a&&(/^sip:/i.test(a)||(a=h.C.SIP+":"+a),(a=h.URI.parse(a))&&!a.user))return a},stunServers:function(a){var b,e,f;if("string"===typeof a)a=[a];else if(!(a instanceof Array))return;e=a.length;for(b=0;b<e;b++){f=a[b];/^stuns?:/.test(f)||(f="stun:"+f);if(-1===h.Grammar.parse(f,"stun_URI"))return;a[b]=f}return a},traceSip:function(a){if("boolean"===typeof a)return a},turnServers:function(a){var b,
e,f,g,k,l;a instanceof Array||(a=[a]);f=a.length;for(b=0;b<f;b++){g=a[b];g.server&&(g.urls=[g.server]);if(!g.urls||!g.username||!g.password)return;g.urls instanceof Array?k=g.urls.length:(g.urls=[g.urls],k=1);for(e=0;e<k;e++)if(l=g.urls[e],/^turns?:/.test(l)||(l="turn:"+l),-1===h.Grammar.parse(l,"turn_URI"))return}return a},userAgentString:function(a){if("string"===typeof a)return a},usePreloadedRoute:function(a){if("boolean"===typeof a)return a},wsServerMaxReconnection:function(a){if(h.Utils.isDecimal(a)&&
(a=Number(a),0<a))return a},wsServerReconnectionTimeout:function(a){if(h.Utils.isDecimal(a)&&(a=Number(a),0<a))return a},autostart:function(a){if("boolean"===typeof a)return a},mediaHandlerFactory:function(a){if(a instanceof Function){var b=function(){function b(a){1<e[a].length&&(e[a]=h.Utils.promisify(e,a,"getDescription"===a))}var e=a.apply(this,arguments);b("getDescription");b("setDescription");return e};b.isSupported=a.isSupported;return b}},authenticationFactory:e}};f.C=a;h.UA=f}}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],65:[function(k,l,m){l.exports=function(b){var h;h=function(g,e,f,a,c,d){var h,k;if(!f)throw new TypeError('missing or invalid "host" parameter');g=g||b.C.SIP;this.parameters={};this.headers={};for(h in c)this.setParam(h,c[h]);for(k in d)this.setHeader(k,d[k]);Object.defineProperties(this,{scheme:{get:function(){return g},set:function(a){g=a.toLowerCase()}},user:{get:function(){return e},set:function(a){e=
a}},host:{get:function(){return f},set:function(a){f=a.toLowerCase()}},aor:{get:function(){return e+"@"+f}},port:{get:function(){return a},set:function(b){a=0===b?b:parseInt(b,10)||null}}})};h.prototype={setParam:function(b,e){b&&(this.parameters[b.toLowerCase()]="undefined"===typeof e||null===e?null:e.toString().toLowerCase())},getParam:function(b){if(b)return this.parameters[b.toLowerCase()]},hasParam:function(b){if(b)return this.parameters.hasOwnProperty(b.toLowerCase())&&!0||!1},deleteParam:function(b){var e;
b=b.toLowerCase();if(this.parameters.hasOwnProperty(b))return e=this.parameters[b],delete this.parameters[b],e},clearParams:function(){this.parameters={}},setHeader:function(g,e){this.headers[b.Utils.headerize(g)]=e instanceof Array?e:[e]},getHeader:function(g){if(g)return this.headers[b.Utils.headerize(g)]},hasHeader:function(g){if(g)return this.headers.hasOwnProperty(b.Utils.headerize(g))&&!0||!1},deleteHeader:function(g){var e;g=b.Utils.headerize(g);if(this.headers.hasOwnProperty(g))return e=this.headers[g],
delete this.headers[g],e},clearHeaders:function(){this.headers={}},clone:function(){return new h(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var g,e,f,a,c=[];a=this.scheme+":";this.scheme.match("^sips?$")||(a+="//");this.user&&(a+=b.Utils.escapeUser(this.user)+"@");a+=this.host;if(this.port||0===this.port)a+=":"+this.port;for(e in this.parameters)a+=";"+e,null!==this.parameters[e]&&(a+="="+this.parameters[e]);
for(g in this.headers)for(f in this.headers[g])c.push(g+"="+this.headers[g][f]);0<c.length&&(a+="?"+c.join("&"));return a}};h.parse=function(g){g=b.Grammar.parse(g,"SIP_URI");if(-1!==g)return g};b.URI=h}},{}],66:[function(k,l,m){l.exports=function(b,h){var g;g={Promise:h.Promise,defer:function(){var b={};b.promise=new g.Promise(function(f,a){b.resolve=f;b.reject=a});return b},promisify:function(b,f,a){var c=b[f];return function(d,f,h){return(new g.Promise(function(f,g){var h=[d,f,g];a&&(h=[f,g,d]);
c.apply(b,h)})).then(f,h)}},augment:function(b,f,a,c){var d,g;g=f.prototype;for(d in g)if(c||void 0===b[d])b[d]=g[d];f.apply(b,a)},optionsOverride:function(b,f,a,c,d,g){c&&b[a]&&d.warn(a+" is deprecated, please use "+f+" instead");b[f]&&b[a]&&d.warn(f+" overriding "+a);b[f]=b[f]||b[a]||g},str_utf8_length:function(b){return encodeURIComponent(b).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(b){if(b){var f=b.indexOf("o="),a=b.indexOf("\r\n",f);return"v=0\r\n"+b.slice(f,a)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},
isFunction:function(b){return void 0!==b?"[object Function]"===Object.prototype.toString.call(b):!1},isDecimal:function(b){return!isNaN(b)&&parseFloat(b)===parseInt(b,10)},createRandomToken:function(b,f){var a,c,d="";f=f||32;for(a=0;a<b;a++)c=Math.random()*f|0,d+=c.toString(f);return d},newTag:function(){return b.Utils.createRandomToken(b.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var f=16*Math.random()|0;return("x"===b?f:f&3|8).toString(16)})},
hostType:function(e){if(e&&(e=b.Grammar.parse(e,"host"),-1!==e))return e.host_type},normalizeTarget:function(e,f){var a,c;if(e){if(e instanceof b.URI)return e;if("string"===typeof e){c=e.split("@");switch(c.length){case 1:if(!f)return;a=e;c=f;break;case 2:a=c[0];c=c[1];break;default:a=c.slice(0,c.length-1).join("@"),c=c[c.length-1]}a=a.replace(/^(sips?|tel):/i,"");/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,""));e=b.C.SIP+":"+b.Utils.escapeUser(a)+"@"+c;if(a=b.URI.parse(e))return a}}},
escapeUser:function(b){return encodeURIComponent(decodeURIComponent(b)).replace(/%3A/ig,":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")},headerize:function(b){var f={"Call-Id":"Call-ID",Cseq:"CSeq",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"};b=b.toLowerCase().replace(/_/g,"-").split("-");var a="",c=b.length,d;for(d=0;d<c;d++)0!==d&&(a+="-"),a+=b[d].charAt(0).toUpperCase()+b[d].substring(1);f[a]&&(a=f[a]);return a},sipErrorCause:function(e){for(var f in b.C.SIP_ERROR_CAUSES)if(-1!==
b.C.SIP_ERROR_CAUSES[f].indexOf(e))return b.C.causes[f];return b.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(e,f){return f||b.C.REASON_PHRASE[e]||""},getReasonHeaderValue:function(e,f){f=b.Utils.getReasonPhrase(e,f);return"SIP ;cause="+e+' ;text="'+f+'"'},getCancelReason:function(e,f){if(e&&200>e||699<e)throw new TypeError("Invalid status_code: "+e);if(e)return b.Utils.getReasonHeaderValue(e,f)},buildStatusLine:function(b,f){b=b||null;f=f||null;if(!b||100>b||699<b)throw new TypeError("Invalid status_code: "+
b);if(f&&"string"!==typeof f&&!(f instanceof String))throw new TypeError("Invalid reason_phrase: "+f);f=g.getReasonPhrase(b,f);return"SIP/2.0 "+b+" "+f+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+Math.floor(254*Math.random()+1)},getAllowedMethods:function(e){var f,a=b.UA.C.ALLOWED_METHODS.toString();for(f in b.UA.C.EVENT_METHODS)e.listeners(f).length&&(a+=","+b.UA.C.EVENT_METHODS[f]);return a},calculateMD5:function(b){function f(a,b){var c,d,e,f,g;e=a&2147483648;f=b&2147483648;c=a&1073741824;
d=b&1073741824;g=(a&1073741823)+(b&1073741823);return c&d?g^2147483648^e^f:c|d?g&1073741824?g^3221225472^e^f:g^1073741824^e^f:g^e^f}function a(a,b,c,d,e,g,h){a=f(a,f(f(b&c|~b&d,e),h));return f(a<<g|a>>>32-g,b)}function c(a,b,c,d,e,g,h){a=f(a,f(f(b&d|c&~d,e),h));return f(a<<g|a>>>32-g,b)}function d(a,b,c,d,e,g,h){a=f(a,f(f(b^c^d,e),h));return f(a<<g|a>>>32-g,b)}function g(a,b,c,d,e,h,k){a=f(a,f(f(c^(b|~d),e),k));return f(a<<h|a>>>32-h,b)}function h(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,
c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b}var k=[],l,m,v,C,q,r,t,u;b=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b}(b);k=function(a){var b,c=a.length;b=c+8;for(var d=16*((b-b%64)/64+1),e=Array(d-1),f=0,g=0;g<c;)b=(g-g%4)/4,f=g%4*8,e[b]|=a.charCodeAt(g)<<
f,g++;b=(g-g%4)/4;e[b]|=128<<g%4*8;e[d-2]=c<<3;e[d-1]=c>>>29;return e}(b);q=1732584193;r=4023233417;t=2562383102;u=271733878;for(b=0;b<k.length;b+=16)l=q,m=r,v=t,C=u,q=a(q,r,t,u,k[b+0],7,3614090360),u=a(u,q,r,t,k[b+1],12,3905402710),t=a(t,u,q,r,k[b+2],17,606105819),r=a(r,t,u,q,k[b+3],22,3250441966),q=a(q,r,t,u,k[b+4],7,4118548399),u=a(u,q,r,t,k[b+5],12,1200080426),t=a(t,u,q,r,k[b+6],17,2821735955),r=a(r,t,u,q,k[b+7],22,4249261313),q=a(q,r,t,u,k[b+8],7,1770035416),u=a(u,q,r,t,k[b+9],12,2336552879),
t=a(t,u,q,r,k[b+10],17,4294925233),r=a(r,t,u,q,k[b+11],22,2304563134),q=a(q,r,t,u,k[b+12],7,1804603682),u=a(u,q,r,t,k[b+13],12,4254626195),t=a(t,u,q,r,k[b+14],17,2792965006),r=a(r,t,u,q,k[b+15],22,1236535329),q=c(q,r,t,u,k[b+1],5,4129170786),u=c(u,q,r,t,k[b+6],9,3225465664),t=c(t,u,q,r,k[b+11],14,643717713),r=c(r,t,u,q,k[b+0],20,3921069994),q=c(q,r,t,u,k[b+5],5,3593408605),u=c(u,q,r,t,k[b+10],9,38016083),t=c(t,u,q,r,k[b+15],14,3634488961),r=c(r,t,u,q,k[b+4],20,3889429448),q=c(q,r,t,u,k[b+9],5,568446438),
u=c(u,q,r,t,k[b+14],9,3275163606),t=c(t,u,q,r,k[b+3],14,4107603335),r=c(r,t,u,q,k[b+8],20,1163531501),q=c(q,r,t,u,k[b+13],5,2850285829),u=c(u,q,r,t,k[b+2],9,4243563512),t=c(t,u,q,r,k[b+7],14,1735328473),r=c(r,t,u,q,k[b+12],20,2368359562),q=d(q,r,t,u,k[b+5],4,4294588738),u=d(u,q,r,t,k[b+8],11,2272392833),t=d(t,u,q,r,k[b+11],16,1839030562),r=d(r,t,u,q,k[b+14],23,4259657740),q=d(q,r,t,u,k[b+1],4,2763975236),u=d(u,q,r,t,k[b+4],11,1272893353),t=d(t,u,q,r,k[b+7],16,4139469664),r=d(r,t,u,q,k[b+10],23,3200236656),
q=d(q,r,t,u,k[b+13],4,681279174),u=d(u,q,r,t,k[b+0],11,3936430074),t=d(t,u,q,r,k[b+3],16,3572445317),r=d(r,t,u,q,k[b+6],23,76029189),q=d(q,r,t,u,k[b+9],4,3654602809),u=d(u,q,r,t,k[b+12],11,3873151461),t=d(t,u,q,r,k[b+15],16,530742520),r=d(r,t,u,q,k[b+2],23,3299628645),q=g(q,r,t,u,k[b+0],6,4096336452),u=g(u,q,r,t,k[b+7],10,1126891415),t=g(t,u,q,r,k[b+14],15,2878612391),r=g(r,t,u,q,k[b+5],21,4237533241),q=g(q,r,t,u,k[b+12],6,1700485571),u=g(u,q,r,t,k[b+3],10,2399980690),t=g(t,u,q,r,k[b+10],15,4293915773),
r=g(r,t,u,q,k[b+1],21,2240044497),q=g(q,r,t,u,k[b+8],6,1873313359),u=g(u,q,r,t,k[b+15],10,4264355552),t=g(t,u,q,r,k[b+6],15,2734768916),r=g(r,t,u,q,k[b+13],21,1309151649),q=g(q,r,t,u,k[b+4],6,4149444226),u=g(u,q,r,t,k[b+11],10,3174756917),t=g(t,u,q,r,k[b+2],15,718787259),r=g(r,t,u,q,k[b+9],21,3951481745),q=f(q,l),r=f(r,m),t=f(t,v),u=f(u,C);return(h(q)+h(r)+h(t)+h(u)).toLowerCase()}};b.Utils=g}},{}],67:[function(k,l,m){l.exports=function(b,h){var g;g={};g.MediaHandler=k("./WebRTC/MediaHandler")(b);
g.MediaStreamManager=k("./WebRTC/MediaStreamManager")(b,h);var e;g.isSupported=function(){if(void 0!==e)return e;g.MediaStream=h.MediaStream;g.getUserMedia=h.getUserMedia;g.RTCPeerConnection=h.RTCPeerConnection;g.RTCSessionDescription=h.RTCSessionDescription;g.RTCPeerConnection&&g.RTCSessionDescription?(g.getUserMedia&&(g.getUserMedia=b.Utils.promisify(h,"getUserMedia")),e=!0):e=!1;return e};return g}},{"./WebRTC/MediaHandler":68,"./WebRTC/MediaStreamManager":69}],68:[function(k,l,m){l.exports=function(b){var h=
function(g,e){function f(a,b){if(a.mediaStreamManager.on)a.mediaStreamManager.on(b,function(){a.emit.apply(a,[b].concat(Array.prototype.slice.call(arguments)))})}e=e||{};this.logger=g.ua.getLogger("sip.invitecontext.mediahandler",g.id);this.session=g;this.localMedia=null;this.ready=!0;this.mediaStreamManager=e.mediaStreamManager||new b.WebRTC.MediaStreamManager(this.logger);this.videoMuted=this.audioMuted=!1;var a,c,d,h,k=this,l=[];a=e.stunServers||null;var m=e.turnServers||null,z=this.session.ua.configuration;
this.RTCConstraints=e.RTCConstraints||{};a||(a=z.stunServers);m||(m=z.turnServers);[].concat(a).forEach(function(a){l.push({url:a})});d=m.length;for(a=0;a<d;a++)for(h=m[a],c=0;c<h.urls.length;c++)l.push({url:h.urls[c],username:h.username,credential:h.password});this.onIceCompleted=b.Utils.defer();this.onIceCompleted.promise.then(function(a){k.emit("iceGatheringComplete",a);k.iceCheckingTimer&&(b.Timers.clearTimeout(k.iceCheckingTimer),k.iceCheckingTimer=null)});this.peerConnection=new b.WebRTC.RTCPeerConnection({iceServers:l},
this.RTCConstraints);this._remoteStreams=[];this.peerConnection.onaddstream=function(a){k.logger.log("stream added: "+a.stream.id);k._remoteStreams.push(a.stream);k.render();k.emit("addStream",a)};this.peerConnection.onremovestream=function(a){k.logger.log("stream removed: "+a.stream.id)};this.peerConnection.onicecandidate=function(a){k.emit("iceCandidate",a);a.candidate?(k.logger.log("ICE candidate received: "+(null===a.candidate.candidate?null:a.candidate.candidate.trim())),k.iceCheckingTimer||
(k.iceCheckingTimer=b.Timers.setTimeout(function(){k.logger.log("RTCIceChecking Timeout Triggered after "+z.iceCheckingTimeout+" milliseconds");k.onIceCompleted.resolve(this)}.bind(this),z.iceCheckingTimeout))):k.onIceCompleted.resolve(this)};this.peerConnection.onicegatheringstatechange=function(){k.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState);"gathering"===this.iceGatheringState&&k.emit("iceGathering",this);"complete"===this.iceGatheringState&&k.onIceCompleted.resolve(this)};
this.peerConnection.oniceconnectionstatechange=function(){var a;"checking"!==this.iceConnectionState||k.iceCheckingTimer||(k.iceCheckingTimer=b.Timers.setTimeout(function(){k.logger.log("RTCIceChecking Timeout Triggered after "+z.iceCheckingTimeout+" milliseconds");k.onIceCompleted.resolve(this)}.bind(this),z.iceCheckingTimeout));switch(this.iceConnectionState){case "new":a="iceConnection";break;case "checking":a="iceConnectionChecking";break;case "connected":a="iceConnectionConnected";break;case "completed":a=
"iceConnectionCompleted";break;case "failed":a="iceConnectionFailed";break;case "disconnected":a="iceConnectionDisconnected";break;case "closed":a="iceConnectionClosed";break;default:k.logger.warn("Unknown iceConnection state:",this.iceConnectionState);return}k.emit(a,this)};this.peerConnection.onstatechange=function(){k.logger.log('PeerConnection state changed to "'+this.readyState+'"')};f(this,"userMediaRequest");f(this,"userMedia");f(this,"userMediaFailed")};h.defaultFactory=function(b,e){return new h(b,
e)};h.defaultFactory.isSupported=function(){return b.WebRTC.isSupported()};h.prototype=Object.create(b.MediaHandler.prototype,{isReady:{writable:!0,value:function(){return this.ready}},close:{writable:!0,value:function(){this.logger.log("closing PeerConnection");this._remoteStreams=[];this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.close(),this.localMedia&&this.mediaStreamManager.release(this.localMedia))}},getDescription:{writable:!0,value:function(g){var e=
this,f=e.mediaStreamManager.acquire;1<f.length&&(f=b.Utils.promisify(this.mediaStreamManager,"acquire",!0));g=g||{};!0===g.dataChannel&&(g.dataChannel={});this.mediaHint=g;e.localMedia?(e.logger.log("already have local media"),f=b.Utils.Promise.resolve(e.localMedia)):(e.logger.log("acquiring local media"),f=f.call(e.mediaStreamManager,g).then(function(a){e.logger.log("acquired local media streams");e.localMedia=a;e.session.connecting();return a},function(a){e.logger.error("unable to acquire streams");
e.logger.error(a);e.session.connecting();throw a;}).then(this.addStreams.bind(this)));return f.then(function(){e.hasOffer("remote")?e.peerConnection.ondatachannel=function(a){e.dataChannel=a.channel;e.emit("dataChannel",e.dataChannel)}:g.dataChannel&&e.peerConnection.createDataChannel&&(e.dataChannel=e.peerConnection.createDataChannel("sipjs",g.dataChannel),e.emit("dataChannel",e.dataChannel));e.render();return e.createOfferOrAnswer(e.RTCConstraints)})}},setDescription:{writable:!0,value:function(g){g=
{type:this.hasOffer("local")?"answer":"offer",sdp:g};this.emit("setDescription",g);g=new b.WebRTC.RTCSessionDescription(g);return b.Utils.promisify(this.peerConnection,"setRemoteDescription")(g)}},getReferMedia:{writable:!0,value:function(){function b(e,a){return 0<a[e]().length}function e(e){return this.getLocalStreams().some(b.bind(null,e))&&this.getRemoteStreams().some(b.bind(null,e))}return{constraints:{audio:e.call(this,"getAudioTracks"),video:e.call(this,"getVideoTracks")}}}},isMuted:{writable:!0,
value:function(){return{audio:this.audioMuted,video:this.videoMuted}}},mute:{writable:!0,value:function(b){if(0!==this.getLocalStreams().length){b=b||{audio:0<this.getLocalStreams()[0].getAudioTracks().length,video:0<this.getLocalStreams()[0].getVideoTracks().length};var e=!1,f=!1;b.audio&&!this.audioMuted&&(this.audioMuted=e=!0,this.toggleMuteAudio(!0));b.video&&!this.videoMuted&&(this.videoMuted=f=!0,this.toggleMuteVideo(!0));if(e||f)return{audio:e,video:f}}}},unmute:{writable:!0,value:function(b){if(0!==
this.getLocalStreams().length){b=b||{audio:0<this.getLocalStreams()[0].getAudioTracks().length,video:0<this.getLocalStreams()[0].getVideoTracks().length};var e=!1,f=!1;b.audio&&this.audioMuted&&(e=!0,this.audioMuted=!1,this.toggleMuteAudio(!1));b.video&&this.videoMuted&&(f=!0,this.videoMuted=!1,this.toggleMuteVideo(!1));if(e||f)return{audio:e,video:f}}}},hold:{writable:!0,value:function(){this.toggleMuteAudio(!0);this.toggleMuteVideo(!0)}},unhold:{writable:!0,value:function(){this.audioMuted||this.toggleMuteAudio(!1);
this.videoMuted||this.toggleMuteVideo(!1)}},getLocalStreams:{writable:!0,value:function(){var b=this.peerConnection;return b&&"closed"===b.signalingState?(this.logger.warn("peerConnection is closed, getLocalStreams returning []"),[]):b.getLocalStreams&&b.getLocalStreams()||b.localStreams||[]}},getRemoteStreams:{writable:!0,value:function(){var b=this.peerConnection;return b&&"closed"===b.signalingState?(this.logger.warn("peerConnection is closed, getRemoteStreams returning this._remoteStreams"),this._remoteStreams):
b.getRemoteStreams&&b.getRemoteStreams()||b.remoteStreams||[]}},render:{writable:!0,value:function(g){g=g||this.mediaHint&&this.mediaHint.render;if(!g)return!1;var e={local:"getLocalStreams",remote:"getRemoteStreams"};Object.keys(e).forEach(function(f){var a=this[e[f]]();b.WebRTC.MediaStreamManager.render(a,g[f])}.bind(this))}},hasOffer:{writable:!0,value:function(b){return this.peerConnection.signalingState==="have-"+b+"-offer"}},createOfferOrAnswer:{writable:!0,value:function(g){var e=this,f,a=
e.peerConnection;e.ready=!1;f=e.hasOffer("remote")?"createAnswer":"createOffer";return b.Utils.promisify(a,f,!0)(g).then(b.Utils.promisify(a,"setLocalDescription")).then(function(){var c=b.Utils.defer();"complete"===a.iceConnectionState||"completed"===a.iceConnectionState?c.resolve():e.onIceCompleted.promise.then(c.resolve);return c.promise}).then(function(){var c=a.localDescription.sdp,c=b.Hacks.Chrome.needsExplicitlyInactiveSDP(c),c=b.Hacks.AllBrowsers.unmaskDtls(c),c=b.Hacks.Firefox.hasIncompatibleCLineWithSomeSIPEndpoints(c),
c={type:"createOffer"===f?"offer":"answer",sdp:c};e.emit("getDescription",c);e.ready=!0;return c.sdp}).catch(function(a){e.logger.error(a);e.ready=!0;throw new b.Exceptions.GetDescriptionError(a);})}},addStreams:{writable:!0,value:function(g){try{g=[].concat(g),g.forEach(function(b){this.peerConnection.addStream(b)},this)}catch(e){return this.logger.error("error adding stream"),this.logger.error(e),b.Utils.Promise.reject(e)}return b.Utils.Promise.resolve()}},toggleMuteHelper:{writable:!0,value:function(b,
e){this.getLocalStreams().forEach(function(f){f[b]().forEach(function(a){a.enabled=!e})})}},toggleMuteAudio:{writable:!0,value:function(b){this.toggleMuteHelper("getAudioTracks",b)}},toggleMuteVideo:{writable:!0,value:function(b){this.toggleMuteHelper("getVideoTracks",b)}}});return h}},{}],69:[function(k,l,m){l.exports=function(b,h){var g=function(e,f){if(!b.WebRTC.isSupported())throw new b.Exceptions.NotSupportedError("Media not supported");this.mediaHint=f||{constraints:{audio:!0,video:!0}};this.acquisitions=
{}};g.streamId=function(b){return b.getAudioTracks().concat(b.getVideoTracks()).map(function(b){return b.id}).join("")};g.render=function(e,f){function a(a,b){if("undefined"!==typeof a.src)h.revokeObjectURL(a.src),a.src=h.createObjectURL(b);else if("undefined"!==typeof(a.srcObject||a.mozSrcObject))a.srcObject=a.mozSrcObject=b;else return!1;return!0}function c(a){a.ensurePlayingIntervalId=b.Timers.setInterval(function(){a.paused?a.play():b.Timers.clearInterval(a.ensurePlayingIntervalId)},100)}if(!f)return!1;
if(Array.isArray(f)&&!f.length)throw new TypeError("elements must not be empty");f=[].concat(f);[].concat(e).forEach(function(b,e,f){"function"===typeof b&&(b=b());b=b[f%b.length];(h.attachMediaStream||a)(b,e);c(b)}.bind(null,f))};g.prototype=Object.create(b.EventEmitter.prototype,{acquire:{writable:!0,value:function(e){e=Object.keys(e||{}).length?e:this.mediaHint;var f=function(a,c){c=[].concat(c);c.forEach(function(b){b=g.streamId(b);this.acquisitions[b]=!!a},this);return b.Utils.Promise.resolve(c)}.bind(this);
if(e.stream)return f(!0,e.stream);var a=e.constraints||this.mediaHint&&this.mediaHint.constraints||{audio:!0,video:!0},c=b.Utils.defer();b.Timers.setTimeout(function(){this.emit("userMediaRequest",a);var d=function(a,b){var c=Array.prototype.slice.call(arguments,2),d=[a].concat(c);this.emit.apply(this,d);return b.apply(null,c)}.bind(this);c.resolve(b.WebRTC.getUserMedia(a).then(d.bind(this,"userMedia",f.bind(null,!1)),d.bind(this,"userMediaFailed",function(a){throw a;})))}.bind(this),0);return c.promise}},
release:{writable:!0,value:function(b){b=[].concat(b);b.forEach(function(b){var a=g.streamId(b);!1===this.acquisitions[a]&&b.stop();delete this.acquisitions[a]},this)}}});return g}},{}],70:[function(k,l,m){(function(b){function h(b,e){if(null!=b){var f=e.charAt(0).toUpperCase()+e.slice(1),f=[e,"webkit"+f,"moz"+f],a;for(a in f){var c=b[f[a]];if(c)return c.bind(b)}}}b=b.window||b;l.exports={WebSocket:b.WebSocket,Transport:k("./Transport"),open:b.open,Promise:b.Promise,timers:b,console:b.console||{debug:function(){},
log:function(){},warn:function(){},error:function(){}},MediaStream:h(b,"MediaStream"),getUserMedia:h(b.navigator,"getUserMedia"),RTCPeerConnection:h(b,"RTCPeerConnection"),RTCSessionDescription:h(b,"RTCSessionDescription"),addEventListener:h(b,"addEventListener"),HTMLMediaElement:b.HTMLMediaElement,attachMediaStream:b.attachMediaStream,createObjectURL:b.URL&&b.URL.createObjectURL,revokeObjectURL:b.URL&&b.URL.revokeObjectURL}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./Transport":63}],71:[function(k,l,m){l.exports=k("./SIP")(k("./environment"))},{"./SIP":54,"./environment":70}],72:[function(k,l,m){m.XMLHttpRequest=XMLHttpRequest},{}],73:[function(k,l,m){l.exports={name:"twilio-rtc-conversations",title:"Twilio RTC Conversations",description:"Twilio RTC Conversations JavaScript library",version:"0.8.4",homepage:"https://twilio.com",author:"Mark Andrus Roberts <mroberts@twilio.com>",contributors:["Ryan Rowland <rrowland@twilio.com>"],
keywords:["twilio","webrtc","library","javascript","conversations"],devDependencies:{browserify:"^9.0.3",cheerio:"^0.18.0",closurecompiler:"^1.5.1",istanbul:"^0.3.15",jsdoc:"^3.3.0-beta2",jshint:"^2.6.3","jshint-stylish":"^1.0.0",jsonwebtoken:"^5.0.0",mocha:"^2.2.5",promptly:"^0.2.0",q:"^1.0.1",sinon:"^1.15.3",twilio:"*"},engines:{node:">=0.12"},license:"MIT","private":!0,main:"./lib/index.js",scripts:{test:"make test",postinstall:"./scripts/postinstall.js"},dependencies:{"sip.js":"git+ssh://git@code.hq.twilio.com/client/SIP.js.git#stable-twilio",
ws:"^0.6.3",xmlhttprequest:"git+https://github.com/markandrus/node-XMLHttpRequest.git"}}},{}],74:[function(k,l,m){(function(b){var h=k("lib"),g=null;(function(b){if("function"===typeof define&&define.amd)define([],function(){return h});else if(b.Twilio=b.Twilio||function(){},g)b.Twilio[g]=h;else for(g in h)b.Twilio[g]=h[g]})(window||b||this)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{lib:13}]},{},[74]);
